<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Greg Ridgeway">
<meta name="dcterms.date" content="2025-03-25">

<title>Machine learning with text</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="L11-text_files/libs/clipboard/clipboard.min.js"></script>
<script src="L11-text_files/libs/quarto-html/quarto.js"></script>
<script src="L11-text_files/libs/quarto-html/popper.min.js"></script>
<script src="L11-text_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="L11-text_files/libs/quarto-html/anchor.min.js"></script>
<link href="L11-text_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="L11-text_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="L11-text_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="L11-text_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="L11-text_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="L11-text_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="L11-text_files/libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="L11-text_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="L11-text_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

<link href="L11-text_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="L11-text_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="L11-text_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="L11-text_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="L11-text_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="L11-text_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="L11-text_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="L11-text_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="L11-text_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#turning-text-into-data-with-text2vec" id="toc-turning-text-into-data-with-text2vec" class="nav-link" data-scroll-target="#turning-text-into-data-with-text2vec"><span class="header-section-number">2</span> Turning text into data with <code>text2vec</code></a>
  <ul class="collapse">
  <li><a href="#creating-a-document-term-matrix-dtm" id="toc-creating-a-document-term-matrix-dtm" class="nav-link" data-scroll-target="#creating-a-document-term-matrix-dtm"><span class="header-section-number">2.1</span> Creating a document-term matrix (DTM)</a></li>
  <li><a href="#term-frequencyinverse-document-frequency" id="toc-term-frequencyinverse-document-frequency" class="nav-link" data-scroll-target="#term-frequencyinverse-document-frequency"><span class="header-section-number">2.2</span> Term Frequency–Inverse Document Frequency</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">2.2.1</span> Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#term-co-occurrence-matrix-tcm" id="toc-term-co-occurrence-matrix-tcm" class="nav-link" data-scroll-target="#term-co-occurrence-matrix-tcm"><span class="header-section-number">3</span> Term co-occurrence matrix (TCM)</a></li>
  <li><a href="#singular-value-decomposition-for-text" id="toc-singular-value-decomposition-for-text" class="nav-link" data-scroll-target="#singular-value-decomposition-for-text"><span class="header-section-number">4</span> Singular value decomposition for text</a></li>
  <li><a href="#clustering-documents-using-their-svd-representation" id="toc-clustering-documents-using-their-svd-representation" class="nav-link" data-scroll-target="#clustering-documents-using-their-svd-representation"><span class="header-section-number">5</span> Clustering documents using their SVD representation</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="L11-text.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Machine learning with text</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Greg Ridgeway <a href="mailto:gridge@upenn.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Pennsylvania
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 25, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- In terminal: Only to HTML since heavy plotly() use -->
<!-- quarto render L11-text.qmd --to html-->
<!-- quarto render L11-text.qmd --cache-refresh --to html -->
<!-- git commit L11-* -m "commit message" -->
<!-- git status -->
<!-- git push -->
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In this section we will use <code>text2vec</code> to explore the language used in a collection of police reports describing officer-involved shootings (OIS). These reports contain unstructured narrative text. Our goal is to transform that text into a format we can analyze using tools from natural language processing (NLP). We will walk through a typical text analysis process: tokenizing the reports, building a vocabulary, constructing a document-term matrix, and applying TF-IDF to highlight the most distinctive terms. Along the way, we will also examine co-occurrence patterns.</p>
<p>To start, we are going to need a couple of R packages to facilitate our work. <code>text2vec</code> will do most of the work converting the documents into a form of data that we can analyze.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(text2vec)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As for the source of our documents, the Philadelphia Police Department posts (reports)[https://www.phillypolice.com/accountability/ois/] on each officer-involved shooting. I have pulled the data off their website and packaged it into an .RData file. Loading it will create the data frame <code>ois</code>. Details on how to pull the data off of the PPD website are part of my (R4crim collection)[https://github.com/gregridgeway/R4crim?tab=readme-ov-file] of scripts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/PPD OIS.RData"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ois <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>text) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     id                                 location
1 24-37      3450 Vista Street, Philadelphia, PA
2 24-36          3250 A Street, Philadelphia, PA
3 24-35 5450 Chancellor Street, Philadelphia, PA
4 24-32         2950 E. Street, Philadelphia, PA
5 24-31      3350 Willits Road, Philadelphia, PA
6 24-30    6150 Lebanon Avenue, Philadelphia, PA
                                        url       date       lon      lat
1   https://www.phillypolice.com/ois/24-37/ 2024-12-10 -75.03885 40.04022
2   https://www.phillypolice.com/ois/24-36/ 2024-11-12 -75.12714 39.99956
3   https://www.phillypolice.com/ois/24-35/ 2024-11-10 -75.23050 39.95692
4   https://www.phillypolice.com/ois/24-32/ 2024-10-11 -75.12024 39.99345
5   https://www.phillypolice.com/ois/24-31/ 2024-10-03 -75.00908 40.05383
6 https://www.phillypolice.com/ois/ps24-30/ 2024-10-02 -75.24450 39.98175
                                              addrmatch score      addrtype
1      3450 Vista St, Philadelphia, Pennsylvania, 19136   100 StreetAddress
2          3250 A St, Philadelphia, Pennsylvania, 19134   100 StreetAddress
3 5450 Chancellor St, Philadelphia, Pennsylvania, 19139   100 StreetAddress
4          2950 E St, Philadelphia, Pennsylvania, 19134   100 StreetAddress
5    3350 Willits Rd, Philadelphia, Pennsylvania, 19136   100 StreetAddress
6   6150 Lebanon Ave, Philadelphia, Pennsylvania, 19151   100  PointAddress</code></pre>
</div>
</div>
<p>The data include an incident ID, the date of the shooting, the address and coordinates where the shooting occurred, and a URL to the incident report. There is also a column called <code>text</code> containing the full text of the officer-involved shooting report. Some can be long, but here’s the first one as an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ois <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="st">"16-30"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(text) <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Narrative from OIS Report 16-30">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Narrative from OIS Report 16-30
</div>
</div>
<div class="callout-body-container callout-body">
<p>PS#16-30 9/16/16 On Friday, September 16, 2016, at approximately 11:18 P.M., a uniformed sergeant in a marked police vehicle was seated in her parked vehicle in the 5100 block of Sansom Street, when a male approached and without warning, began to discharge a firearm, striking the sergeant, as she remained seated in her vehicle. The offender then began walking east on Sansom Street, stopping at a lounge/bar in the 5100 block of Sansom Street, where he discharged his firearm into the lounge/bar, striking a female employee and a male security guard. The offender continued walking east on Sansom Street to the 4900 block, where he discharged his firearm into an occupied parked vehicle, striking one female and one male occupant. Responding uniformed officers, in marked police vehicles, along with an officer from the University of Pennsylvania police force, located the offender in an alleyway in the rear of the 4800 blocks of Sansom and Walnut Streets. While in the 4800 block of Sansom Street the offender discharged his firearm, striking the University of Pennsylvania Officer as well as a marked police vehicle. Four Officers (one of whom was the University of Pennsylvania Officer) discharged their firearms, striking the offender. The offender fell to the ground and dropped his firearm. Fire Rescue responded and pronounced the offender deceased. The offender’s firearm, a 9MM, semi-automatic pistol, with an obliterated serial number, loaded with 14 live rounds, was recovered at the scene. There were three empty magazines from the offender’s firearm recovered throughout the scene. The sergeant, the University of Pennsylvania Officer, along with the four civilians who were all struck by gunfire, were transported to Penn-Presbyterian Hospital for treatment. The female from the parked vehicle was later pronounced deceased at Penn-Presbyterian Hospital. *** Information posted in the original summary reflects a preliminary understanding of what occurred at the time of the incident. This information is posted shortly after the incident and may be updated as the investigation leads to new information. The DA’s Office is provided all the information from the PPD’s investigation prior to their charging decision.</p>
</div>
</div>
<p>With this set of 133 reports, we will use a variety of data cleaning methods and machine learning methods to try to make sense of these documents.</p>
</section>
<section id="turning-text-into-data-with-text2vec" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Turning text into data with <code>text2vec</code></h1>
<p>To transform the text into a form that is better suited for analysis, we need to go through a number of steps. Part of the reason <code>text2vec</code> is popular is that it can handle large collections of documents. To make the tasks computational efficient there are a number of steps to work through in order to get a usable dataset.</p>
<p>We start by create a “tokenizer,” a process that breaks raw text into individual units like words, phrases, or symbols—called (the “tokens”), the basic building blocks for text analysis. The <code>itoken()</code> function in the <code>text2vec</code> package creates an iterator over a collection of text documents, preparing them for efficient text processing. Instead of transforming all text at once, <code>itoken()</code> streams the documents one at a time, making it well-suited for handling large sets of documents. It “tokenizes” each document using =either a built-in default or a custom tokenizer (which we will do) and produces a structure that can be passed on to other functions that will tidy up the collection of tokens and convert them into a dataset. Because it does not store all tokenized text in memory, <code>itoken()</code> enables fast and memory-efficient text analysis workflows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an iterator over tokens</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   tokens does not actually store data</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   just an efficient means for looping over documents</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># this gets the next batch of documents... for me around 14 documents</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> tokens<span class="sc">$</span><span class="fu">nextElem</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "24-37" "24-36" "24-35" "24-32" "24-31" "24-30" "24-29" "24-28" "24-27"
[10] "24-23" "24-22" "24-21" "24-20" "24-18"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>tokens <span class="sc">|&gt;</span> <span class="fu">sapply</span>(head)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]         [,2]         [,3]         [,4]         [,5]       
[1,] "3400"       "3200"       "5400"       "29oo"       "3300"     
[2,] "block"      "block"      "block"      "block"      "Willits"  
[3,] "of"         "of"         "of"         "of"         "Road\nOn" 
[4,] "Vista"      "A"          "Chancellor" "E."         "Thursday,"
[5,] "Street\nOn" "Street\nOn" "Street\nOn" "Street\nOn" "October"  
[6,] "Tuesday,"   "Tuesday,"   "Sunday,"    "Friday,"    "3,"       
     [,6]         [,7]           [,8]           [,9]          [,10]         
[1,] "6100"       "2600"         "3900"         "2200"        "3000"        
[2,] "block"      "block"        "block"        "block"       "block"       
[3,] "of"         "of"           "of"           "of"          "of"          
[4,] "Lebanon"    "Glenwood"     "Whittaker"    "S."          "Ruth"        
[5,] "Avenue\nOn" "Avenue\nThe"  "Avenue\nThe"  "65th"        "Street\nThe" 
[6,] "Wednesday," "Philadelphia" "Philadelphia" "Street\nThe" "Philadelphia"
     [,11]       [,12]          [,13]       [,14]      
[1,] "6100"      "3500"         "2700"      "1500"     
[2,] "block"     "block"        "block"     "block"    
[3,] "of"        "of"           "of"        "of"       
[4,] "West"      "F"            "North"     "North"    
[5,] "Columbia"  "Street\nA"    "6th"       "57th"     
[6,] "Avenue\nA" "Philadelphia" "Street\nA" "Street\nA"</code></pre>
</div>
</div>
<p>You can see that so far <code>itoken()</code> has pulled in 14 documents and chopped them up into individual words. Notice that the collection of words have some undesirable quirks. For example, there are</p>
<ul>
<li>numbers that we probably do not really care about</li>
<li>unimportant words like “of” (known as “stop words”)</li>
<li>Line feeds <code>\n</code> in between two words</li>
</ul>
<p><code>create_vocabulary()</code> and <code>prune_vocabulary()</code> help us to trim down the words to the ones that we actually care about. <code>create_vocabulary()</code> allows us to provide a list of stop words to remove. <code>stopwords("en")</code> is just such a list. Here are just a few of the 175 English stop words</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"en"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "i"          "me"         "my"         "myself"     "we"        
 [6] "our"        "ours"       "ourselves"  "you"        "your"      
[11] "yours"      "yourself"   "yourselves" "he"         "him"       
[16] "his"        "himself"    "she"        "her"        "hers"      </code></pre>
</div>
</div>
<p>There are lists for several other languages as well, Italian, for example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"it"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ad"    "al"    "allo"  "ai"    "agli"  "all"   "agl"   "alla"  "alle" 
[10] "con"   "col"   "coi"   "da"    "dal"   "dallo" "dai"   "dagli" "dall" 
[19] "dagl"  "dalla"</code></pre>
</div>
</div>
<p>We can also ask consider pairs of words in addition to single words (<code>ngram=1:2</code>). This allows word phrases like “police officer” and “pit bull” to be considered as words.</p>
<p><code>prune_vocabulary()</code> trims down words from our vocabulary that are probably not particularly useful</p>
<ul>
<li>words that few documents use (too rare)</li>
<li>words that too many documents use (too common)</li>
</ul>
<p>We can add in some other filters too, like only using words that are at least three letters and dropping any words that have numbers in them (like 3pm or 9mm).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset to beginning</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Build vocabulary</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   these are the collection of words that I care about</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   skip stopwords (the, of, in, ...)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   include two word phrases (2-gram or bigram), </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#      "police officer", "full uniform", "black male", "drop weapon", "pit bull"</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   skip words that only show up in fewer than 10 documents</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   skip words that are in the majority of documents (police?, discharged?)</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">&lt;-</span> tokens <span class="sc">|&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_vocabulary</span>(<span class="at">stopwords =</span> stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"en"</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ngram =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prune_vocabulary</span>(<span class="at">term_count_min =</span> <span class="dv">10</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">doc_proportion_max =</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(term) <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[0-9]"</span>, term))</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># space_tokenizer(), default, keeps a lot of punctuation</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>vocab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of docs: 133 
175 stopwords: i, me, my, myself, we, our ... 
ngram_min = 1; ngram_max = 2 
Vocabulary: 
                  term term_count doc_count
                &lt;char&gt;      &lt;int&gt;     &lt;int&gt;
  1:               AM,         10        10
  2:        Avenue\nOn         10        10
  3:   District_Police         10        10
  4:         Hospital,         10         9
  5: Penn-Presbyterian         10         8
 ---                                       
552:           firearm        112        63
553:               one        116        65
554:            posted        120        60
555:           vehicle        180        65
556:          offender        182        49</code></pre>
</div>
</div>
<p>Let’s make our own tokenizer instead of using the default. As we see, the default (<code>space_tokenizer()</code>) often retains punctuation, symbols, or other strange features that dilute or fragment our vocabulary. Customizing the tokenizer allows us to tailor the cleaning process to the structure and quirks of the officer-involved shooting reports. The function that we will create, <code>oisTokenizer()</code>, is a custom tokenizer designed to clean and standardize the raw text from officer-involved shooting reports before further text analysis. It converts the text to lowercase, removes common punctuation patterns (like those in abbreviations such as “3 p.m.”), strips out unusual or inconsistent symbols (such as smart quotes, parentheses, and hash symbols), and splits the text into individual tokens using whitespace as the delimiter.</p>
<p>After tokenization, it will also apply “stemming”. Stemming is a text preprocessing technique that reduces words to their root or base form by removing common suffixes. For example, “running”, “runner”, and “runs” might all be reduced to “run”, allowing the model to treat these variations as the same underlying concept. The <code>SnowballC</code> package has a handy <code>wordStem()</code> function in it. Let’s test it out on a few words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"dog"</span>,<span class="st">"dogs"</span>,<span class="st">"office"</span>,<span class="st">"officer"</span>,<span class="st">"officers"</span>,<span class="st">"police"</span>,<span class="st">"policy"</span>,<span class="st">"policies"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  SnowballC<span class="sc">::</span><span class="fu">wordStem</span>(<span class="at">language =</span> <span class="st">"en"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dog"    "dog"    "offic"  "offic"  "offic"  "polic"  "polici" "polici"</code></pre>
</div>
</div>
<p>Conveniently, it makes both “dog” and “dogs” simply “dog”. However, note that it also makes “office”, “officer”, and “officers” all simplified to “office”… maybe not ideal. Since our text will have a lot of “officer” and “officers” and probably very few of any “office”, we will need to remember that this stemming has reduced our “police officers” to “police office”.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># our own custom tokenizer</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>oisTokenizer <span class="ot">&lt;-</span> <span class="cf">function</span>(text)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  text <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tolower</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove abbreviation punctuation (like 3 p.m.)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"([A-z])[,.]+"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove some weird symbols</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"[“”()#]"</span>, <span class="st">""</span>, <span class="at">x=</span>_) <span class="sc">|&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no smart quotes</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"’"</span>, <span class="st">"'"</span>, <span class="at">x=</span>_) <span class="sc">|&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split any words with \n, \t, \r between them</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">strsplit</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stemming</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(SnowballC<span class="sc">::</span>wordStem, <span class="at">language =</span> <span class="st">"en"</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can rerun our documents through our new tokenizer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset to beginning</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    now using our oisTokenizer()</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tokenizer =</span> oisTokenizer,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">&lt;-</span> tokens <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_vocabulary</span>(<span class="at">stopwords =</span> stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"en"</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ngram =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prune_vocabulary</span>(<span class="at">term_count_min =</span> <span class="dv">10</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">doc_proportion_min =</span> <span class="fl">0.05</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">doc_proportion_max =</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(term) <span class="sc">&gt;=</span><span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[0-9]"</span>, term))</span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>vocab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of docs: 133 
175 stopwords: i, me, my, myself, we, our ... 
ngram_min = 1; ngram_max = 2 
Vocabulary: 
                term term_count doc_count
              &lt;char&gt;      &lt;int&gt;     &lt;int&gt;
  1:   advanc_toward         10         7
  2:         announc         10         8
  3: approach_driver         10         9
  4:        cartridg         10         9
  5:  district_place         10        10
 ---                                     
524:           point        105        54
525:         suspect        110        21
526:     inform_post        120        60
527:            post        120        60
528:          offend        308        56</code></pre>
</div>
</div>
<p>Now we have a collection of words and word phrases gathered from our documents. Note that it includes so two word phrases (bigrams) with the two stemmed words combined with an underscore between them.</p>
<section id="creating-a-document-term-matrix-dtm" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="creating-a-document-term-matrix-dtm"><span class="header-section-number">2.1</span> Creating a document-term matrix (DTM)</h2>
<p>Our next destination is to create a “document-term matrix” (DTM). A DTM is a matrix representation of a collection of text documents, where each row corresponds to a document and each column corresponds to a unique term (a word or phrase) from the collection of documents. The values in the matrix typically reflect the number of times each term appears in each document. A DTM transforms the unstructured text into a format that machine learning models can work with.</p>
<p>The first step to getting to a DTM with <code>text2vec</code> is to create a “vectorizer”. A vectorizer translates tokenized text into a numeric matrix format, such as a DTM. <code>vocab_vectorizer()</code> creates a function that will take batches of documents, compare them to the vocabulary we built, and produce the associated components of the DTM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vectorizer</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   helper function to convert streams of text into DTM</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="ot">&lt;-</span> <span class="fu">vocab_vectorizer</span>(vocab)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see what this function looks like!</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>vectorizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (iterator, grow_dtm, skip_grams_window_context, window_size, 
    weights, binary_cooccurence = FALSE) 
{
    vocab_corpus_ptr = cpp_vocabulary_corpus_create(vocabulary$term, 
        attr(vocabulary, "ngram")[[1]], attr(vocabulary, "ngram")[[2]], 
        attr(vocabulary, "stopwords"), attr(vocabulary, "sep_ngram"))
    setattr(vocab_corpus_ptr, "ids", character(0))
    setattr(vocab_corpus_ptr, "class", "VocabCorpus")
    corpus_insert(vocab_corpus_ptr, iterator, grow_dtm, skip_grams_window_context, 
        window_size, weights, binary_cooccurence)
}
&lt;bytecode: 0x00000183ade15968&gt;
&lt;environment: 0x00000183ade145b8&gt;</code></pre>
</div>
</div>
<p>It is a little difficult to interpret, but we can see that it is going to take in a iterator over our tokenized documents and produce something that will (hopefully!) be useful. Let’s give it a try.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the document-term matrix (DTM)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   row represents a document</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   column represents a unique term (word or phrase)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   cell contains the count (or weight) of that term in the document</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>oisDTM <span class="ot">&lt;-</span> <span class="fu">create_dtm</span>(tokens, vectorizer)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>oisDTM[<span class="dv">65</span><span class="sc">:</span><span class="dv">74</span>, <span class="dv">445</span><span class="sc">:</span><span class="dv">454</span>] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> <span class="fu">t</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               20-34 20-33 20-32 20-31 20-30 20-29 20-26 20-24 20-23 20-20
charg_decis        0     0     0     0     0     0     0     0     0     1
decis              0     0     0     0     0     0     0     0     0     1
gunshot            0     0     1     1     0     0     3     2     0     1
incid_inform       0     0     0     0     0     0     0     0     0     1
incid_may          0     0     0     0     0     0     0     0     0     1
inform_ppd         0     0     0     0     0     0     0     0     0     1
investig_lead      0     0     0     0     0     0     0     0     0     1
investig_prior     0     0     0     0     0     0     0     0     0     1
lead               0     0     0     0     0     0     0     0     0     1
lead_new           0     0     0     0     0     0     0     0     0     1</code></pre>
</div>
</div>
<p>We have a DTM! I have picked a few interesting rows and columns. I also transposed the DTM so it is more readable, but typically the rows are documents and columns are terms. You can see a few non-zero counts in this matrix. These indicate which documents include these terms and how many times that term appears in the document.</p>
<p>Let’s explore further.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of documents and words</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(oisDTM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 133 528</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rows represent individual OIS shooting reports</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(oisDTM)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "24-37" "24-36" "24-35" "24-32" "24-31"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># columns are the words/phrases</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(oisDTM)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]     <span class="co"># feature names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "advanc_toward"   "announc"         "approach_driver" "cartridg"       
 [5] "district_place"  "district_polic"  "drop_gun"        "due"            
 [9] "fled_scene"      "gave"           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many vocab words in document?</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(oisDTM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>24-37 24-36 24-35 24-32 24-31 24-30 24-29 24-28 24-27 24-23 24-22 24-21 24-20 
   60    75   123    56    65    67    70    68    49    92    90    90   102 
24-18 24-17 24-15 24-14 24-13 24-12 24-10 24-09 24-08 24-07 24-06 24-05 24-04 
  118    84   105    88   104   154   102   148   125   104   105   188   246 
24-03 24-02 24-01 23-33 23-31 23-29 23-27 23-26 23-25 23-24 23-23 23-21 23-14 
  107    97   107    80   148    81   147   119    99    98   112   110   101 
23-13 23-10 23-04 22-27 22-26 22-24 22-22 22-15 22-14 22-10 22-09 22-08 22-07 
   79    99   162   116   175   114    94   173   132   254   102   105   113 
22-06 22-05 22-04 22-03 22-01 21-15 21-14 21-12 21-10 21-09 21-06 21-04 20-34 
  185   140    89    99    96    93    92   167   163    70   109   175    65 
20-33 20-32 20-31 20-30 20-29 20-26 20-24 20-23 20-20 20-15 20-12 20-08 20-07 
  159   143   106   124   115   292   135   104   210   122   132   145   109 
19-23 19-21 19-20 19-14 19-13 19-11 19-09 19-06 19-04 18-28 18-27 18-26 18-25 
  139   114   172    98   158   124   172   146   137   143   142   144   126 
18-22 18-19 18-17 18-16 18-12 18-08 18-02 18-01 17-37 17-36 17-30 17-28 17-25 
  104   118   141   142    95   100   110   155   153   109    86    86   112 
17-23 17-22 17-20 17-19 17-17 17-13 17-03 16-43 16-40 16-38 16-37 16-35 16-34 
  143   112   101   115   129   122   143   148   158   119   169   145    95 
16-33 16-32 16-30 16-29 16-28 16-19 16-18 16-16 16-13 16-12 16-11 16-10 16-07 
  182   149   151   135   106   100   122   113   117   138   143   137   127 
16-03 16-02 16-01 
  181   139   121 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many documents have these words?</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisDTM)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  advanc_toward         announc approach_driver        cartridg  district_place 
             10              10              10              10              10 
 district_polic        drop_gun             due      fled_scene            gave 
             10              10              10              10              10 
    ground_drop      hand_offic   hospit_critic    hospit_polic            june 
             10              10              10              10              10 
          knock            lost          notifi      offic_drew      offic_oper 
             10              10              10              10              10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most common words?</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisDTM) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     offend inform_post        post     suspect       point        door 
        308         120         120         110         105         103 
      shoot         two       avenu         dog 
        102         101          99          93 </code></pre>
</div>
</div>
</section>
<section id="term-frequencyinverse-document-frequency" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="term-frequencyinverse-document-frequency"><span class="header-section-number">2.2</span> Term Frequency–Inverse Document Frequency</h2>
<p>While raw term counts in a document-term matrix tell us how often each word appears, they do not account for how informative or distinctive those words are across the entire collection of documents. Common words like “officer” or “incident” may appear frequently in every report, but they are not useful for distinguishing one document from another. Term frequency-inverse document frequency (TF-IDF) improves on this by weighting terms based on how frequently they appear in a specific document and how rare they are across all documents. This highlights terms that are both common within a document and uncommon elsewhere, making them more meaningful for identifying the unique content of each report.</p>
<p>Term Frequency-Inverse Document Frequency (TF-IDF) gives weights to words in a document in a way that balances:</p>
<ol type="1">
<li><em>Term Frequency</em> (TF): This word must be important in this document</li>
</ol>
<ul>
<li>The more a word appears in a document, the more likely it is to be relevant to the document’s content</li>
<li>If the word “shooting” appears 12 times in a police report, it is probably central to that document</li>
</ul>
<ol start="2" type="1">
<li><em>Inverse Document Frequency</em> (IDF): But if it appears in every document, it is not very informative</li>
</ol>
<ul>
<li>Common words like “officer”, “incident”, or “said” might appear everywhere</li>
<li>IDF <em>downweights</em> those high-frequency but low-discrimination terms</li>
<li>It prefers terms that help <em>distinguish</em> one document from others</li>
</ul>
<p>The formula for TF-IDF for document <span class="math inline">\(i\)</span> and term <span class="math inline">\(j\)</span>:</p>
<p><span class="math display">\[
\mathrm{tfidf}_{ij} = \mathrm{TF}_{ij}\log\frac{N}{\mathrm{DF}_j}
\]</span> where</p>
<ul>
<li><span class="math inline">\(\mathrm{TF}\)</span> is the number of times term <span class="math inline">\(j\)</span> appears in document <span class="math inline">\(i\)</span>. It measures the importance of the term within a document</li>
<li><span class="math inline">\(N\)</span> = total number of documents</li>
<li><span class="math inline">\(\mathrm{DF}_j\)</span> = number of documents containing term <span class="math inline">\(j\)</span></li>
</ul>
<p><span class="math inline">\(\mathrm{IDF}_{ij}=\log\frac{N}{\mathrm{DF}_j}\)</span> captures the rarity across documents. Note that if a word appears in all documents then <span class="math inline">\(\mathrm{tfidf}_{ij} = 0\)</span>. The combination of <span class="math inline">\(\mathrm{TF}\)</span> and <span class="math inline">\(\mathrm{IDF}\)</span> gives a measure of relevance and distinctiveness. A high <span class="math inline">\(\mathrm{tfidf}_{ij}\)</span> means a term appears often in document <span class="math inline">\(i\)</span>, but rarely in other documents. It gives you terms that define a document. These are the terms that are useful for classification, clustering, or topic modeling.</p>
<section id="example" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="example"><span class="header-section-number">2.2.1</span> Example</h3>
<p>Assume there are <span class="math inline">\(N=100\)</span> documents.</p>
<table class="table">
<thead>
<tr class="header">
<th>Term</th>
<th>TF in Doc A</th>
<th>DF across corpus</th>
<th>IDF</th>
<th>TF-IDF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“weapon”</td>
<td>5</td>
<td>10</td>
<td>2.3</td>
<td>11.5</td>
</tr>
<tr class="even">
<td>“officer”</td>
<td>6</td>
<td>95</td>
<td>0.1</td>
<td>0.3</td>
</tr>
<tr class="odd">
<td>“said”</td>
<td>20</td>
<td>100</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<ul>
<li>“weapon” gets a high score, specific and relevant</li>
<li>“officer” is common, downweighted</li>
<li>“said” is everywhere, zeroed out</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TF-IDF: term frequency–inverse document frequency weights</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    downweights common words that appear in many documents</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    upweights rare words that are more informative or distinctive</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># TF: How often a word appears in a document</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># IDF: How rare that word is across all documents</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#    TF-IDF = TF × log(N / DF)</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#       N = total number of documents</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#       DF = number of documents containing the term</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>tfidf_transformer <span class="ot">&lt;-</span> TfIdf<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>oisTFIDF <span class="ot">&lt;-</span> tfidf_transformer<span class="sc">$</span><span class="fu">fit_transform</span>(oisDTM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at those same rows and columns that we did before for the DTM. The matrix looks largely the same, just everything scaled down.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>oisTFIDF[<span class="dv">65</span><span class="sc">:</span><span class="dv">74</span>, <span class="dv">445</span><span class="sc">:</span><span class="dv">454</span>] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               20-34 20-33 20-32 20-31 20-30 20-29 20-26 20-24 20-23 20-20
charg_decis        0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
decis              0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
gunshot            0     0  0.01  0.01     0     0  0.02  0.02     0  0.01
incid_inform       0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
incid_may          0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
inform_ppd         0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
investig_lead      0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
investig_prior     0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
lead               0     0  0.00  0.00     0     0  0.00  0.00     0  0.01
lead_new           0     0  0.00  0.00     0     0  0.00  0.00     0  0.01</code></pre>
</div>
</div>
<p>Let’s compare the top features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View top features by TF</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisDTM) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     offend inform_post        post     suspect       point        door 
        308         120         120         110         105         103 
      shoot         two       avenu         dog 
        102         101          99          93 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View top features by TF-IDF</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisTFIDF) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      offend          dog      suspect philadelphia  inform_post         post 
   2.9928661    2.0769953    1.7502536    1.1204332    1.1029141    1.1029141 
       shoot        knife        avenu       victim 
   1.0784460    1.0605790    1.0338190    0.9726278 </code></pre>
</div>
</div>
<p>The TF-IDF does change which terms make the top-10 list. We see “knife” and “driver” show up and “door” and “point” drop off.</p>
<p>Why does “inform_post” show up in this list? “Information posted” was very common in reports before 2020.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>oisDTM[,<span class="st">"inform_post"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>24-37 24-36 24-35 24-32 24-31 24-30 24-29 24-28 24-27 24-23 24-22 24-21 24-20 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
24-18 24-17 24-15 24-14 24-13 24-12 24-10 24-09 24-08 24-07 24-06 24-05 24-04 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
24-03 24-02 24-01 23-33 23-31 23-29 23-27 23-26 23-25 23-24 23-23 23-21 23-14 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
23-13 23-10 23-04 22-27 22-26 22-24 22-22 22-15 22-14 22-10 22-09 22-08 22-07 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
22-06 22-05 22-04 22-03 22-01 21-15 21-14 21-12 21-10 21-09 21-06 21-04 20-34 
    0     0     0     0     0     0     0     0     0     0     0     0     0 
20-33 20-32 20-31 20-30 20-29 20-26 20-24 20-23 20-20 20-15 20-12 20-08 20-07 
    0     0     0     0     0     0     0     0     2     2     2     2     2 
19-23 19-21 19-20 19-14 19-13 19-11 19-09 19-06 19-04 18-28 18-27 18-26 18-25 
    2     2     2     2     2     2     2     2     2     2     2     2     2 
18-22 18-19 18-17 18-16 18-12 18-08 18-02 18-01 17-37 17-36 17-30 17-28 17-25 
    2     2     2     2     2     2     2     2     2     2     2     2     2 
17-23 17-22 17-20 17-19 17-17 17-13 17-03 16-43 16-40 16-38 16-37 16-35 16-34 
    2     2     2     2     2     2     2     2     2     2     2     2     2 
16-33 16-32 16-30 16-29 16-28 16-19 16-18 16-16 16-13 16-12 16-11 16-10 16-07 
    2     2     2     2     2     2     2     2     2     2     2     2     2 
16-03 16-02 16-01 
    2     2     2 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># highlight the word "post" in the report</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crayon)</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a>ois <span class="sc">|&gt;</span> </span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(id<span class="sc">==</span><span class="st">"20-20"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(text) <span class="sc">|&gt;</span> </span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gsub</span>(<span class="st">"post"</span>, bgYellow<span class="sc">$</span><span class="fu">black</span>(<span class="st">"post"</span>), <span class="at">x=</span>_) <span class="sc">|&gt;</span> </span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>6th Street and McKean
On Tuesday June 23, 2020 at approximately 4:49 p.m., officer assigned to Criminal Intelligence in plainclothes and unmarked vehicle. While on patrol, information was received from police radio of a large crowd gathering and gunshots in the area of 6th street and McKean. The officers began to monitor the Real Time Crime camera at 500 McClellan Street. While watching the camera, a black male wearing a blue ball cap, white t-shirt, and gray shorts, later identified as G.T. 32/ B/M, reached inside the driver’s side door of a gold Buick and removed a black handgun and placed it inside of his waistband. The officers requested marked patrol units to proceed to the area.
The Officers were traveling northbound on 5th street approaching Sigel. One plainclothes officer exited the unmarked vehicle and heard G.T. shout “Cops! Cops! Cops!” then pulled the gun from his waistband and run east bound on Sigel Street. While Topping was running, his right arm was pointed back towards the officers, and fired (3) three shots in the officers direction (captured on audio/video). One of the plainclothes officers fired two times from inside the vehicle and exited giving chase. G.T. fired several more times towards the officers and the same officer returned fired (2) two more times. G.T. dropped his gun in the street while running and was arrested on 4th street near Mifflin. Deft Topping’s gun, a Glock 9MM was loaded with 4 live rounds in the magazine and 1in the chamber, and was recovered next to deft G.T.’s blue baseball cap.
The discharging officer returned to the unmarked police vehicle and observed several males inside the vehicle, removing items. That officer engaged a male on the corner of 5th and McClellan, later identified as W.C., who punched the officer in the face. The officer placed W.C. under arrest.
A Sergeant of Real Time Crime Center was inside his headquarters monitoring the police camera located at 500 McClellan Street. The sergeant observed several black males enter the unmarked police vehicle. One male was wearing a gray T-shirt with a “NASA” logo on the front, blue jeans and a black baseball cap enter the rear driver’s side door and the front door, removing several cell phones, later identified as Q.R., 23/B/M. The sergeant gave a description over police radio and the discharging officer placed Q.R.under arrest. The officer’s cell phones were returned by civilians in the area.
Video from the Real Time Crime Camera and several private residents was recovered of the incident.
There was no reported injuries to Police or Civilians.
*** Information posted in the original summary reflects a preliminary understanding of what occurred at the time of the incident. This information is posted shortly after the incident and may be updated as the investigation leads to new information. The District Attorney’s Office is provided all the information from the PPD’s investigation prior to their charging decision.</code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="term-co-occurrence-matrix-tcm" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Term co-occurrence matrix (TCM)</h1>
<p>A term co-occurrence matrix (TCM) captures how often pairs of words appear near each other within a given window of text, such as a sentence or a few neighboring words. Unlike a document-term matrix, which represents the relationship between documents and individual terms, a TCM focuses on the relationships between terms themselves. This is useful for uncovering word associations, identifying common phrases, and building more advanced representations like word embeddings. In our case, we will use the TCM to explore how certain words, such as “officer,” “suspect,” or “weapon,” tend to co-occur across police shooting reports, revealing patterns that might not be visible from frequency counts alone.</p>
<p>When scanning through each document, setting <code>skip_grams_window = 5</code> will treat any two terms that appear within a window of 5 tokens as co-occurring. For example, if the document has the phrase “the officer shot the suspect with a weapon” and we set <code>skip_grams_window = 5</code>, then for the word “shot” it will consider “the”, “officer”, “the”, “suspect”, “with” as co-occurring terms.</p>
<p>We will use <code>create_tcm()</code> to create a TCM. The <span class="math inline">\((i,j)\)</span> element of the TCm will be the number of times term <span class="math inline">\(i\)</span> occurs within 5 terms of term <span class="math inline">\(j\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a co-occurrence matrix (Feature Co-occurrence Matrix)</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>oisTCM <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tokenizer =</span> oisTokenizer,</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">FALSE</span>,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id) <span class="sc">|&gt;</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_tcm</span>(<span class="fu">vocab_vectorizer</span>(vocab), </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">skip_grams_window =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will be a little easier to visualize if we convert to a long (rather than wide) format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to triplet format and extract top co-occurring pairs</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>oisPairs <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">summary</span>(oisTCM) <span class="sc">|&gt;</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(i <span class="sc">!=</span> j) <span class="sc">|&gt;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">feature1 =</span> i, <span class="at">feature2 =</span> j, <span class="at">weight =</span> x) <span class="sc">|&gt;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">feature1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(oisTCM),</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">term1 =</span> <span class="fu">colnames</span>(oisTCM)))  <span class="sc">|&gt;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">feature2 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(oisTCM),</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">term2 =</span> <span class="fu">colnames</span>(oisTCM))) <span class="sc">|&gt;</span></span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>feature1, <span class="sc">-</span>feature2) <span class="sc">|&gt;</span></span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term1 <span class="sc">!=</span> term2) <span class="sc">|&gt;</span></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(term1, <span class="fu">fixed</span>(term2)) <span class="sc">&amp;</span> </span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">str_detect</span>(term2, <span class="fu">fixed</span>(term1)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Joining with `by = join_by(feature1)`
Joining with `by = join_by(feature2)`</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>oisPairs <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight)) <span class="sc">|&gt;</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   weight                  term1               term2
1    30.0         investig_prior        ppd_investig
2    30.0             inform_ppd       provid_inform
3    30.0           offic_provid       provid_inform
4    30.0               lead_new          new_inform
5    30.0                   lead                 new
6    30.0          investig_lead      updat_investig
7    30.0              may_updat      updat_investig
8    30.0              incid_may           may_updat
9    30.0              incid_may         short_incid
10   30.0           incid_inform         inform_post
11   30.0           incid_inform          time_incid
12   30.0             occur_time          time_incid
13   30.0             occur_time    understand_occur
14   30.0 preliminari_understand    understand_occur
15   30.0             understand         preliminari
16   30.0 preliminari_understand reflect_preliminari
17   30.0    reflect_preliminari     summari_reflect
18   30.0                reflect             summari
19   30.0                summari              origin
20   30.0         origin_summari         post_origin
21   30.0                reflect         preliminari
22   30.0            post_origin         inform_post
23   30.0         origin_summari     summari_reflect
24   30.0          investig_lead            lead_new
25   30.0             inform_ppd        ppd_investig
26   30.0                 origin                post
27   30.0             post_short         short_incid
28   30.0             post_short         inform_post
29   29.5            prior_charg      investig_prior
30   29.5             ***_inform         inform_post
31   29.5            prior_charg         charg_decis
32   25.0                 affair              intern
33   24.0         officer-involv               shoot
34   24.0                 outcom                pend
35   24.0              administr               place
36   24.0              administr                duti
37   23.5                   duti                pend
38   23.5              duti_pend      administr_duti
39   23.0              duti_pend         pend_outcom
40   23.0         administr_duti     place_administr
41   22.5           polic_depart  philadelphia_polic
42   21.5               da_offic        offic_provid
43   21.5              inform_da          new_inform
44   21.5               da_offic           inform_da
45   20.0           ppd_investig               prior
46   20.0                   lead          new_inform
47   20.0                   lead      updat_investig
48   20.0          investig_lead               updat
49   20.0              incid_may               updat
50   20.0            short_incid                post</code></pre>
</div>
</div>
<p>Much of this co-occurrence is due to the template language describing where the department is in the investigation, referrals to the district attorney, and the report offers preliminary summary.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Template language on the report">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Template language on the report
</div>
</div>
<div class="callout-body-container callout-body">
<p>*** Information posted in the original summary reflects a preliminary understanding of what occurred at the time of the incident. This information is posted shortly after the incident and may be updated as the investigation leads to new information. The District Attorney’s Office is provided all the information from the PPD’s investigation prior to their charging decision.</p>
</div>
</div>
<p>Further on down the list some term pairs a more interesting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>oisPairs <span class="sc">|&gt;</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(weight <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">&amp;</span> weight <span class="sc">&lt;=</span><span class="dv">9</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     weight                 term1             term2
1  9.000000        firearm_strike  discharg_firearm
2  9.000000                  open              door
3  9.000000                driver              door
4  9.000000        univers_hospit             templ
5  8.999996             duti_pend             place
6  8.750000                attack               dog
7  8.666667         respond_radio              call
8  8.666667 affair_officer-involv            intern
9  8.666667 affair_officer-involv             shoot
10 8.599997             inform_da            provid
11 8.599997              da_offic               new
12 8.599997             inform_da              lead
13 8.500000            offic_mark        mark_polic
14 8.500000       inform_district        new_inform
15 8.500000        attorney_offic      offic_provid
16 8.500000       inform_district district_attorney
17 8.500000             incid_***       inform_post
18 8.500000    philadelphia_polic       polic_offic
19 8.500000                return              fire
20 8.500000                intern              pend
21 8.500000          semi-automat            pistol
22 8.500000                  drop            offend
23 8.250000           pend_outcom     intern_affair
24 8.250000         outcom_intern         duti_pend
25 8.250000                outcom            affair
26 8.250000                  miss            offend
27 8.250000                 knife              drop
28 8.000001                unmark      polic_vehicl
29 8.000000                 arriv             locat</code></pre>
</div>
</div>
</section>
<section id="singular-value-decomposition-for-text" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Singular value decomposition for text</h1>
<p>We already explored how SVD can be used to (compress images and classify emojis)[https://raw.githack.com/gregridgeway/ML4SocialScience/main/L7-svd.html]. Now we will explore what SVD does for text.</p>
<p>Since TFIDF matrices can get large, we will use the SVD implementation in the IRLBA package (Implicitly Restarted Lanczos Bidiagonalization Algorithm). The IRLBA implementation of SVD allows you to limit the number of singular vectors to compute, ignoring and never computing the rest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(irlba)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>oisSVD <span class="ot">&lt;-</span> <span class="fu">irlba</span>(<span class="fu">t</span>(oisTFIDF), <span class="at">nv =</span> <span class="dv">50</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># each run of SVD can switch the signs on U and V</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    this forces sign(v[1,]) = +1, so SVD is unique</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>oisSVD<span class="sc">$</span>u <span class="ot">&lt;-</span> <span class="fu">sweep</span>(oisSVD<span class="sc">$</span>u, <span class="dv">2</span>, <span class="fu">sign</span>(oisSVD<span class="sc">$</span>v[<span class="dv">1</span>,]), <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>oisSVD<span class="sc">$</span>v <span class="ot">&lt;-</span> <span class="fu">sweep</span>(oisSVD<span class="sc">$</span>v, <span class="dv">2</span>, <span class="fu">sign</span>(oisSVD<span class="sc">$</span>v[<span class="dv">1</span>,]), <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see how many singular vectors seem important. In <a href="#fig-SVDsingularvalues" class="quarto-xref">Figure&nbsp;1</a> we see the first two or three singular values seem large, but then they decrease quite slowly from there.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(oisSVD<span class="sc">$</span>d, </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Index of the singular value"</span>, <span class="at">ylab=</span><span class="st">"Singular value"</span>,</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(oisSVD<span class="sc">$</span>d)),</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-SVDsingularvalues" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SVDsingularvalues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-SVDsingularvalues-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SVDsingularvalues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Singular values from SVD of <code>oisTFIDF</code>
</figcaption>
</figure>
</div>
</div>
</div>
<p>The columns of <span class="math inline">\(\mathbf{U}\)</span> are our “eigendocuments,” the fundamental building blocks that the actual documents blend to form their word collections. We will take a look at the first five eigendocuments, highlighting the 10 terms with the highest weight in the left singular vectors. Note that both large positive and large negative values are important to interpret. I have added headings to each left singular vector summarizing what kinds of incidents might heavily weight this column of <span class="math inline">\(\mathbf{U}\)</span>.</p>
<p>Note that “dog” shows up with a large absolute value in the first three left singular vectors. Even if there is a large negative value, that still means the term is important. A report of shooting a pit bull will have a large negative value for its <span class="math inline">\(v_2\)</span>, signalling a heavy presence of dog, pit bull, and attack terms, but the absence of the “offender” term. The first left singular vector measure the combined presence of “dog,” “offender,” and “suspect” (or the absence of all three if a document’s value of <span class="math inline">\(v_1\)</span> is large and negative.</p>
<div class="cell" data-caption="Top 10 Terms for First 5 SVD Components">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack the top 10 terms from each component into one long table</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">term=</span><span class="fu">colnames</span>(oisTFIDF),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">u1=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">1</span>],</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">u2=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">2</span>],</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">u3=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">3</span>],</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">u4=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">4</span>],</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">u5=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">5</span>])</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a><span class="fu">bind_rows</span>(a <span class="sc">|&gt;</span></span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(term, u1) <span class="sc">|&gt;</span> </span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>            <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u1))) <span class="sc">|&gt;</span> </span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>            <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u1"</span>, <span class="at">u =</span> u1),</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>          a <span class="sc">|&gt;</span> </span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(term, u2) <span class="sc">|&gt;</span> </span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u2))) <span class="sc">|&gt;</span> </span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>            <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u2"</span>, <span class="at">u =</span> u2),</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>          a <span class="sc">|&gt;</span> </span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(term, u3) <span class="sc">|&gt;</span> </span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u3))) <span class="sc">|&gt;</span> </span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>            <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u3"</span>, <span class="at">u =</span> u3),</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>          a <span class="sc">|&gt;</span> </span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(term, u4) <span class="sc">|&gt;</span> </span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u4))) <span class="sc">|&gt;</span> </span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>            <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u4"</span>, <span class="at">u =</span> u4),</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>          a <span class="sc">|&gt;</span> </span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>            <span class="fu">select</span>(term, u5) <span class="sc">|&gt;</span> </span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>            <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u5))) <span class="sc">|&gt;</span> </span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>            <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u5"</span>, <span class="at">u =</span> u5)) <span class="sc">|&gt;</span> </span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(component, term, u) <span class="sc">|&gt;</span> </span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(component) <span class="sc">|&gt;</span> </span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> component, </span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(term, u),</span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term_u1, u_u1, term_u2, u_u2, term_u3, u_u3,</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>         term_u4, u_u4, term_u5, u_u5) <span class="sc">|&gt;</span></span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">align =</span> <span class="st">"rrrrrrrrrr"</span>,</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">(u_1</span><span class="sc">\\</span><span class="st">)"</span>,<span class="st">"Term"</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">(u_2</span><span class="sc">\\</span><span class="st">)"</span>,</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Term"</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">(u_3</span><span class="sc">\\</span><span class="st">)"</span>,<span class="st">"Term"</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">(u_4</span><span class="sc">\\</span><span class="st">)"</span>,</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"Term"</span>,<span class="st">"</span><span class="sc">\\</span><span class="st">(u_5</span><span class="sc">\\</span><span class="st">)"</span>),</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>        <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">"Offender and dog"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Dog attack, no offender"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Suspect/SWAT"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Knife attacks"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Victims"</span> <span class="ot">=</span> <span class="dv">2</span>),</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>                   <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Offender and dog
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Dog attack, no offender
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Suspect/SWAT
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Knife attacks
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Victims
</div></th>
</tr>
<tr class="odd">
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_1\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_2\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_3\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_4\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_5\)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">dog</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">dog</td>
<td style="text-align: right;">0.45</td>
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">-0.59</td>
<td style="text-align: right;">knife</td>
<td style="text-align: right;">-0.46</td>
<td style="text-align: right;">knife</td>
<td style="text-align: right;">-0.51</td>
</tr>
<tr class="even">
<td style="text-align: right;">offend</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">-0.31</td>
<td style="text-align: right;">dog</td>
<td style="text-align: right;">0.36</td>
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">0.28</td>
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">-0.32</td>
</tr>
<tr class="odd">
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">attack</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">swat</td>
<td style="text-align: right;">-0.19</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">drop_knife</td>
<td style="text-align: right;">-0.19</td>
</tr>
<tr class="even">
<td style="text-align: right;">philadelphia</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">bull</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">attack</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">number</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">-0.19</td>
</tr>
<tr class="odd">
<td style="text-align: right;">shoot</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">pit_bull</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">number_one</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="even">
<td style="text-align: right;">attack</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">pit</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">swat_offic</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">drop_knife</td>
<td style="text-align: right;">-0.19</td>
<td style="text-align: right;">number</td>
<td style="text-align: right;">-0.16</td>
</tr>
<tr class="odd">
<td style="text-align: right;">philadelphia_polic</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">philadelphia</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">victim</td>
<td style="text-align: right;">-0.18</td>
<td style="text-align: right;">number_one</td>
<td style="text-align: right;">-0.15</td>
</tr>
<tr class="even">
<td style="text-align: right;">resid</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">number</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">rear</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">victim</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">philadelphia_polic</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">bull</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">drop</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">unmark</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="even">
<td style="text-align: right;">avenu</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">inform_post</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">pit_bull</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">bedroom</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">passeng</td>
<td style="text-align: right;">0.13</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>Remember that the columns of <span class="math inline">\(\mathbf{V}\)</span> tell us how a particular report mixes together the eigendocuments (columns of <span class="math inline">\(\mathbf{U}\)</span>) to form their TFIDF weighted terms. I am curious to explore documents involving dog attacks (<span class="math inline">\(\mathbf{u}_2\)</span>) and documents with knife attacks (<span class="math inline">\(\mathbf{u}_4\)</span>). The code below creates an interactive 2D map of documents on their values of <span class="math inline">\(v_2\)</span> and <span class="math inline">\(v_4\)</span>. For each document, the code extracts the 10 most heavily weighted TF-IDF terms to use as hover text, giving a quick sense of the content. It also assigns each document to a category, “Likely dog attack,” “Likely knife attack,” or “Other,” based on thresholds of <span class="math inline">\(v_2\)</span> and <span class="math inline">\(v_4\)</span>. <code>plotly()</code> produces an interactive scatterplot where each point is a document, colored by category and annotated with its key terms. This visualization allows us to explore thematic variation in the reports and visually distinguish different types of incidents based on the language used.</p>
<div class="cell" data-caption="Plot of how documents weigh 2nd and 4th left singular vectors">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="co"># collect the 10 terms with the highest weight in each document</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">apply</span>(oisTFIDF, <span class="dv">1</span>, order, <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">apply</span>(i, <span class="dv">2</span>, </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>           <span class="cf">function</span>(j) </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>           {</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>             <span class="fu">colnames</span>(oisTFIDF)[j[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]] <span class="sc">|&gt;</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>               <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>           })</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a><span class="co"># label some document types</span></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">case_when</span>(oisSVD<span class="sc">$</span>v[,<span class="dv">2</span>] <span class="sc">&gt;</span>  <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"Likely dog attack"</span>,</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>                   oisSVD<span class="sc">$</span>v[,<span class="dv">4</span>] <span class="sc">&lt;</span> <span class="sc">-</span><span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"Likely knife attack"</span>,</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>groupCols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Likely dog attack"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Likely knife attack"</span> <span class="ot">=</span> <span class="st">"orange"</span>,</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>)</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot with hovertext</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">x =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">2</span>],</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">4</span>],</span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> a,</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> group,</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">colors =</span> groupCols,</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">6</span>)) <span class="sc">|&gt;</span></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"V2 - Dog attack measure"</span>),</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"V4 - Knife attack measure"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-documentMap" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-documentMap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-89fba8abc10a24430793" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-89fba8abc10a24430793">{"x":{"visdat":{"d1f07e8fb44":["function () ","plotlyVisDat"]},"cur_data":"d1f07e8fb44","attrs":{"d1f07e8fb44":{"x":[0.17403511249172943,0.11289626209213635,0.0062064039784652542,0.16906245122035204,0.030852496447168698,0.17366552107306318,0.12271903040311821,0.08200240143734866,0.074036783220666064,0.16288335904442253,0.15960187600614784,0.063144711893847918,0.050862745169919711,0.19915839045803696,0.040374029162718331,0.14222723818173216,0.25185720339605089,0.20516638044255495,0.030951505094374936,0.15240552895507098,0.0185058835049184,0.19770559799559667,0.060358795881777075,0.16338131592910579,-0.01540175897089799,-0.011666836382860838,0.0464997444349418,0.055463231366217863,0.15396431220227516,0.12990863788178539,0.05514327863097214,0.13537269157860513,0.0451526106706635,0.15229025848972391,0.01638772518870148,0.043476058007198198,0.016251441185000683,-0.0057677296095977161,-0.030961872252845427,0.0097163042307444498,-0.044740736149371116,-0.022927268376320583,-0.014651848740927528,0.03410019488569118,-0.10232360976819424,-0.075552611645860843,0.013653148051798344,7.0505769682181645e-07,-0.0061023053772365715,0.016471407436168772,-0.047599138636601909,-0.076077482407519451,0.0024356929651386363,-0.069041121590329754,-0.039005279953318768,-0.002872200408998962,0.010370541134446907,-0.075625523593923646,-0.054966672351712917,-0.0046536533722787909,-0.040453350009204844,-0.039358075324354605,-0.018780433202819226,-0.042087011487686135,-0.055808856467332642,-0.045006661794226167,-0.0019624112302027031,-0.015667472603067625,-0.027913739450036851,-0.053879648484018668,-0.051196864075046984,-0.033628283545147637,-0.041563522367158205,-0.04210603478961903,-0.045654593136369562,-0.048412311606166533,-0.050034581786788886,-0.060011230216487473,-0.051085574424770734,-0.041521464541494219,-0.048683365384765961,-0.071322458169833264,-0.048449629855757216,-0.052862562072989609,-0.055931460389154891,-0.063410869124554695,-0.061826960560386141,-0.047406768440816635,-0.051629388854604122,-0.040625732581072216,-0.05541655881228473,-0.062093808122609742,-0.061229511371228069,-0.061446168709819629,-0.04276694312041663,-0.09551110243128523,-0.094001264552999564,-0.079169619206258701,-0.10592745697160257,-0.072150607134067388,-0.074338549346075436,-0.076712116675115585,-0.085252040501025972,-0.12804454544623733,-0.11427585439184113,-0.073572951877911227,-0.092810950589979208,-0.071688952634583733,-0.074795060600143973,-0.10683203015107637,-0.125891120075214,-0.081212508137546435,-0.10506057855001295,-0.11638289628351871,-0.099540212355649693,-0.086923877580052752,-0.093891519316653058,-0.098305782952640863,-0.086431581496919097,-0.091325952939032728,-0.075014171935932156,-0.084735879576295844,-0.075678496766346012,-0.083129833390233679,-0.093285193998507862,-0.091451035664770072,-0.090579268201874716,-0.10802623688009402,-0.09721332684512432,-0.091092179335945225,-0.084060031919606912,-0.082613030872556226,-0.098015673744956844],"y":[0.0072562456194927337,-0.027985844957994891,-0.024927406879137051,-0.0042293916372493218,0.012814794813833937,-7.9951175398615629e-05,0.038880665470788091,0.032667716214001254,0.024446758701253919,-0.0059557311814732363,0.030007452945903585,0.090203302184098388,0.13644671053655158,0.0076264959533838541,0.089899005449614516,0.0048561224790992716,0.046963149676558423,0.024917622453677606,0.14761874271447448,0.005353531421616757,-0.055742304598942527,0.01756478121131572,0.089845359901751659,0.0059771019319881432,-0.013236634665180293,0.049752526069711749,0.037895470529230209,0.063994651829720611,-0.0084649624171176576,0.00062868963714063624,0.061667258074771872,-0.029892949164587262,0.03118713554741441,0.0078527160276398236,0.013666431859450705,-0.01659547871266526,0.027713111122862403,-0.0083692630433785196,-0.0875590635504504,-0.051706504387758319,-0.036593716027397243,-0.0065188932502726728,-0.048668355689995335,-0.015975589620167329,-0.12051991816026016,-0.16637192465552086,-0.12780107973677168,-0.049632043640798235,-0.075587209897570173,-0.034916308511252048,-0.0066253456285865035,-0.33762260384724246,-0.022740831399483893,-0.054147538553585006,-0.016149572286303194,-0.098719704185961002,-0.040011017693335232,-0.12855203257173847,-0.10394555153909231,-0.032670734236524029,-0.030862575851361592,-0.019389439189609708,-0.08576717525098039,-0.015600644382327207,-0.15659098066168026,-0.32919070651667209,0.096944372076398791,-0.079515327858367277,0.096041696917232716,-0.37716976007149461,-0.064107222308308925,-0.029114138715683281,-0.021895159530379411,-0.0082774492458311533,0.0019347547577029649,0.028919703531361161,0.028244096762175302,0.051842630284998518,-0.010487174856353802,0.050176247047569872,-0.041120318538480326,0.053926385457844818,0.056969108215367499,0.0086163909139656651,0.028321657771606237,0.0033703947577085279,-0.16057075503061424,-0.081521573845611012,0.0048661443808195948,-0.029362879306646564,0.03604154854506357,0.042838362911569734,0.05618994173892404,0.0028217734702188184,0.018035068216001097,0.011824971895752601,0.096900026880805096,0.034681761029573037,0.17517427936036542,0.048924377662796982,0.066198229445956824,-0.10360531858695916,0.086713750368325113,0.19415013556528926,0.23135392475519256,0.03224607690492725,0.031219524215839969,0.0064070077415623403,0.028604506920263704,-0.029309364323521124,0.24933684834841924,0.024838254105338686,0.088599440463559206,0.12891851646544114,-0.11894646517516755,0.11989341930276956,0.021440116408686524,0.0086833311100361979,-0.05926918289850263,0.028034460758916434,0.025790950485206368,0.047382489563737321,0.046688598471513555,-0.023116343338182892,0.029446605705037619,0.031798816253904183,-0.0032081067926483611,0.015902311756652698,-0.0020100423751663729,0.048980385349268199,0.030754009371904614,0.054486461771980466,0.043212924866865322],"mode":"markers","text":["dog<br />narcot<br />back<br />secur<br />unit<br />insid_properti<br />compli<br />onc<br />tuesday<br />retreat","dog<br />district_offic<br />femal<br />polic_district<br />bedroom<br />officer-involv<br />officer-involv_shoot<br />insid<br />kill<br />locat_offic","servic<br />sergeant<br />year<br />wit<br />involv<br />male_point<br />investig_unit<br />home<br />unknown<br />complain","dog<br />narcot<br />block_e<br />resid<br />retreat<br />involv_shoot<br />kitchen<br />offic_involv<br />bull<br />pit_bull","detect<br />shoot<br />seat<br />person<br />unit<br />homicid<br />philadelphia<br />vehicl_approach<br />investig_unit<br />involv_shoot","dog<br />femal<br />partner<br />insid<br />kill<br />went<br />avenu<br />outsid<br />home<br />offic_heard","dog<br />septemb<br />encount<br />philadelphia_polic<br />officer-involv<br />officer-involv_shoot<br />white<br />philadelphia<br />area<br />avenu","injur<br />polic_district<br />philadelphia<br />polic_depart<br />veteran<br />philadelphia_polic<br />officer-involv<br />officer-involv_shoot<br />depart<br />investig_unit","room<br />officer-involv<br />officer-involv_shoot<br />district_place<br />one_round<br />duti<br />discharg_one<br />incid_offic<br />place<br />affair_investig","dog<br />resid<br />polic_depart<br />dure<br />philadelphia_polic<br />assault<br />officer-involv<br />officer-involv_shoot<br />depart<br />shout","dog<br />west<br />anim<br />bull<br />pit_bull<br />pit<br />philadelphia<br />philadelphia_polic<br />kill<br />servic","suspect<br />one_offic<br />year<br />shot<br />discharg_offic<br />driver<br />philadelphia_polic<br />male_suspect<br />june<br />use","suspect<br />block_north<br />saturday<br />uniform_offic<br />north<br />unit<br />philadelphia_polic<br />due<br />june<br />philadelphia","dog<br />resid<br />attack<br />philadelphia<br />ongo<br />block_north<br />medic<br />two<br />north<br />philadelphia_polic","suspect<br />graze<br />male_suspect<br />white<br />robberi<br />off-duti<br />sustain<br />dure<br />philadelphia_polic<br />wound","sergeant<br />bull<br />pit_bull<br />pit<br />discharg_offic<br />attack<br />also<br />year_old<br />old<br />dog","attack<br />dog<br />bull<br />pit_bull<br />pit<br />kill<br />philadelphia<br />year<br />philadelphia_polic<br />anim","attack<br />dog<br />owner<br />bull<br />pit_bull<br />block_south<br />pit<br />control<br />philadelphia<br />femal","suspect<br />off-duti<br />assault<br />robberi<br />take<br />struggl<br />dure<br />male_suspect<br />remain<br />violat","dog<br />kill<br />wit<br />bull<br />pit_bull<br />pit<br />attack<br />philadelphia<br />bodi<br />victim","complain<br />front_door<br />knock<br />outsid<br />taken<br />unit<br />subsequ<br />took<br />arm<br />front","bull<br />pit_bull<br />pit<br />dog<br />attack<br />owner<br />control<br />philadelphia<br />stop<br />discharg_offic","suspect<br />stolen<br />vehicl_offic<br />polic_district<br />driver<br />attempt<br />philadelphia_polic<br />male_suspect<br />officer-involv<br />officer-involv_shoot","dog<br />attack<br />anim<br />depart<br />philadelphia<br />avenu<br />later<br />polic_depart<br />philadelphia_polic<br />shout","magazin<br />block_north<br />offend<br />park<br />black<br />north<br />live<br />handgun<br />live_round<br />round","passeng<br />suspect<br />open<br />driver<br />door<br />strike_offic<br />driver_side<br />window<br />fled_scene<br />side","suspect<br />veteran_philadelphia<br />templ_univers<br />univers_hospit<br />depart_assign<br />shot<br />univers<br />shoot<br />person<br />polic_depart","swat<br />suspect<br />swat_offic<br />assist<br />year_old<br />respond_offic<br />old<br />still<br />year<br />direct","dog<br />yard<br />bull<br />pit_bull<br />owner<br />pit<br />resid<br />year_old<br />old<br />year","block_south<br />resid<br />dog<br />south<br />offic_offic<br />philadelphia_polic<br />philadelphia<br />drew_weapon<br />made<br />bull","highway<br />graze<br />suspect<br />patrol<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />philadelphia_polic<br />assault","dog<br />attack<br />victim<br />wit<br />violat<br />home<br />highway<br />bull<br />pit_bull<br />bodi_worn","suspect<br />sergeant<br />home<br />depart<br />encount<br />shot<br />veteran<br />involv<br />verbal<br />one_time","dog<br />anim<br />remain<br />control<br />dure_incid<br />philadelphia<br />injur<br />three<br />sustain<br />polic_depart","suspect<br />shoot<br />victim<br />passeng<br />pronounc_deceas<br />deceas<br />driver<br />unit<br />pronounc<br />wound","suspect<br />knife<br />ecw<br />deploy<br />offic_respond<br />began<br />philadelphia_polic<br />advanc_toward<br />step<br />male_suspect","robberi<br />victim<br />suspect<br />approach_male<br />polic_vehicl<br />gun<br />follow<br />vehicl_offic<br />phone<br />drop_gun","side_door<br />door_offic<br />side<br />passeng<br />approach_driver<br />passeng_side<br />car<br />driver_side<br />driver<br />onto","lot<br />gun_offic<br />rear<br />bodi<br />ground<br />car<br />handgun<br />gun<br />pm_offic<br />strike_male","phone<br />detect<br />swat<br />one_time<br />properti<br />struck<br />enter<br />bedroom<br />swat_offic<br />announc","offend<br />offic_involv<br />gun_offic<br />observ_offend<br />area<br />involv<br />discharg_offic<br />turn<br />left<br />offic_offic","offic_involv<br />offend<br />side_door<br />involv<br />involv_shoot<br />side<br />taken<br />block_north<br />driver<br />shoot","swat<br />gsw<br />sustain<br />unit<br />insid_properti<br />front<br />properti<br />north<br />offend<br />rear","fire<br />cover<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />philadelphia_polic<br />depart<br />philadelphia<br />district_offic","offend<br />gun<br />point_gun<br />lot<br />drop_gun<br />offend_drop<br />gun_offic<br />around<br />began<br />drop","offend<br />victim<br />east<br />handgun<br />gun<br />one_time<br />locat<br />return<br />partner<br />point_gun","victim<br />one_time<br />shot<br />shoot<br />left<br />unknown<br />area<br />south<br />homicid<br />shoulder","room<br />offic_offic<br />oper<br />hospit_polic<br />open_door<br />discharg_offic<br />sever_time<br />window<br />templ_hospit<br />pull","gsw<br />victim<br />discharg_offic<br />locat<br />offic_arriv<br />locat_offic<br />arriv_locat<br />gunshot<br />believ<br />head","secur<br />unknown<br />westbound<br />pursuit<br />avenu<br />return<br />black_male<br />activ<br />black<br />front","passeng<br />refer<br />rear<br />unmark<br />unmark_vehicl<br />area<br />want<br />struck<br />window<br />pm_offic","bedroom<br />knife<br />offend<br />victim<br />observ_offend<br />resid<br />arm<br />wit<br />front<br />enter","floor<br />polic_offic<br />swat<br />door<br />magazin<br />warrant<br />unit<br />search<br />point_offic<br />vest","offend<br />unmark_vehicl<br />black<br />wear<br />unmark<br />drove<br />unknown<br />intersect<br />time_offic<br />handgun","stolen<br />partner<br />point_gun<br />black<br />taken<br />pursuit<br />street_offic<br />run<br />point<br />district_offic","arriv_locat<br />corner<br />gun<br />drop<br />drop_gun<br />verbal<br />locat<br />front<br />ground_drop<br />polic_civilian","swat<br />announc<br />swat_offic<br />door<br />addit<br />south<br />order<br />assault<br />insid<br />knock","offend<br />encount<br />head<br />arm<br />point_offic<br />near<br />struck<br />fell<br />dure<br />wound","rifl<br />offend<br />homicid<br />believ<br />gunfir<br />multipl<br />gunshot<br />area<br />involv<br />direct","respond_offic<br />run<br />point<br />polic_offic<br />observ_male<br />male_point<br />offic_observ<br />walk<br />weapon_male<br />avenu","park<br />polic_offic<br />westbound<br />still<br />seat<br />foot<br />behind<br />driver_seat<br />cover<br />car","unmark_vehicl<br />corner<br />bodi<br />unmark<br />medic<br />north<br />point_gun<br />narcot<br />wound<br />oper_unmark","road<br />bodi<br />front<br />refer<br />two<br />live<br />toward<br />civilian<br />turn<br />resid","passeng<br />rear<br />driver<br />request<br />posit<br />broad<br />due<br />blue<br />passeng_side<br />approach","victim<br />offend<br />pronounc<br />weapon_offend<br />polic_civilian<br />highway<br />drew_weapon<br />larg<br />torso<br />ongo","knife<br />drop_knife<br />strike_male<br />drop<br />toward_offic<br />advanc_toward<br />arm<br />shout<br />advanc<br />deploy","suspect<br />swat_offic<br />swat<br />femal<br />properti<br />male_suspect<br />complain<br />road<br />point<br />white","properti<br />swat<br />black_male<br />black<br />driveway<br />went<br />locat<br />side<br />rear<br />full_uniform","suspect<br />vehicl_offic<br />polic_vehicl<br />gave<br />move<br />oper<br />driver<br />east<br />upon<br />point_offic","knife<br />drop_knife<br />drop<br />walk<br />order<br />order_male<br />away<br />back<br />toward<br />park","complain<br />car<br />get<br />floor<br />avenu<br />point<br />observ_male<br />male_arm<br />black<br />intersect","vest<br />rear<br />seat<br />vehicl_offic<br />black<br />area<br />road<br />near<br />unmark_polic<br />driver","unmark_polic<br />narcot<br />unmark<br />polic_vehicl<br />street_offic<br />front<br />black<br />search<br />front_door<br />area","sergeant<br />blue<br />unmark<br />camera<br />sever<br />insid<br />remov<br />run<br />plaincloth_offic<br />arrest","knock<br />off-duti<br />block_south<br />south<br />began<br />offic_offic<br />offic_drew<br />shout<br />locat<br />outsid","femal<br />yard<br />room<br />calib<br />found<br />multipl<br />also<br />live<br />properti<br />rear","medic<br />man<br />unit<br />driver<br />struggl<br />emerg<br />flee<br />pursuit<br />drive<br />lot","narcot<br />run<br />plaincloth_offic<br />gunshot<br />gun<br />unmark_vehicl<br />offic_heard<br />conduct<br />februari<br />round_recov","gun<br />third<br />gun_offic<br />door<br />saw<br />rear<br />arm<br />front<br />fire<br />ran","car<br />saw<br />window<br />still<br />approach<br />later<br />side<br />driver<br />approach_driver<br />area","man<br />away<br />advanc_toward<br />advanc<br />toward_offic<br />toward<br />drop<br />open<br />fell<br />car","detect<br />car<br />unmark<br />male_point<br />list_critic<br />approach_male<br />light<br />stop<br />believ<br />intersect","driver<br />broad<br />struggl<br />block_n<br />move<br />north<br />block_north<br />gun<br />still<br />open","calib<br />insid_resid<br />heard<br />gunshot<br />stand<br />search<br />front<br />come<br />area<br />resid","road<br />intersect<br />head<br />hold<br />pursu_male<br />offic_pursu<br />male_foot<br />male_fled<br />foot<br />discharg_firearm","complain<br />saw<br />struggl<br />drop_weapon<br />order_male<br />fled_foot<br />point<br />properti<br />order<br />point_gun","knife<br />drop_knife<br />male_drop<br />drop<br />order_male<br />away<br />back<br />continu<br />order<br />advanc_toward","ecw<br />advanc_toward<br />advanc<br />kitchen<br />knife<br />enter<br />get<br />resid<br />offic_observ<br />drew","driveway<br />road<br />hand_offic<br />near<br />foot<br />hand<br />fled_foot<br />bodi<br />observ_male<br />turn","point_firearm<br />kill<br />male_point<br />direct<br />state<br />point<br />shoot<br />heard<br />left<br />order","street_observ<br />male_fled<br />patrol_car<br />leg<br />toward<br />car<br />strike_offic<br />insid<br />man<br />area","cartridg<br />fire<br />south<br />corner<br />sidewalk<br />patrol_car<br />calib<br />car<br />handgun<br />graze","narcot<br />unmark_polic<br />unmark<br />use<br />conduct<br />driver_door<br />polic_vehicl<br />three<br />driver<br />unit","street_male<br />patrol_vehicl<br />fire<br />south<br />male_male<br />weapon_offic<br />drop<br />run<br />calib<br />uniform_offic","swat<br />unit<br />hospit_critic<br />insid_resid<br />insid<br />admit<br />critic_condit<br />resid<br />insid_properti<br />detect","detect<br />offend<br />observ_offend<br />resid<br />bedroom<br />gunshot<br />june<br />went<br />oper_unmark<br />radio_assign","stolen<br />driver_side<br />side<br />driver<br />rear<br />park_vehicl<br />refus<br />offic_oper<br />one_round<br />vehicl_approach","detect<br />treat_releas<br />chase<br />head<br />treat<br />releas<br />offend<br />westbound<br />shoulder<br />off-duti","offic_number<br />number<br />passeng<br />pistol<br />two<br />servic<br />number_one<br />four<br />unmark<br />offend","plaincloth_offic<br />unmark_polic<br />unmark<br />plaincloth<br />civilian<br />two<br />polic_vehicl<br />homicid<br />hand<br />avenu","robberi<br />stolen<br />driver_door<br />driver<br />offic_approach<br />open<br />plaincloth<br />posit<br />three<br />plaincloth_offic","knife<br />offic_drew<br />one_offic<br />properti<br />drew<br />drop_knife<br />hospit_critic<br />ecw<br />one_round<br />move","complain<br />phone<br />driveway<br />cartridg<br />number_one<br />offic_number<br />next<br />magazin<br />two<br />septemb","number_one<br />offic_number<br />number<br />offend<br />firearm_offic<br />south<br />yard<br />weapon_offend<br />august<br />pistol_load","offic_number<br />number<br />number_one<br />three<br />two<br />firearm_offic<br />pull<br />releas<br />offend<br />take","drop<br />hospit_critic<br />man<br />refus<br />ground_drop<br />street_male<br />august<br />monday<br />radio_assign<br />torso","stolen<br />offend<br />car<br />man<br />one_round<br />male_arm<br />report<br />discharg_one<br />light<br />emerg","offend<br />resid<br />admit<br />victim<br />semi-automat<br />templ_univers<br />univers_hospit<br />femal<br />univers<br />gunshot","waistband<br />june<br />offend<br />avenu_offic<br />pull<br />avenu<br />round<br />pistol<br />stop<br />patrol_vehicl","knife<br />offic_number<br />offend<br />number<br />move<br />number_one<br />open<br />toward_offic<br />offic_offic<br />bedroom","number_one<br />number<br />plaincloth_offic<br />offic_number<br />plaincloth<br />two<br />uniform_offic<br />februari<br />offend<br />park_vehicl","offend<br />east<br />street_offic<br />offend_offend<br />univers_hospit<br />toward<br />civilian<br />treatment<br />univers<br />turn","offend<br />number_one<br />offic_number<br />number<br />live_round<br />block_n<br />drop<br />hand<br />live<br />offend_offend","miss_offend<br />offend<br />offic_number<br />discharg_firearm<br />number<br />miss<br />north<br />number_one<br />block_n<br />seat","knife<br />offend<br />move<br />control<br />drop_knife<br />torso<br />deploy<br />number_one<br />offic_number<br />complain","offic_number<br />number<br />driveway<br />offic_approach<br />block_n<br />apprehend<br />approach<br />two<br />foot<br />fled_scene","rifl<br />offend<br />front<br />scene_injuri<br />radio_assign<br />octob<br />subsequ<br />inform_post<br />post<br />offend_transport","offend<br />miss_offend<br />compli<br />drop_weapon<br />offend_offend<br />pursu<br />weapon_offend<br />driveway<br />miss<br />ran","offend<br />properti<br />victim<br />penn-presbyterian<br />penn-presbyterian_hospit<br />knife<br />right_hand<br />hand<br />femal<br />right","offend<br />park_vehicl<br />sergeant<br />discharg_firearm<br />univers<br />firearm_strike<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />femal","insid_properti<br />properti<br />offend<br />femal<br />swat<br />insid<br />struck<br />person<br />assault<br />swat_offic","polic_vehicl<br />sidewalk<br />onto<br />drive<br />offend<br />direct<br />weapon_recov<br />block_e<br />passeng_side<br />drove","broad<br />block_north<br />oper<br />north<br />turn<br />miss_offend<br />approach_driver<br />offic_oper<br />weapon_recov<br />highway","step<br />door_offic<br />offend<br />rear<br />kitchen<br />off-duti<br />door<br />apprehend<br />miss<br />offic_observ","offend<br />properti<br />swat<br />secur<br />unit<br />one_offic<br />insid_properti<br />miss_offend<br />weapon_offend<br />offic_pursu","unmark_polic<br />polic_vehicl<br />unmark<br />offend<br />vehicl_respond<br />avenu<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />offic_drew","properti<br />offend<br />avenu<br />rear<br />avenu_offic<br />second<br />enter<br />penn-presbyterian<br />penn-presbyterian_hospit<br />gun","offend<br />complain<br />point_gun<br />robberi<br />struggl<br />exit_vehicl<br />subsequ<br />polic_vehicl<br />gun<br />femal","offend<br />weapon_offend<br />broad<br />offend_fled<br />block_n<br />offend_offend<br />park<br />lot<br />drop<br />result","offend<br />yard<br />lot<br />want<br />block_n<br />offend_drop<br />offic_pursu<br />unmark_polic<br />onc<br />pistol_load","polic_vehicl<br />second<br />offend<br />want<br />two<br />drive<br />park_vehicl<br />violat<br />front<br />move","polic_vehicl<br />block_north<br />pursu<br />pursu_male<br />north<br />offend<br />rear<br />yard<br />miss_offend<br />foot","offend<br />polic_vehicl<br />strike_offic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />discharg_firearm<br />remain<br />advanc<br />scene_injuri<br />street_male"],"hoverinfo":"text","marker":{"size":6},"color":["Likely dog attack","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Likely dog attack","Other","Other","Likely dog attack","Likely dog attack","Other","Other","Likely dog attack","Other","Likely dog attack","Likely dog attack","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Other","Other","Other","Other","Likely dog attack","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Likely knife attack","Likely knife attack","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Likely knife attack","Likely knife attack","Other","Other","Other","Other","Other","Likely knife attack","Likely knife attack","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other"],"colors":["red","orange","steelblue"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"V2 - Dog attack measure"},"yaxis":{"domain":[0,1],"automargin":true,"title":"V4 - Knife attack measure"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[0.17403511249172943,0.11289626209213635,0.16906245122035204,0.17366552107306318,0.12271903040311821,0.16288335904442253,0.15960187600614784,0.19915839045803696,0.14222723818173216,0.25185720339605089,0.20516638044255495,0.15240552895507098,0.19770559799559667,0.16338131592910579,0.15396431220227516,0.12990863788178539,0.13537269157860513,0.15229025848972391],"y":[0.0072562456194927337,-0.027985844957994891,-0.0042293916372493218,-7.9951175398615629e-05,0.038880665470788091,-0.0059557311814732363,0.030007452945903585,0.0076264959533838541,0.0048561224790992716,0.046963149676558423,0.024917622453677606,0.005353531421616757,0.01756478121131572,0.0059771019319881432,-0.0084649624171176576,0.00062868963714063624,-0.029892949164587262,0.0078527160276398236],"mode":"markers","text":["dog<br />narcot<br />back<br />secur<br />unit<br />insid_properti<br />compli<br />onc<br />tuesday<br />retreat","dog<br />district_offic<br />femal<br />polic_district<br />bedroom<br />officer-involv<br />officer-involv_shoot<br />insid<br />kill<br />locat_offic","dog<br />narcot<br />block_e<br />resid<br />retreat<br />involv_shoot<br />kitchen<br />offic_involv<br />bull<br />pit_bull","dog<br />femal<br />partner<br />insid<br />kill<br />went<br />avenu<br />outsid<br />home<br />offic_heard","dog<br />septemb<br />encount<br />philadelphia_polic<br />officer-involv<br />officer-involv_shoot<br />white<br />philadelphia<br />area<br />avenu","dog<br />resid<br />polic_depart<br />dure<br />philadelphia_polic<br />assault<br />officer-involv<br />officer-involv_shoot<br />depart<br />shout","dog<br />west<br />anim<br />bull<br />pit_bull<br />pit<br />philadelphia<br />philadelphia_polic<br />kill<br />servic","dog<br />resid<br />attack<br />philadelphia<br />ongo<br />block_north<br />medic<br />two<br />north<br />philadelphia_polic","sergeant<br />bull<br />pit_bull<br />pit<br />discharg_offic<br />attack<br />also<br />year_old<br />old<br />dog","attack<br />dog<br />bull<br />pit_bull<br />pit<br />kill<br />philadelphia<br />year<br />philadelphia_polic<br />anim","attack<br />dog<br />owner<br />bull<br />pit_bull<br />block_south<br />pit<br />control<br />philadelphia<br />femal","dog<br />kill<br />wit<br />bull<br />pit_bull<br />pit<br />attack<br />philadelphia<br />bodi<br />victim","bull<br />pit_bull<br />pit<br />dog<br />attack<br />owner<br />control<br />philadelphia<br />stop<br />discharg_offic","dog<br />attack<br />anim<br />depart<br />philadelphia<br />avenu<br />later<br />polic_depart<br />philadelphia_polic<br />shout","dog<br />yard<br />bull<br />pit_bull<br />owner<br />pit<br />resid<br />year_old<br />old<br />year","block_south<br />resid<br />dog<br />south<br />offic_offic<br />philadelphia_polic<br />philadelphia<br />drew_weapon<br />made<br />bull","dog<br />attack<br />victim<br />wit<br />violat<br />home<br />highway<br />bull<br />pit_bull<br />bodi_worn","dog<br />anim<br />remain<br />control<br />dure_incid<br />philadelphia<br />injur<br />three<br />sustain<br />polic_depart"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(255,0,0,1)","size":6,"line":{"color":"rgba(255,0,0,1)"}},"type":"scatter","name":"Likely dog attack","textfont":{"color":"rgba(255,0,0,1)"},"error_y":{"color":"rgba(255,0,0,1)"},"error_x":{"color":"rgba(255,0,0,1)"},"line":{"color":"rgba(255,0,0,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[-0.10232360976819424,-0.075552611645860843,0.013653148051798344,-0.076077482407519451,-0.075625523593923646,-0.054966672351712917,-0.055808856467332642,-0.045006661794226167,-0.053879648484018668,-0.061826960560386141,-0.076712116675115585,-0.099540212355649693],"y":[-0.12051991816026016,-0.16637192465552086,-0.12780107973677168,-0.33762260384724246,-0.12855203257173847,-0.10394555153909231,-0.15659098066168026,-0.32919070651667209,-0.37716976007149461,-0.16057075503061424,-0.10360531858695916,-0.11894646517516755],"mode":"markers","text":["offend<br />gun<br />point_gun<br />lot<br />drop_gun<br />offend_drop<br />gun_offic<br />around<br />began<br />drop","offend<br />victim<br />east<br />handgun<br />gun<br />one_time<br />locat<br />return<br />partner<br />point_gun","victim<br />one_time<br />shot<br />shoot<br />left<br />unknown<br />area<br />south<br />homicid<br />shoulder","bedroom<br />knife<br />offend<br />victim<br />observ_offend<br />resid<br />arm<br />wit<br />front<br />enter","offend<br />encount<br />head<br />arm<br />point_offic<br />near<br />struck<br />fell<br />dure<br />wound","rifl<br />offend<br />homicid<br />believ<br />gunfir<br />multipl<br />gunshot<br />area<br />involv<br />direct","victim<br />offend<br />pronounc<br />weapon_offend<br />polic_civilian<br />highway<br />drew_weapon<br />larg<br />torso<br />ongo","knife<br />drop_knife<br />strike_male<br />drop<br />toward_offic<br />advanc_toward<br />arm<br />shout<br />advanc<br />deploy","knife<br />drop_knife<br />drop<br />walk<br />order<br />order_male<br />away<br />back<br />toward<br />park","knife<br />drop_knife<br />male_drop<br />drop<br />order_male<br />away<br />back<br />continu<br />order<br />advanc_toward","knife<br />offic_drew<br />one_offic<br />properti<br />drew<br />drop_knife<br />hospit_critic<br />ecw<br />one_round<br />move","knife<br />offend<br />move<br />control<br />drop_knife<br />torso<br />deploy<br />number_one<br />offic_number<br />complain"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(255,165,0,1)","size":6,"line":{"color":"rgba(255,165,0,1)"}},"type":"scatter","name":"Likely knife attack","textfont":{"color":"rgba(255,165,0,1)"},"error_y":{"color":"rgba(255,165,0,1)"},"error_x":{"color":"rgba(255,165,0,1)"},"line":{"color":"rgba(255,165,0,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[0.0062064039784652542,0.030852496447168698,0.08200240143734866,0.074036783220666064,0.063144711893847918,0.050862745169919711,0.040374029162718331,0.030951505094374936,0.0185058835049184,0.060358795881777075,-0.01540175897089799,-0.011666836382860838,0.0464997444349418,0.055463231366217863,0.05514327863097214,0.0451526106706635,0.01638772518870148,0.043476058007198198,0.016251441185000683,-0.0057677296095977161,-0.030961872252845427,0.0097163042307444498,-0.044740736149371116,-0.022927268376320583,-0.014651848740927528,0.03410019488569118,7.0505769682181645e-07,-0.0061023053772365715,0.016471407436168772,-0.047599138636601909,0.0024356929651386363,-0.069041121590329754,-0.039005279953318768,-0.002872200408998962,0.010370541134446907,-0.0046536533722787909,-0.040453350009204844,-0.039358075324354605,-0.018780433202819226,-0.042087011487686135,-0.0019624112302027031,-0.015667472603067625,-0.027913739450036851,-0.051196864075046984,-0.033628283545147637,-0.041563522367158205,-0.04210603478961903,-0.045654593136369562,-0.048412311606166533,-0.050034581786788886,-0.060011230216487473,-0.051085574424770734,-0.041521464541494219,-0.048683365384765961,-0.071322458169833264,-0.048449629855757216,-0.052862562072989609,-0.055931460389154891,-0.063410869124554695,-0.047406768440816635,-0.051629388854604122,-0.040625732581072216,-0.05541655881228473,-0.062093808122609742,-0.061229511371228069,-0.061446168709819629,-0.04276694312041663,-0.09551110243128523,-0.094001264552999564,-0.079169619206258701,-0.10592745697160257,-0.072150607134067388,-0.074338549346075436,-0.085252040501025972,-0.12804454544623733,-0.11427585439184113,-0.073572951877911227,-0.092810950589979208,-0.071688952634583733,-0.074795060600143973,-0.10683203015107637,-0.125891120075214,-0.081212508137546435,-0.10506057855001295,-0.11638289628351871,-0.086923877580052752,-0.093891519316653058,-0.098305782952640863,-0.086431581496919097,-0.091325952939032728,-0.075014171935932156,-0.084735879576295844,-0.075678496766346012,-0.083129833390233679,-0.093285193998507862,-0.091451035664770072,-0.090579268201874716,-0.10802623688009402,-0.09721332684512432,-0.091092179335945225,-0.084060031919606912,-0.082613030872556226,-0.098015673744956844],"y":[-0.024927406879137051,0.012814794813833937,0.032667716214001254,0.024446758701253919,0.090203302184098388,0.13644671053655158,0.089899005449614516,0.14761874271447448,-0.055742304598942527,0.089845359901751659,-0.013236634665180293,0.049752526069711749,0.037895470529230209,0.063994651829720611,0.061667258074771872,0.03118713554741441,0.013666431859450705,-0.01659547871266526,0.027713111122862403,-0.0083692630433785196,-0.0875590635504504,-0.051706504387758319,-0.036593716027397243,-0.0065188932502726728,-0.048668355689995335,-0.015975589620167329,-0.049632043640798235,-0.075587209897570173,-0.034916308511252048,-0.0066253456285865035,-0.022740831399483893,-0.054147538553585006,-0.016149572286303194,-0.098719704185961002,-0.040011017693335232,-0.032670734236524029,-0.030862575851361592,-0.019389439189609708,-0.08576717525098039,-0.015600644382327207,0.096944372076398791,-0.079515327858367277,0.096041696917232716,-0.064107222308308925,-0.029114138715683281,-0.021895159530379411,-0.0082774492458311533,0.0019347547577029649,0.028919703531361161,0.028244096762175302,0.051842630284998518,-0.010487174856353802,0.050176247047569872,-0.041120318538480326,0.053926385457844818,0.056969108215367499,0.0086163909139656651,0.028321657771606237,0.0033703947577085279,-0.081521573845611012,0.0048661443808195948,-0.029362879306646564,0.03604154854506357,0.042838362911569734,0.05618994173892404,0.0028217734702188184,0.018035068216001097,0.011824971895752601,0.096900026880805096,0.034681761029573037,0.17517427936036542,0.048924377662796982,0.066198229445956824,0.086713750368325113,0.19415013556528926,0.23135392475519256,0.03224607690492725,0.031219524215839969,0.0064070077415623403,0.028604506920263704,-0.029309364323521124,0.24933684834841924,0.024838254105338686,0.088599440463559206,0.12891851646544114,0.11989341930276956,0.021440116408686524,0.0086833311100361979,-0.05926918289850263,0.028034460758916434,0.025790950485206368,0.047382489563737321,0.046688598471513555,-0.023116343338182892,0.029446605705037619,0.031798816253904183,-0.0032081067926483611,0.015902311756652698,-0.0020100423751663729,0.048980385349268199,0.030754009371904614,0.054486461771980466,0.043212924866865322],"mode":"markers","text":["servic<br />sergeant<br />year<br />wit<br />involv<br />male_point<br />investig_unit<br />home<br />unknown<br />complain","detect<br />shoot<br />seat<br />person<br />unit<br />homicid<br />philadelphia<br />vehicl_approach<br />investig_unit<br />involv_shoot","injur<br />polic_district<br />philadelphia<br />polic_depart<br />veteran<br />philadelphia_polic<br />officer-involv<br />officer-involv_shoot<br />depart<br />investig_unit","room<br />officer-involv<br />officer-involv_shoot<br />district_place<br />one_round<br />duti<br />discharg_one<br />incid_offic<br />place<br />affair_investig","suspect<br />one_offic<br />year<br />shot<br />discharg_offic<br />driver<br />philadelphia_polic<br />male_suspect<br />june<br />use","suspect<br />block_north<br />saturday<br />uniform_offic<br />north<br />unit<br />philadelphia_polic<br />due<br />june<br />philadelphia","suspect<br />graze<br />male_suspect<br />white<br />robberi<br />off-duti<br />sustain<br />dure<br />philadelphia_polic<br />wound","suspect<br />off-duti<br />assault<br />robberi<br />take<br />struggl<br />dure<br />male_suspect<br />remain<br />violat","complain<br />front_door<br />knock<br />outsid<br />taken<br />unit<br />subsequ<br />took<br />arm<br />front","suspect<br />stolen<br />vehicl_offic<br />polic_district<br />driver<br />attempt<br />philadelphia_polic<br />male_suspect<br />officer-involv<br />officer-involv_shoot","magazin<br />block_north<br />offend<br />park<br />black<br />north<br />live<br />handgun<br />live_round<br />round","passeng<br />suspect<br />open<br />driver<br />door<br />strike_offic<br />driver_side<br />window<br />fled_scene<br />side","suspect<br />veteran_philadelphia<br />templ_univers<br />univers_hospit<br />depart_assign<br />shot<br />univers<br />shoot<br />person<br />polic_depart","swat<br />suspect<br />swat_offic<br />assist<br />year_old<br />respond_offic<br />old<br />still<br />year<br />direct","highway<br />graze<br />suspect<br />patrol<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />philadelphia_polic<br />assault","suspect<br />sergeant<br />home<br />depart<br />encount<br />shot<br />veteran<br />involv<br />verbal<br />one_time","suspect<br />shoot<br />victim<br />passeng<br />pronounc_deceas<br />deceas<br />driver<br />unit<br />pronounc<br />wound","suspect<br />knife<br />ecw<br />deploy<br />offic_respond<br />began<br />philadelphia_polic<br />advanc_toward<br />step<br />male_suspect","robberi<br />victim<br />suspect<br />approach_male<br />polic_vehicl<br />gun<br />follow<br />vehicl_offic<br />phone<br />drop_gun","side_door<br />door_offic<br />side<br />passeng<br />approach_driver<br />passeng_side<br />car<br />driver_side<br />driver<br />onto","lot<br />gun_offic<br />rear<br />bodi<br />ground<br />car<br />handgun<br />gun<br />pm_offic<br />strike_male","phone<br />detect<br />swat<br />one_time<br />properti<br />struck<br />enter<br />bedroom<br />swat_offic<br />announc","offend<br />offic_involv<br />gun_offic<br />observ_offend<br />area<br />involv<br />discharg_offic<br />turn<br />left<br />offic_offic","offic_involv<br />offend<br />side_door<br />involv<br />involv_shoot<br />side<br />taken<br />block_north<br />driver<br />shoot","swat<br />gsw<br />sustain<br />unit<br />insid_properti<br />front<br />properti<br />north<br />offend<br />rear","fire<br />cover<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />philadelphia_polic<br />depart<br />philadelphia<br />district_offic","room<br />offic_offic<br />oper<br />hospit_polic<br />open_door<br />discharg_offic<br />sever_time<br />window<br />templ_hospit<br />pull","gsw<br />victim<br />discharg_offic<br />locat<br />offic_arriv<br />locat_offic<br />arriv_locat<br />gunshot<br />believ<br />head","secur<br />unknown<br />westbound<br />pursuit<br />avenu<br />return<br />black_male<br />activ<br />black<br />front","passeng<br />refer<br />rear<br />unmark<br />unmark_vehicl<br />area<br />want<br />struck<br />window<br />pm_offic","floor<br />polic_offic<br />swat<br />door<br />magazin<br />warrant<br />unit<br />search<br />point_offic<br />vest","offend<br />unmark_vehicl<br />black<br />wear<br />unmark<br />drove<br />unknown<br />intersect<br />time_offic<br />handgun","stolen<br />partner<br />point_gun<br />black<br />taken<br />pursuit<br />street_offic<br />run<br />point<br />district_offic","arriv_locat<br />corner<br />gun<br />drop<br />drop_gun<br />verbal<br />locat<br />front<br />ground_drop<br />polic_civilian","swat<br />announc<br />swat_offic<br />door<br />addit<br />south<br />order<br />assault<br />insid<br />knock","respond_offic<br />run<br />point<br />polic_offic<br />observ_male<br />male_point<br />offic_observ<br />walk<br />weapon_male<br />avenu","park<br />polic_offic<br />westbound<br />still<br />seat<br />foot<br />behind<br />driver_seat<br />cover<br />car","unmark_vehicl<br />corner<br />bodi<br />unmark<br />medic<br />north<br />point_gun<br />narcot<br />wound<br />oper_unmark","road<br />bodi<br />front<br />refer<br />two<br />live<br />toward<br />civilian<br />turn<br />resid","passeng<br />rear<br />driver<br />request<br />posit<br />broad<br />due<br />blue<br />passeng_side<br />approach","suspect<br />swat_offic<br />swat<br />femal<br />properti<br />male_suspect<br />complain<br />road<br />point<br />white","properti<br />swat<br />black_male<br />black<br />driveway<br />went<br />locat<br />side<br />rear<br />full_uniform","suspect<br />vehicl_offic<br />polic_vehicl<br />gave<br />move<br />oper<br />driver<br />east<br />upon<br />point_offic","complain<br />car<br />get<br />floor<br />avenu<br />point<br />observ_male<br />male_arm<br />black<br />intersect","vest<br />rear<br />seat<br />vehicl_offic<br />black<br />area<br />road<br />near<br />unmark_polic<br />driver","unmark_polic<br />narcot<br />unmark<br />polic_vehicl<br />street_offic<br />front<br />black<br />search<br />front_door<br />area","sergeant<br />blue<br />unmark<br />camera<br />sever<br />insid<br />remov<br />run<br />plaincloth_offic<br />arrest","knock<br />off-duti<br />block_south<br />south<br />began<br />offic_offic<br />offic_drew<br />shout<br />locat<br />outsid","femal<br />yard<br />room<br />calib<br />found<br />multipl<br />also<br />live<br />properti<br />rear","medic<br />man<br />unit<br />driver<br />struggl<br />emerg<br />flee<br />pursuit<br />drive<br />lot","narcot<br />run<br />plaincloth_offic<br />gunshot<br />gun<br />unmark_vehicl<br />offic_heard<br />conduct<br />februari<br />round_recov","gun<br />third<br />gun_offic<br />door<br />saw<br />rear<br />arm<br />front<br />fire<br />ran","car<br />saw<br />window<br />still<br />approach<br />later<br />side<br />driver<br />approach_driver<br />area","man<br />away<br />advanc_toward<br />advanc<br />toward_offic<br />toward<br />drop<br />open<br />fell<br />car","detect<br />car<br />unmark<br />male_point<br />list_critic<br />approach_male<br />light<br />stop<br />believ<br />intersect","driver<br />broad<br />struggl<br />block_n<br />move<br />north<br />block_north<br />gun<br />still<br />open","calib<br />insid_resid<br />heard<br />gunshot<br />stand<br />search<br />front<br />come<br />area<br />resid","road<br />intersect<br />head<br />hold<br />pursu_male<br />offic_pursu<br />male_foot<br />male_fled<br />foot<br />discharg_firearm","complain<br />saw<br />struggl<br />drop_weapon<br />order_male<br />fled_foot<br />point<br />properti<br />order<br />point_gun","ecw<br />advanc_toward<br />advanc<br />kitchen<br />knife<br />enter<br />get<br />resid<br />offic_observ<br />drew","driveway<br />road<br />hand_offic<br />near<br />foot<br />hand<br />fled_foot<br />bodi<br />observ_male<br />turn","point_firearm<br />kill<br />male_point<br />direct<br />state<br />point<br />shoot<br />heard<br />left<br />order","street_observ<br />male_fled<br />patrol_car<br />leg<br />toward<br />car<br />strike_offic<br />insid<br />man<br />area","cartridg<br />fire<br />south<br />corner<br />sidewalk<br />patrol_car<br />calib<br />car<br />handgun<br />graze","narcot<br />unmark_polic<br />unmark<br />use<br />conduct<br />driver_door<br />polic_vehicl<br />three<br />driver<br />unit","street_male<br />patrol_vehicl<br />fire<br />south<br />male_male<br />weapon_offic<br />drop<br />run<br />calib<br />uniform_offic","swat<br />unit<br />hospit_critic<br />insid_resid<br />insid<br />admit<br />critic_condit<br />resid<br />insid_properti<br />detect","detect<br />offend<br />observ_offend<br />resid<br />bedroom<br />gunshot<br />june<br />went<br />oper_unmark<br />radio_assign","stolen<br />driver_side<br />side<br />driver<br />rear<br />park_vehicl<br />refus<br />offic_oper<br />one_round<br />vehicl_approach","detect<br />treat_releas<br />chase<br />head<br />treat<br />releas<br />offend<br />westbound<br />shoulder<br />off-duti","offic_number<br />number<br />passeng<br />pistol<br />two<br />servic<br />number_one<br />four<br />unmark<br />offend","plaincloth_offic<br />unmark_polic<br />unmark<br />plaincloth<br />civilian<br />two<br />polic_vehicl<br />homicid<br />hand<br />avenu","robberi<br />stolen<br />driver_door<br />driver<br />offic_approach<br />open<br />plaincloth<br />posit<br />three<br />plaincloth_offic","complain<br />phone<br />driveway<br />cartridg<br />number_one<br />offic_number<br />next<br />magazin<br />two<br />septemb","number_one<br />offic_number<br />number<br />offend<br />firearm_offic<br />south<br />yard<br />weapon_offend<br />august<br />pistol_load","offic_number<br />number<br />number_one<br />three<br />two<br />firearm_offic<br />pull<br />releas<br />offend<br />take","drop<br />hospit_critic<br />man<br />refus<br />ground_drop<br />street_male<br />august<br />monday<br />radio_assign<br />torso","stolen<br />offend<br />car<br />man<br />one_round<br />male_arm<br />report<br />discharg_one<br />light<br />emerg","offend<br />resid<br />admit<br />victim<br />semi-automat<br />templ_univers<br />univers_hospit<br />femal<br />univers<br />gunshot","waistband<br />june<br />offend<br />avenu_offic<br />pull<br />avenu<br />round<br />pistol<br />stop<br />patrol_vehicl","knife<br />offic_number<br />offend<br />number<br />move<br />number_one<br />open<br />toward_offic<br />offic_offic<br />bedroom","number_one<br />number<br />plaincloth_offic<br />offic_number<br />plaincloth<br />two<br />uniform_offic<br />februari<br />offend<br />park_vehicl","offend<br />east<br />street_offic<br />offend_offend<br />univers_hospit<br />toward<br />civilian<br />treatment<br />univers<br />turn","offend<br />number_one<br />offic_number<br />number<br />live_round<br />block_n<br />drop<br />hand<br />live<br />offend_offend","miss_offend<br />offend<br />offic_number<br />discharg_firearm<br />number<br />miss<br />north<br />number_one<br />block_n<br />seat","offic_number<br />number<br />driveway<br />offic_approach<br />block_n<br />apprehend<br />approach<br />two<br />foot<br />fled_scene","rifl<br />offend<br />front<br />scene_injuri<br />radio_assign<br />octob<br />subsequ<br />inform_post<br />post<br />offend_transport","offend<br />miss_offend<br />compli<br />drop_weapon<br />offend_offend<br />pursu<br />weapon_offend<br />driveway<br />miss<br />ran","offend<br />properti<br />victim<br />penn-presbyterian<br />penn-presbyterian_hospit<br />knife<br />right_hand<br />hand<br />femal<br />right","offend<br />park_vehicl<br />sergeant<br />discharg_firearm<br />univers<br />firearm_strike<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />femal","insid_properti<br />properti<br />offend<br />femal<br />swat<br />insid<br />struck<br />person<br />assault<br />swat_offic","polic_vehicl<br />sidewalk<br />onto<br />drive<br />offend<br />direct<br />weapon_recov<br />block_e<br />passeng_side<br />drove","broad<br />block_north<br />oper<br />north<br />turn<br />miss_offend<br />approach_driver<br />offic_oper<br />weapon_recov<br />highway","step<br />door_offic<br />offend<br />rear<br />kitchen<br />off-duti<br />door<br />apprehend<br />miss<br />offic_observ","offend<br />properti<br />swat<br />secur<br />unit<br />one_offic<br />insid_properti<br />miss_offend<br />weapon_offend<br />offic_pursu","unmark_polic<br />polic_vehicl<br />unmark<br />offend<br />vehicl_respond<br />avenu<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />offic_drew","properti<br />offend<br />avenu<br />rear<br />avenu_offic<br />second<br />enter<br />penn-presbyterian<br />penn-presbyterian_hospit<br />gun","offend<br />complain<br />point_gun<br />robberi<br />struggl<br />exit_vehicl<br />subsequ<br />polic_vehicl<br />gun<br />femal","offend<br />weapon_offend<br />broad<br />offend_fled<br />block_n<br />offend_offend<br />park<br />lot<br />drop<br />result","offend<br />yard<br />lot<br />want<br />block_n<br />offend_drop<br />offic_pursu<br />unmark_polic<br />onc<br />pistol_load","polic_vehicl<br />second<br />offend<br />want<br />two<br />drive<br />park_vehicl<br />violat<br />front<br />move","polic_vehicl<br />block_north<br />pursu<br />pursu_male<br />north<br />offend<br />rear<br />yard<br />miss_offend<br />foot","offend<br />polic_vehicl<br />strike_offic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />discharg_firearm<br />remain<br />advanc<br />scene_injuri<br />street_male"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(70,130,180,1)","size":6,"line":{"color":"rgba(70,130,180,1)"}},"type":"scatter","name":"Other","textfont":{"color":"rgba(70,130,180,1)"},"error_y":{"color":"rgba(70,130,180,1)"},"error_x":{"color":"rgba(70,130,180,1)"},"line":{"color":"rgba(70,130,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-documentMap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2
</figcaption>
</figure>
</div>
</div>
</section>
<section id="clustering-documents-using-their-svd-representation" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Clustering documents using their SVD representation</h1>
<p>Hartigan’s k-means algorithm is an iterative method for partitioning data into <span class="math inline">\(k\)</span> clusters by minimizing the total within-cluster sum of squares. It begins with randomly chosen cluster centers (centroids) and alternates between two steps:</p>
<ol type="1">
<li>assigning each data point to the nearest centroid based on Euclidean distance</li>
<li>updating each centroid to be the mean of the points currently assigned to it</li>
</ol>
<p>These steps repeat until the assignments no longer change significantly, indicating convergence. The algorithm is greedy and locally optimal. That is, it always reduces the the within cluster sum of squares at each iteration, but it can converge to different solutions depending on the initial centroids. Multiple runs with different random starts are often used to find a better overall solution.</p>
<p>Let’s look at a little 2D demonstration before we run this on documents, which can be a little abstract. I have created three clusters with centers at (0,0), (3,3), and (5,5). Then I have R code that reassigns points to their nearest centroids, recomputes the cluster centroids, plots the points colored by their cluster assignment, checks for convergence, and repeats if needed.</p>
<div class="cell" data-caption="Demonstration of Hartigan's k-means algorithm">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20250325</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data from 3 clusters</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">rnorm</span>(<span class="dv">180</span>, <span class="at">mean=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">5</span>)),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y=</span><span class="fu">rnorm</span>(<span class="dv">180</span>, <span class="at">mean=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">5</span>)))</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># find three clusters</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pick three random points to start</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>old_centroid <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span>k) <span class="sc">|&gt;</span></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x,y)</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to assign points to nearest center</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   compare each point to each of the three centers</span></span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   assign the point to its closest center</span></span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>assign_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(df, centers) </span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span>(df, <span class="dv">1</span>, <span class="cf">function</span>(point) </span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">which.min</span>(<span class="fu">colSums</span>((<span class="fu">t</span>(centers) <span class="sc">-</span> point)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> </span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign points to nearest cluster</span></span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">assign_clusters</span>(df[,<span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>)], </span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>                                old_centroid)</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get centroids of newly assigned clusters</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>  new_centroid <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cluster) <span class="sc">|&gt;</span></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">x=</span><span class="fu">mean</span>(x), <span class="at">y=</span><span class="fu">mean</span>(y))</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot showing old and new centroids</span></span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>  plotKmeans <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> old_centroid, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), </span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> new_centroid, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill=</span><span class="fu">factor</span>(cluster)), </span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">bind_cols</span>(old_centroid, new_centroid),</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x...<span class="dv">1</span>, <span class="at">y =</span> y...<span class="dv">2</span>, <span class="at">xend =</span> x...<span class="dv">4</span>, <span class="at">yend =</span> y...<span class="dv">5</span>),</span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"inches"</span>)),</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"K-Means Iteration"</span>, iter)) <span class="sc">+</span></span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plotKmeans)</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>  new_centroid <span class="ot">&lt;-</span> new_centroid <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>cluster)</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if converged</span></span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">all</span>(<span class="fu">abs</span>(new_centroid <span class="sc">-</span> old_centroid) <span class="sc">&lt;</span> <span class="fl">0.001</span>))</span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>  old_centroid <span class="ot">&lt;-</span> new_centroid</span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-kmeans-1" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-1.png" id="fig-kmeans-1" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-2" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-2.png" id="fig-kmeans-2" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-3" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-3.png" id="fig-kmeans-3" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-4" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-4.png" id="fig-kmeans-4" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-5" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-5.png" id="fig-kmeans-5" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-6" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-6.png" id="fig-kmeans-6" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-7" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-7.png" id="fig-kmeans-7" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-8" class="quarto-figure quarto-figure-center quarto-float anchored" width="480">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-8.png" id="fig-kmeans-8" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kmeans-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10
</figcaption>
</figure>
</div>
</div>
</div>
<p>Now let’s try this same approach, but we are going to try it on documents, where documents are defined by their first 7 right singular vectors (columns of <span class="math inline">\(\mathbf{V}\)</span>). Fortunately, R has a built-in <code>kmeans()</code> function in the default <code>stats</code> package that will do all the work for us.</p>
<p>First, we need to decide on how many clusters we should use. The code below explores the relationship between the number of clusters, <span class="math inline">\(k\)</span>, and the total within-cluster sum of squares (SSE) produced by the k-means algorithm. This is the sum of the squared distance between each point and its assigned cluster centroid. This is a key part of the “elbow method,” a common strategy for selecting an appropriate number of clusters. By running k-means repeatedly with increasing values of <span class="math inline">\(k\)</span> (from 1 to 40 in this case), and recording the corresponding SSE, we can visualize how much the clustering improves as <span class="math inline">\(k\)</span> increases. A plot of SSE versus <span class="math inline">\(k\)</span> typically shows a steep drop initially and then levels off. The “elbow” point, where the rate of improvement sharply slows, is often a good choice for the number of clusters. It represents a balance between underfitting and overfitting the structure in the data.</p>
<div class="cell" data-caption="Relationship between $k$ and the within clsuter sum of squares">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">k=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">SSE=</span><span class="cn">NA</span>)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(design))</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(oisSVD<span class="sc">$</span>v[,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>], </span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">centers =</span> design<span class="sc">$</span>k[i], </span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">nstart =</span> <span class="dv">5</span>)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  design<span class="sc">$</span>SSE[i] <span class="ot">&lt;-</span> km<span class="sc">$</span>tot.withinss</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(SSE<span class="sc">~</span>k, <span class="at">data=</span>design, <span class="at">pch=</span><span class="dv">16</span>)</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fl">0.2</span><span class="sc">*</span>design<span class="sc">$</span>SSE[<span class="dv">1</span>], <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>kSelect <span class="ot">&lt;-</span> design <span class="sc">|&gt;</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SSE <span class="sc">&gt;</span> <span class="fl">0.2</span><span class="sc">*</span>design<span class="sc">$</span>SSE[<span class="dv">1</span>]) <span class="sc">|&gt;</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(SSE) <span class="sc">|&gt;</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-kvsse" class="quarto-figure quarto-figure-center quarto-float anchored" width="672">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kvsse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kvsse-1.png" id="fig-kvsse" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-kvsse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-kvsse" class="quarto-xref">Figure&nbsp;11</a> I have marked where the within cluster sum of squares has declined by 80% from having all points in one big cluster. That happens when we set <span class="math inline">\(k\)</span> to 11.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run kmeans on first 7 right singular vectors</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   clusters similar documents</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20250325</span>)</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>oisKmeans <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(oisSVD<span class="sc">$</span>v[,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>], </span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">centers =</span> kSelect,</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nstart =</span> <span class="dv">5</span>) <span class="co"># try 5 random starting points</span></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a><span class="co"># add the cluster labels to the dataset</span></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>ois<span class="sc">$</span>cluster <span class="ot">&lt;-</span> oisKmeans<span class="sc">$</span>cluster</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>ois <span class="sc">|&gt;</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id,location,date,cluster) <span class="sc">|&gt;</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     id                                 location       date cluster
1 24-37      3450 Vista Street, Philadelphia, PA 2024-12-10       8
2 24-36          3250 A Street, Philadelphia, PA 2024-11-12       8
3 24-35 5450 Chancellor Street, Philadelphia, PA 2024-11-10       4
4 24-32         2950 E. Street, Philadelphia, PA 2024-10-11       8
5 24-31      3350 Willits Road, Philadelphia, PA 2024-10-03       4
6 24-30    6150 Lebanon Avenue, Philadelphia, PA 2024-10-02       8</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>hovertext <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(oisTFIDF) <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> ois<span class="sc">$</span>cluster) <span class="sc">|&gt;</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">|&gt;</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean)) <span class="sc">|&gt;</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cluster) <span class="sc">|&gt;</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">1</span>, <span class="cf">function</span>(w)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">order</span>(w, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(oisTFIDF)[i[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]]</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">1</span>, paste, <span class="at">collapse=</span><span class="st">", "</span>) <span class="sc">|&gt;</span> </span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">size =</span> oisKmeans<span class="sc">$</span>size,</span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>        <span class="at">cluster =</span> <span class="dv">1</span><span class="sc">:</span>kSelect) <span class="sc">|&gt;</span></span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span><span class="st">"terms"</span>, <span class="at">.cols=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-caption="Plot of document by first two right singular vectors, colored by cluster">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">1</span>],</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">2</span>],</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> ois<span class="sc">$</span>cluster,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> hovertext<span class="sc">$</span>terms[ois<span class="sc">$</span>cluster], </span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"SVD Dimension 1"</span>),</span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"SVD Dimension 2"</span>),</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"K-Means Clustering of OIS Reports"</span></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-clusteredDocuments" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-clusteredDocuments-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-83b35f5d9047b21992f1" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-83b35f5d9047b21992f1">{"x":{"visdat":{"d1f03144572a":["function () ","plotlyVisDat"]},"cur_data":"d1f03144572a","attrs":{"d1f03144572a":{"x":[0.12809101801173994,0.10143020755684863,0.086694669433611565,0.12747386571725591,0.086265364600661698,0.12886013227559981,0.10740982165343915,0.090456049812433853,0.086834636371068918,0.12413025337483317,0.11553179143963768,0.097925237637608242,0.1052360130428627,0.13847090548115423,0.10235038886013914,0.10673008884194296,0.13938314777682145,0.1303470964319389,0.10023447204067892,0.11523436543205308,0.083842261407203814,0.12252903833194642,0.1002417887322169,0.11772233703580735,0.09067830680500219,0.089234646937243811,0.090838026753821341,0.10281417259767651,0.11187962635105551,0.1045288023490793,0.095786374490251028,0.11248877175421527,0.097346388423486765,0.11441409328411273,0.097239726883754332,0.10555326254842129,0.095261914068190082,0.078647093333567689,0.07412761230350709,0.091462909429766287,0.086469936943868286,0.08629368863940029,0.094216280781637643,0.083300054306917462,0.10103279754274777,0.10523541263282139,0.091676284326935017,0.073453379169994032,0.082696617292141172,0.082388536458392239,0.076526184396504299,0.10607016771686344,0.084526238635009257,0.10055907825409327,0.076414528492449479,0.074188920213690376,0.08568364494312769,0.098665403731460072,0.08538789056122266,0.079671029830106183,0.07180889681174929,0.072759325512459075,0.073479632143116189,0.080278587098433149,0.094250261353843609,0.076913748745529684,0.11908042227309419,0.083084227695591248,0.10087642127203399,0.08107349410284849,0.079742727443912587,0.078156404683886418,0.085327850349264489,0.071119576991081096,0.061088297636844396,0.064628015932150243,0.065171846737473726,0.062411066539794932,0.065741852184999616,0.069282178824364632,0.061950357762286752,0.061731933376507779,0.074153872922680178,0.063954285403867009,0.062246335988670728,0.066409547023213347,0.06489434852780572,0.063155000174442866,0.060122003975292833,0.061910488774523632,0.059527059821787826,0.060849853133494863,0.067115490539359141,0.061213697172935191,0.075070689225424092,0.079454268004051393,0.068006650419493386,0.067417436329644101,0.075763326574544709,0.066555613446914297,0.063496871580719455,0.066324639137878449,0.06954960230800257,0.076991841413033585,0.076853903709694346,0.060482964998178977,0.07176049447699924,0.075086788717691533,0.066887808213329972,0.084201612177188925,0.07651566332768478,0.068626509014621362,0.073899500106564681,0.080604462012749845,0.084948623980769369,0.06799606686230146,0.070018970199928546,0.076570989729630709,0.084340692147978666,0.075557109854665766,0.07697269561455207,0.065682223566862388,0.065319864615413489,0.076234077974010897,0.079477682944418052,0.069610861330877447,0.075498671320146565,0.089314382874623288,0.075800944927862698,0.073596551389184639,0.075051916441717534,0.067136964688000719,0.072539827996074419],"y":[0.17403511249172943,0.11289626209213635,0.0062064039784652542,0.16906245122035204,0.030852496447168698,0.17366552107306318,0.12271903040311821,0.08200240143734866,0.074036783220666064,0.16288335904442253,0.15960187600614784,0.063144711893847918,0.050862745169919711,0.19915839045803696,0.040374029162718331,0.14222723818173216,0.25185720339605089,0.20516638044255495,0.030951505094374936,0.15240552895507098,0.0185058835049184,0.19770559799559667,0.060358795881777075,0.16338131592910579,-0.01540175897089799,-0.011666836382860838,0.0464997444349418,0.055463231366217863,0.15396431220227516,0.12990863788178539,0.05514327863097214,0.13537269157860513,0.0451526106706635,0.15229025848972391,0.01638772518870148,0.043476058007198198,0.016251441185000683,-0.0057677296095977161,-0.030961872252845427,0.0097163042307444498,-0.044740736149371116,-0.022927268376320583,-0.014651848740927528,0.03410019488569118,-0.10232360976819424,-0.075552611645860843,0.013653148051798344,7.0505769682181645e-07,-0.0061023053772365715,0.016471407436168772,-0.047599138636601909,-0.076077482407519451,0.0024356929651386363,-0.069041121590329754,-0.039005279953318768,-0.002872200408998962,0.010370541134446907,-0.075625523593923646,-0.054966672351712917,-0.0046536533722787909,-0.040453350009204844,-0.039358075324354605,-0.018780433202819226,-0.042087011487686135,-0.055808856467332642,-0.045006661794226167,-0.0019624112302027031,-0.015667472603067625,-0.027913739450036851,-0.053879648484018668,-0.051196864075046984,-0.033628283545147637,-0.041563522367158205,-0.04210603478961903,-0.045654593136369562,-0.048412311606166533,-0.050034581786788886,-0.060011230216487473,-0.051085574424770734,-0.041521464541494219,-0.048683365384765961,-0.071322458169833264,-0.048449629855757216,-0.052862562072989609,-0.055931460389154891,-0.063410869124554695,-0.061826960560386141,-0.047406768440816635,-0.051629388854604122,-0.040625732581072216,-0.05541655881228473,-0.062093808122609742,-0.061229511371228069,-0.061446168709819629,-0.04276694312041663,-0.09551110243128523,-0.094001264552999564,-0.079169619206258701,-0.10592745697160257,-0.072150607134067388,-0.074338549346075436,-0.076712116675115585,-0.085252040501025972,-0.12804454544623733,-0.11427585439184113,-0.073572951877911227,-0.092810950589979208,-0.071688952634583733,-0.074795060600143973,-0.10683203015107637,-0.125891120075214,-0.081212508137546435,-0.10506057855001295,-0.11638289628351871,-0.099540212355649693,-0.086923877580052752,-0.093891519316653058,-0.098305782952640863,-0.086431581496919097,-0.091325952939032728,-0.075014171935932156,-0.084735879576295844,-0.075678496766346012,-0.083129833390233679,-0.093285193998507862,-0.091451035664770072,-0.090579268201874716,-0.10802623688009402,-0.09721332684512432,-0.091092179335945225,-0.084060031919606912,-0.082613030872556226,-0.098015673744956844],"mode":"markers","text":["dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","knife, drop_knife, bedroom, drop, offend, arm, walk, front, victim, continu","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","knife, drop_knife, bedroom, drop, offend, arm, walk, front, victim, continu","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","knife, drop_knife, bedroom, drop, offend, arm, walk, front, victim, continu","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark"],"marker":{"size":6},"color":[8,8,4,8,4,8,8,4,4,8,8,2,2,8,2,8,8,8,2,8,4,8,2,8,11,2,2,7,8,8,2,8,2,8,4,2,2,10,10,7,11,4,7,4,11,11,11,4,11,4,10,5,7,11,10,4,7,11,11,4,4,10,4,10,11,5,7,7,2,5,4,10,10,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,3,3,3,3,3,3,7,6,3,6,1,3,3,9,3,1,1,6,6,6,3,9,1,6,6,1,9,1,6,6,6,6,6,3,3,6,6,3,6,6,6,6,3,3,6],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"SVD Dimension 1"},"yaxis":{"domain":[0,1],"automargin":true,"title":"SVD Dimension 2"},"title":"K-Means Clustering of OIS Reports","hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[0.12809101801173994,0.10143020755684863,0.086694669433611565,0.12747386571725591,0.086265364600661698,0.12886013227559981,0.10740982165343915,0.090456049812433853,0.086834636371068918,0.12413025337483317,0.11553179143963768,0.097925237637608242,0.1052360130428627,0.13847090548115423,0.10235038886013914,0.10673008884194296,0.13938314777682145,0.1303470964319389,0.10023447204067892,0.11523436543205308,0.083842261407203814,0.12252903833194642,0.1002417887322169,0.11772233703580735,0.09067830680500219,0.089234646937243811,0.090838026753821341,0.10281417259767651,0.11187962635105551,0.1045288023490793,0.095786374490251028,0.11248877175421527,0.097346388423486765,0.11441409328411273,0.097239726883754332,0.10555326254842129,0.095261914068190082,0.078647093333567689,0.07412761230350709,0.091462909429766287,0.086469936943868286,0.08629368863940029,0.094216280781637643,0.083300054306917462,0.10103279754274777,0.10523541263282139,0.091676284326935017,0.073453379169994032,0.082696617292141172,0.082388536458392239,0.076526184396504299,0.10607016771686344,0.084526238635009257,0.10055907825409327,0.076414528492449479,0.074188920213690376,0.08568364494312769,0.098665403731460072,0.08538789056122266,0.079671029830106183,0.07180889681174929,0.072759325512459075,0.073479632143116189,0.080278587098433149,0.094250261353843609,0.076913748745529684,0.11908042227309419,0.083084227695591248,0.10087642127203399,0.08107349410284849,0.079742727443912587,0.078156404683886418,0.085327850349264489,0.071119576991081096,0.061088297636844396,0.064628015932150243,0.065171846737473726,0.062411066539794932,0.065741852184999616,0.069282178824364632,0.061950357762286752,0.061731933376507779,0.074153872922680178,0.063954285403867009,0.062246335988670728,0.066409547023213347,0.06489434852780572,0.063155000174442866,0.060122003975292833,0.061910488774523632,0.059527059821787826,0.060849853133494863,0.067115490539359141,0.061213697172935191,0.075070689225424092,0.079454268004051393,0.068006650419493386,0.067417436329644101,0.075763326574544709,0.066555613446914297,0.063496871580719455,0.066324639137878449,0.06954960230800257,0.076991841413033585,0.076853903709694346,0.060482964998178977,0.07176049447699924,0.075086788717691533,0.066887808213329972,0.084201612177188925,0.07651566332768478,0.068626509014621362,0.073899500106564681,0.080604462012749845,0.084948623980769369,0.06799606686230146,0.070018970199928546,0.076570989729630709,0.084340692147978666,0.075557109854665766,0.07697269561455207,0.065682223566862388,0.065319864615413489,0.076234077974010897,0.079477682944418052,0.069610861330877447,0.075498671320146565,0.089314382874623288,0.075800944927862698,0.073596551389184639,0.075051916441717534,0.067136964688000719,0.072539827996074419],"y":[0.17403511249172943,0.11289626209213635,0.0062064039784652542,0.16906245122035204,0.030852496447168698,0.17366552107306318,0.12271903040311821,0.08200240143734866,0.074036783220666064,0.16288335904442253,0.15960187600614784,0.063144711893847918,0.050862745169919711,0.19915839045803696,0.040374029162718331,0.14222723818173216,0.25185720339605089,0.20516638044255495,0.030951505094374936,0.15240552895507098,0.0185058835049184,0.19770559799559667,0.060358795881777075,0.16338131592910579,-0.01540175897089799,-0.011666836382860838,0.0464997444349418,0.055463231366217863,0.15396431220227516,0.12990863788178539,0.05514327863097214,0.13537269157860513,0.0451526106706635,0.15229025848972391,0.01638772518870148,0.043476058007198198,0.016251441185000683,-0.0057677296095977161,-0.030961872252845427,0.0097163042307444498,-0.044740736149371116,-0.022927268376320583,-0.014651848740927528,0.03410019488569118,-0.10232360976819424,-0.075552611645860843,0.013653148051798344,7.0505769682181645e-07,-0.0061023053772365715,0.016471407436168772,-0.047599138636601909,-0.076077482407519451,0.0024356929651386363,-0.069041121590329754,-0.039005279953318768,-0.002872200408998962,0.010370541134446907,-0.075625523593923646,-0.054966672351712917,-0.0046536533722787909,-0.040453350009204844,-0.039358075324354605,-0.018780433202819226,-0.042087011487686135,-0.055808856467332642,-0.045006661794226167,-0.0019624112302027031,-0.015667472603067625,-0.027913739450036851,-0.053879648484018668,-0.051196864075046984,-0.033628283545147637,-0.041563522367158205,-0.04210603478961903,-0.045654593136369562,-0.048412311606166533,-0.050034581786788886,-0.060011230216487473,-0.051085574424770734,-0.041521464541494219,-0.048683365384765961,-0.071322458169833264,-0.048449629855757216,-0.052862562072989609,-0.055931460389154891,-0.063410869124554695,-0.061826960560386141,-0.047406768440816635,-0.051629388854604122,-0.040625732581072216,-0.05541655881228473,-0.062093808122609742,-0.061229511371228069,-0.061446168709819629,-0.04276694312041663,-0.09551110243128523,-0.094001264552999564,-0.079169619206258701,-0.10592745697160257,-0.072150607134067388,-0.074338549346075436,-0.076712116675115585,-0.085252040501025972,-0.12804454544623733,-0.11427585439184113,-0.073572951877911227,-0.092810950589979208,-0.071688952634583733,-0.074795060600143973,-0.10683203015107637,-0.125891120075214,-0.081212508137546435,-0.10506057855001295,-0.11638289628351871,-0.099540212355649693,-0.086923877580052752,-0.093891519316653058,-0.098305782952640863,-0.086431581496919097,-0.091325952939032728,-0.075014171935932156,-0.084735879576295844,-0.075678496766346012,-0.083129833390233679,-0.093285193998507862,-0.091451035664770072,-0.090579268201874716,-0.10802623688009402,-0.09721332684512432,-0.091092179335945225,-0.084060031919606912,-0.082613030872556226,-0.098015673744956844],"mode":"markers","text":["dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","dog, attack, bull, pit_bull, pit, philadelphia, philadelphia_polic, resid, owner, officer-involv","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","knife, drop_knife, bedroom, drop, offend, arm, walk, front, victim, continu","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","offend, victim, handgun, gun, area, one_time, right, left, black, gsw","knife, drop_knife, bedroom, drop, offend, arm, walk, front, victim, continu","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","suspect, philadelphia_polic, philadelphia, male_suspect, depart, robberi, depart_assign, driver, dure, veteran","knife, drop_knife, bedroom, drop, offend, arm, walk, front, victim, continu","shoot, complain, room, philadelphia, unit, depart, front, point, veteran, polic_district","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","passeng, rear, unmark, driver, unmark_polic, area, street_offic, black, unmark_vehicl, narcot","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","swat, swat_offic, properti, suspect, announc, unit, door, detect, floor, insid","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","knife, drop_knife, offend, move, ecw, offic_drew, male_drop, offic_number, inform_post, post","offic_number, number, number_one, offend, two, plaincloth_offic, inform_post, post, block_n, firearm_offic","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","inform_post, post, polic_vehicl, driver, offend, provid, prior, unmark, charg_decis, decis","offend, inform_post, post, detect, offend_offend, properti, polic_vehicl, da_offic, inform_da, offic_mark"],"marker":{"colorbar":{"title":"","ticklen":2},"cmin":1,"cmax":11,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[8,8,4,8,4,8,8,4,4,8,8,2,2,8,2,8,8,8,2,8,4,8,2,8,11,2,2,7,8,8,2,8,2,8,4,2,2,10,10,7,11,4,7,4,11,11,11,4,11,4,10,5,7,11,10,4,7,11,11,4,4,10,4,10,11,5,7,7,2,5,4,10,10,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,3,3,3,3,3,3,7,6,3,6,1,3,3,9,3,1,1,6,6,6,3,9,1,6,6,1,9,1,6,6,6,6,6,3,3,6,6,3,6,6,6,6,3,3,6],"size":6,"line":{"colorbar":{"title":"","ticklen":2},"cmin":1,"cmax":11,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[8,8,4,8,4,8,8,4,4,8,8,2,2,8,2,8,8,8,2,8,4,8,2,8,11,2,2,7,8,8,2,8,2,8,4,2,2,10,10,7,11,4,7,4,11,11,11,4,11,4,10,5,7,11,10,4,7,11,11,4,4,10,4,10,11,5,7,7,2,5,4,10,10,3,3,3,3,3,3,3,3,3,3,3,3,3,9,9,3,3,3,3,3,3,7,6,3,6,1,3,3,9,3,1,1,6,6,6,3,9,1,6,6,1,9,1,6,6,6,6,6,3,3,6,6,3,6,6,6,6,3,3,6]}},"type":"scatter","xaxis":"x","yaxis":"y","frame":null},{"x":[0.059527059821787826,0.13938314777682145],"y":[-0.12804454544623733,0.25185720339605089],"type":"scatter","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":1,"cmax":11,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[1,11],"line":{"color":"rgba(255,127,14,1)"}},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig quarto-uncaptioned" id="fig-clusteredDocuments-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12
</figcaption>
</figure>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>