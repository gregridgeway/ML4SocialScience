<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Greg Ridgeway">
<meta name="dcterms.date" content="2025-03-29">

<title>Machine learning with text</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="L11-text_files/libs/clipboard/clipboard.min.js"></script>
<script src="L11-text_files/libs/quarto-html/quarto.js"></script>
<script src="L11-text_files/libs/quarto-html/popper.min.js"></script>
<script src="L11-text_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="L11-text_files/libs/quarto-html/anchor.min.js"></script>
<link href="L11-text_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="L11-text_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="L11-text_files/libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="L11-text_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="L11-text_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="L11-text_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="L11-text_files/libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script src="L11-text_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="L11-text_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">

<link href="L11-text_files/libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">

<script src="L11-text_files/libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>

<script src="L11-text_files/libs/plotly-binding-4.10.4/plotly.js"></script>

<script src="L11-text_files/libs/typedarray-0.1/typedarray.min.js"></script>

<script src="L11-text_files/libs/jquery-3.5.1/jquery.min.js"></script>

<link href="L11-text_files/libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">

<script src="L11-text_files/libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>

<link href="L11-text_files/libs/plotly-htmlwidgets-css-2.11.1/plotly-htmlwidgets.css" rel="stylesheet">

<script src="L11-text_files/libs/plotly-main-2.11.1/plotly-latest.min.js"></script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#turning-text-into-data-with-text2vec" id="toc-turning-text-into-data-with-text2vec" class="nav-link" data-scroll-target="#turning-text-into-data-with-text2vec"><span class="header-section-number">2</span> Turning text into data with <code>text2vec</code></a>
  <ul class="collapse">
  <li><a href="#creating-a-document-term-matrix-dtm" id="toc-creating-a-document-term-matrix-dtm" class="nav-link" data-scroll-target="#creating-a-document-term-matrix-dtm"><span class="header-section-number">2.1</span> Creating a document-term matrix (DTM)</a></li>
  <li><a href="#term-frequencyinverse-document-frequency" id="toc-term-frequencyinverse-document-frequency" class="nav-link" data-scroll-target="#term-frequencyinverse-document-frequency"><span class="header-section-number">2.2</span> Term Frequency–Inverse Document Frequency</a>
  <ul class="collapse">
  <li><a href="#example" id="toc-example" class="nav-link" data-scroll-target="#example"><span class="header-section-number">2.2.1</span> Example</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#term-co-occurrence-matrix-tcm" id="toc-term-co-occurrence-matrix-tcm" class="nav-link" data-scroll-target="#term-co-occurrence-matrix-tcm"><span class="header-section-number">3</span> Term co-occurrence matrix (TCM)</a></li>
  <li><a href="#singular-value-decomposition-for-text" id="toc-singular-value-decomposition-for-text" class="nav-link" data-scroll-target="#singular-value-decomposition-for-text"><span class="header-section-number">4</span> Singular value decomposition for text</a></li>
  <li><a href="#clustering-documents-with-hartigans-k-means-clustering-algorithm" id="toc-clustering-documents-with-hartigans-k-means-clustering-algorithm" class="nav-link" data-scroll-target="#clustering-documents-with-hartigans-k-means-clustering-algorithm"><span class="header-section-number">5</span> Clustering documents with Hartigan’s k-means clustering algorithm</a></li>
  <li><a href="#document-classification" id="toc-document-classification" class="nav-link" data-scroll-target="#document-classification"><span class="header-section-number">6</span> Document classification</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="L11-text.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Machine learning with text</h1>
</div>


<div class="quarto-title-meta-author">
  <div class="quarto-title-meta-heading">Author</div>
  <div class="quarto-title-meta-heading">Affiliation</div>
  
    <div class="quarto-title-meta-contents">
    <p class="author">Greg Ridgeway <a href="mailto:gridge@upenn.edu" class="quarto-title-author-email"><i class="bi bi-envelope"></i></a> </p>
  </div>
  <div class="quarto-title-meta-contents">
        <p class="affiliation">
            University of Pennsylvania
          </p>
      </div>
  </div>

<div class="quarto-title-meta">

      
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 29, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<!-- Since heavy plotly() use need this installed, no need to call-->
<!-- install.packages("webdriver") -->
<!-- webdriver::install_phantomjs() -->
<!-- quarto render L11-text.qmd --to html-->
<!-- quarto render L11-text.qmd --cache-refresh --to html -->
<!-- git commit L11-* -m "commit message" -->
<!-- git status -->
<!-- git push -->
<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>In this section we will use <code>text2vec</code> to explore the language used in a collection of police reports describing officer-involved shootings (OIS). These reports contain unstructured narrative text. Our goal is to transform that text into a format we can analyze using tools from natural language processing (NLP). We will walk through a typical text analysis process: tokenizing the reports, building a vocabulary, constructing a document-term matrix, and applying TF-IDF to highlight the most distinctive terms. Along the way, we will also examine co-occurrence patterns.</p>
<p>To start, we are going to need a couple of R packages to facilitate our work. <code>text2vec</code> will do most of the work converting the documents into a form of data that we can analyze.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(crayon)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(text2vec)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As for the source of our documents, the Philadelphia Police Department posts <a href="https://www.phillypolice.com/accountability/ois/">reports</a> on each officer-involved shooting. I have pulled the data off their website and packaged it into an .RData file. Loading it will create the data frame <code>ois</code>. Details on how to pull the data off of the PPD website are part of my <a href="https://github.com/gregridgeway/R4crim?tab=readme-ov-file">R4crim collection</a> of scripts.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">"data/PPD OIS.RData"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>ois <span class="ot">&lt;-</span> ois <span class="sc">|&gt;</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">fatal =</span> <span class="fu">grepl</span>(<span class="st">"1 Killed|^Killed$"</span>, subInjury) <span class="sc">|&gt;</span> <span class="fu">as.numeric</span>())</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>ois <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>text) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     id                                 location
1 24-37      3450 Vista Street, Philadelphia, PA
2 24-36          3250 A Street, Philadelphia, PA
3 24-35 5450 Chancellor Street, Philadelphia, PA
4 24-32         2950 E. Street, Philadelphia, PA
5 24-31      3350 Willits Road, Philadelphia, PA
6 24-30    6150 Lebanon Avenue, Philadelphia, PA
                                        url subInjury       date       lon
1   https://www.phillypolice.com/ois/24-37/       N/A 2024-12-10 -75.03885
2   https://www.phillypolice.com/ois/24-36/       N/A 2024-11-12 -75.12714
3   https://www.phillypolice.com/ois/24-35/    Killed 2024-11-10 -75.23050
4   https://www.phillypolice.com/ois/24-32/       N/A 2024-10-11 -75.12024
5   https://www.phillypolice.com/ois/24-31/    Killed 2024-10-03 -75.00908
6 https://www.phillypolice.com/ois/ps24-30/       N/A 2024-10-02 -75.24450
       lat                                             addrmatch score
1 40.04022      3450 Vista St, Philadelphia, Pennsylvania, 19136   100
2 39.99956          3250 A St, Philadelphia, Pennsylvania, 19134   100
3 39.95692 5450 Chancellor St, Philadelphia, Pennsylvania, 19139   100
4 39.99345          2950 E St, Philadelphia, Pennsylvania, 19134   100
5 40.05383    3350 Willits Rd, Philadelphia, Pennsylvania, 19136   100
6 39.98175   6150 Lebanon Ave, Philadelphia, Pennsylvania, 19151   100
       addrtype fatal
1 StreetAddress     0
2 StreetAddress     0
3 StreetAddress     1
4 StreetAddress     0
5 StreetAddress     1
6  PointAddress     0</code></pre>
</div>
</div>
<p>The data include an incident ID, the date of the shooting, the address and coordinates where the shooting occurred, and a URL to the incident report. There is also a column called <code>text</code> containing the full text of the officer-involved shooting report. Some can be long, but here’s one that hits close to home as an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ois <span class="sc">|&gt;</span> <span class="fu">filter</span>(id<span class="sc">==</span><span class="st">"16-30"</span>) <span class="sc">|&gt;</span> <span class="fu">select</span>(text) <span class="sc">|&gt;</span> <span class="fu">unlist</span>() <span class="sc">|&gt;</span> <span class="fu">cat</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Narrative from OIS Report 16-30">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Narrative from OIS Report 16-30
</div>
</div>
<div class="callout-body-container callout-body">
<p>PS#16-30 9/16/16 On Friday, September 16, 2016, at approximately 11:18 P.M., a uniformed sergeant in a marked police vehicle was seated in her parked vehicle in the 5100 block of Sansom Street, when a male approached and without warning, began to discharge a firearm, striking the sergeant, as she remained seated in her vehicle. The offender then began walking east on Sansom Street, stopping at a lounge/bar in the 5100 block of Sansom Street, where he discharged his firearm into the lounge/bar, striking a female employee and a male security guard. The offender continued walking east on Sansom Street to the 4900 block, where he discharged his firearm into an occupied parked vehicle, striking one female and one male occupant. Responding uniformed officers, in marked police vehicles, along with an officer from the University of Pennsylvania police force, located the offender in an alleyway in the rear of the 4800 blocks of Sansom and Walnut Streets. While in the 4800 block of Sansom Street the offender discharged his firearm, striking the University of Pennsylvania Officer as well as a marked police vehicle. Four Officers (one of whom was the University of Pennsylvania Officer) discharged their firearms, striking the offender. The offender fell to the ground and dropped his firearm. Fire Rescue responded and pronounced the offender deceased. The offender’s firearm, a 9MM, semi-automatic pistol, with an obliterated serial number, loaded with 14 live rounds, was recovered at the scene. There were three empty magazines from the offender’s firearm recovered throughout the scene. The sergeant, the University of Pennsylvania Officer, along with the four civilians who were all struck by gunfire, were transported to Penn-Presbyterian Hospital for treatment. The female from the parked vehicle was later pronounced deceased at Penn-Presbyterian Hospital. *** Information posted in the original summary reflects a preliminary understanding of what occurred at the time of the incident. This information is posted shortly after the incident and may be updated as the investigation leads to new information. The DA’s Office is provided all the information from the PPD’s investigation prior to their charging decision.</p>
</div>
</div>
<p>With this set of 133 reports, we will use a variety of data cleaning methods and machine learning methods to try to make sense of these documents.</p>
</section>
<section id="turning-text-into-data-with-text2vec" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Turning text into data with <code>text2vec</code></h1>
<p>To transform the text into a form that is better suited for analysis, we need to go through a number of steps. Part of the reason <code>text2vec</code> is popular is that it can handle large collections of documents. To make the tasks computational efficient there are a number of steps to work through in order to get a usable dataset.</p>
<p>We start by create a “tokenizer,” a process that breaks raw text into individual units like words, phrases, or symbols—called (the “tokens”), the basic building blocks for text analysis. The <code>itoken()</code> function in the <code>text2vec</code> package creates an iterator over a collection of text documents, preparing them for efficient text processing. Instead of transforming all text at once, <code>itoken()</code> streams the documents one at a time, making it well-suited for handling large sets of documents. It “tokenizes” each document using =either a built-in default or a custom tokenizer (which we will do) and produces a structure that can be passed on to other functions that will tidy up the collection of tokens and convert them into a dataset. Because it does not store all tokenized text in memory, <code>itoken()</code> enables fast and memory-efficient text analysis workflows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an iterator over tokens</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   tokens does not actually store data</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   just an efficient means for looping over documents</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">FALSE</span>,</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a><span class="co"># this gets the next batch of documents... for me around 14 documents</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> tokens<span class="sc">$</span><span class="fu">nextElem</span>()</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>ids</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "24-37" "24-36" "24-35" "24-32" "24-31" "24-30" "24-29" "24-28" "24-27"
[10] "24-23" "24-22" "24-21" "24-20" "24-18"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>a<span class="sc">$</span>tokens <span class="sc">|&gt;</span> <span class="fu">sapply</span>(head)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1]         [,2]         [,3]         [,4]         [,5]       
[1,] "3400"       "3200"       "5400"       "29oo"       "3300"     
[2,] "block"      "block"      "block"      "block"      "Willits"  
[3,] "of"         "of"         "of"         "of"         "Road\nOn" 
[4,] "Vista"      "A"          "Chancellor" "E."         "Thursday,"
[5,] "Street\nOn" "Street\nOn" "Street\nOn" "Street\nOn" "October"  
[6,] "Tuesday,"   "Tuesday,"   "Sunday,"    "Friday,"    "3,"       
     [,6]         [,7]           [,8]           [,9]          [,10]         
[1,] "6100"       "2600"         "3900"         "2200"        "3000"        
[2,] "block"      "block"        "block"        "block"       "block"       
[3,] "of"         "of"           "of"           "of"          "of"          
[4,] "Lebanon"    "Glenwood"     "Whittaker"    "S."          "Ruth"        
[5,] "Avenue\nOn" "Avenue\nThe"  "Avenue\nThe"  "65th"        "Street\nThe" 
[6,] "Wednesday," "Philadelphia" "Philadelphia" "Street\nThe" "Philadelphia"
     [,11]       [,12]          [,13]       [,14]      
[1,] "6100"      "3500"         "2700"      "1500"     
[2,] "block"     "block"        "block"     "block"    
[3,] "of"        "of"           "of"        "of"       
[4,] "West"      "F"            "North"     "North"    
[5,] "Columbia"  "Street\nA"    "6th"       "57th"     
[6,] "Avenue\nA" "Philadelphia" "Street\nA" "Street\nA"</code></pre>
</div>
</div>
<p>You can see that so far <code>itoken()</code> has pulled in 14 documents and chopped them up into individual words. Notice that the collection of words have some undesirable quirks. For example, there are</p>
<ul>
<li>numbers that we probably do not really care about</li>
<li>unimportant words like “of” (known as “stop words”)</li>
<li>Line feeds <code>\n</code> in between two words</li>
</ul>
<p><code>create_vocabulary()</code> and <code>prune_vocabulary()</code> help us to trim down the words to the ones that we actually care about. <code>create_vocabulary()</code> allows us to provide a list of stop words to remove. <code>stopwords("en")</code> is just such a list. Here are just a few of the 175 English stop words</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"en"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "i"          "me"         "my"         "myself"     "we"        
 [6] "our"        "ours"       "ourselves"  "you"        "your"      
[11] "yours"      "yourself"   "yourselves" "he"         "him"       
[16] "his"        "himself"    "she"        "her"        "hers"      </code></pre>
</div>
</div>
<p>There are lists for several other languages as well, Italian, for example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"it"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "ad"    "al"    "allo"  "ai"    "agli"  "all"   "agl"   "alla"  "alle" 
[10] "con"   "col"   "coi"   "da"    "dal"   "dallo" "dai"   "dagli" "dall" 
[19] "dagl"  "dalla"</code></pre>
</div>
</div>
<p>We can also ask consider pairs of words in addition to single words (<code>ngram=1:2</code>). This allows word phrases like “police officer” and “pit bull” to be considered as words.</p>
<p><code>prune_vocabulary()</code> trims down words from our vocabulary that are probably not particularly useful</p>
<ul>
<li>words that few documents use (too rare)</li>
<li>words that too many documents use (too common)</li>
</ul>
<p>We can add in some other filters too, like only using words that are at least three letters and dropping any words that have numbers in them (like 3pm or 9mm).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset to beginning</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">FALSE</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Build vocabulary</span></span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="co">#   these are the collection of words that I care about</span></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a><span class="co">#   skip stopwords (the, of, in, ...)</span></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co">#   include two word phrases (2-gram or bigram), </span></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a><span class="co">#      "police officer", "full uniform", "black male", "drop weapon", "pit bull"</span></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a><span class="co">#   skip words that only show up in fewer than 10 documents</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="co">#   skip words that are in the majority of documents (police?, discharged?)</span></span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">&lt;-</span> tokens <span class="sc">|&gt;</span></span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_vocabulary</span>(<span class="at">stopwords =</span> stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"en"</span>),</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ngram =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prune_vocabulary</span>(<span class="at">term_count_min =</span> <span class="dv">10</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>                   <span class="at">doc_proportion_max =</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(term) <span class="sc">&gt;=</span> <span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[0-9]"</span>, term))</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a><span class="co"># space_tokenizer(), default, keeps a lot of punctuation</span></span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>vocab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of docs: 133 
175 stopwords: i, me, my, myself, we, our ... 
ngram_min = 1; ngram_max = 2 
Vocabulary: 
                  term term_count doc_count
                &lt;char&gt;      &lt;int&gt;     &lt;int&gt;
  1:               AM,         10        10
  2:        Avenue\nOn         10        10
  3:   District_Police         10        10
  4:         Hospital,         10         9
  5: Penn-Presbyterian         10         8
 ---                                       
552:           firearm        112        63
553:               one        116        65
554:            posted        120        60
555:           vehicle        180        65
556:          offender        182        49</code></pre>
</div>
</div>
<p>Let’s make our own tokenizer instead of using the default. As we see, the default (<code>space_tokenizer()</code>) often retains punctuation, symbols, or other strange features that dilute or fragment our vocabulary. Customizing the tokenizer allows us to tailor the cleaning process to the structure and quirks of the officer-involved shooting reports. The function that we will create, <code>oisTokenizer()</code>, is a custom tokenizer designed to clean and standardize the raw text from officer-involved shooting reports before further text analysis. It converts the text to lowercase, removes common punctuation patterns (like those in abbreviations such as “3 p.m.”), strips out unusual or inconsistent symbols (such as smart quotes, parentheses, and hash symbols), and splits the text into individual tokens using whitespace as the delimiter.</p>
<p>After tokenization, it will also apply “stemming”. Stemming is a text preprocessing technique that reduces words to their root or base form by removing common suffixes. For example, “running”, “runner”, and “runs” might all be reduced to “run”, allowing the model to treat these variations as the same underlying concept. The <code>SnowballC</code> package has a handy <code>wordStem()</code> function in it. Let’s test it out on a few words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="st">"dog"</span>,<span class="st">"dogs"</span>,<span class="st">"office"</span>,<span class="st">"officer"</span>,<span class="st">"officers"</span>,<span class="st">"police"</span>,<span class="st">"policy"</span>,<span class="st">"policies"</span>) <span class="sc">|&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  SnowballC<span class="sc">::</span><span class="fu">wordStem</span>(<span class="at">language =</span> <span class="st">"en"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "dog"    "dog"    "offic"  "offic"  "offic"  "polic"  "polici" "polici"</code></pre>
</div>
</div>
<p>Conveniently, it makes both “dog” and “dogs” simply “dog”. However, note that it also makes “office”, “officer”, and “officers” all simplified to “office”… maybe not ideal. Since our text will have a lot of “officer” and “officers” and probably very few, if any, “office”, we will need to remember that this stemming has reduced our “police officers” to “polic_offic”. You may see terms like “offic_offic” or “offend_offend”. Typically this occurs because officer or offender was the last word in one sentence and the first non-stop word in the next sentence (e.g.&nbsp;“The suspect ran from the officer. The officer said ‘stop!’”).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># our own custom tokenizer</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>oisTokenizer <span class="ot">&lt;-</span> <span class="cf">function</span>(text)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  text <span class="sc">|&gt;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tolower</span>() <span class="sc">|&gt;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove abbreviation punctuation (like 3 p.m.)</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"([A-z])[,.]+"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">1"</span>, <span class="at">x=</span>_) <span class="sc">|&gt;</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># remove some weird symbols</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"[“”()#]"</span>, <span class="st">""</span>, <span class="at">x=</span>_) <span class="sc">|&gt;</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># no smart quotes</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">"’"</span>, <span class="st">"'"</span>, <span class="at">x=</span>_) <span class="sc">|&gt;</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># split any words with \n, \t, \r between them</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">strsplit</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">s+"</span>) <span class="sc">|&gt;</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># stemming</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">lapply</span>(SnowballC<span class="sc">::</span>wordStem, <span class="at">language =</span> <span class="st">"en"</span>)</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we can rerun our documents through our new tokenizer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># reset to beginning</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    now using our oisTokenizer()</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>tokens <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tokenizer =</span> oisTokenizer,</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">TRUE</span>,</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id)</span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>vocab <span class="ot">&lt;-</span> tokens <span class="sc">|&gt;</span></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_vocabulary</span>(<span class="at">stopwords =</span> stopwords<span class="sc">::</span><span class="fu">stopwords</span>(<span class="st">"en"</span>),</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">ngram =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">prune_vocabulary</span>(<span class="at">term_count_min =</span> <span class="dv">10</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">doc_proportion_min =</span> <span class="fl">0.05</span>,</span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">doc_proportion_max =</span> <span class="fl">0.5</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">nchar</span>(term) <span class="sc">&gt;=</span><span class="dv">3</span>) <span class="sc">|&gt;</span></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">"[0-9]"</span>, term))  <span class="sc">|&gt;</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#   Drop some specific terms that are not useful (e.g. philadelphia)</span></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>term <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"philadelphia_polic"</span>,<span class="st">"philadelphia"</span>,</span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"inform_da"</span>,<span class="st">"da_offic"</span>,<span class="st">"incid_inform"</span>,<span class="st">"inform_ppd"</span>,</span>
<span id="cb18-19"><a href="#cb18-19" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"inform_post"</span>,<span class="st">"post"</span>,<span class="st">"officer-involv"</span>,</span>
<span id="cb18-20"><a href="#cb18-20" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"officer-involv_shoot"</span>))</span>
<span id="cb18-21"><a href="#cb18-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-22"><a href="#cb18-22" aria-hidden="true" tabindex="-1"></a>vocab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Number of docs: 133 
175 stopwords: i, me, my, myself, we, our ... 
ngram_min = 1; ngram_max = 2 
Vocabulary: 
                term term_count doc_count
              &lt;char&gt;      &lt;int&gt;     &lt;int&gt;
  1:   advanc_toward         10         7
  2:         announc         10         8
  3: approach_driver         10         9
  4:        cartridg         10         9
  5:  district_place         10        10
 ---                                     
514:           shoot        102        62
515:            door        103        51
516:           point        105        54
517:         suspect        110        21
518:          offend        308        56</code></pre>
</div>
</div>
<p>Now we have a collection of words and word phrases gathered from our documents. Note that it includes so two word phrases (bigrams) with the two stemmed words combined with an underscore between them.</p>
<section id="creating-a-document-term-matrix-dtm" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="creating-a-document-term-matrix-dtm"><span class="header-section-number">2.1</span> Creating a document-term matrix (DTM)</h2>
<p>Our next destination is to create a “document-term matrix” (DTM). A DTM is a matrix representation of a collection of text documents, where each row corresponds to a document and each column corresponds to a unique term (a word or phrase) from the collection of documents. The values in the matrix typically reflect the number of times each term appears in each document. A DTM transforms the unstructured text into a format that machine learning models can work with.</p>
<p>The first step to getting to a DTM with <code>text2vec</code> is to create a “vectorizer”. A vectorizer translates tokenized text into a numeric matrix format, such as a DTM. <code>vocab_vectorizer()</code> creates a function that will take batches of documents, compare them to the vocabulary we built, and produce the associated components of the DTM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vectorizer</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   helper function to convert streams of text into DTM</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>vectorizer <span class="ot">&lt;-</span> <span class="fu">vocab_vectorizer</span>(vocab)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's see what this function looks like!</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>vectorizer</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>function (iterator, grow_dtm, skip_grams_window_context, window_size, 
    weights, binary_cooccurence = FALSE) 
{
    vocab_corpus_ptr = cpp_vocabulary_corpus_create(vocabulary$term, 
        attr(vocabulary, "ngram")[[1]], attr(vocabulary, "ngram")[[2]], 
        attr(vocabulary, "stopwords"), attr(vocabulary, "sep_ngram"))
    setattr(vocab_corpus_ptr, "ids", character(0))
    setattr(vocab_corpus_ptr, "class", "VocabCorpus")
    corpus_insert(vocab_corpus_ptr, iterator, grow_dtm, skip_grams_window_context, 
        window_size, weights, binary_cooccurence)
}
&lt;bytecode: 0x000002180ec247b0&gt;
&lt;environment: 0x000002180ec15310&gt;</code></pre>
</div>
</div>
<p>It is a little difficult to interpret, but we can see that it is going to take in a iterator over our tokenized documents and produce something that will (hopefully!) be useful. Let’s give it a try.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the document-term matrix (DTM)</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   row represents a document</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   column represents a unique term (word or phrase)</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   cell contains the count (or weight) of that term in the document</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>oisDTM <span class="ot">&lt;-</span> <span class="fu">create_dtm</span>(tokens, vectorizer)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>oisDTM[<span class="dv">65</span><span class="sc">:</span><span class="dv">74</span>, <span class="dv">415</span><span class="sc">:</span><span class="dv">424</span>] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> <span class="fu">t</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              20-34 20-33 20-32 20-31 20-30 20-29 20-26 20-24 20-23 20-20
affair            0     0     0     0     0     0     0     0     0     0
intern            0     0     0     0     0     0     0     0     0     0
intern_affair     0     0     0     0     0     0     0     0     0     0
offic_offic       0     3     0     0     0     0     0     0     0     1
sever             0     1     0     0     0     0     3     1     0     5
wound             0     0     1     1     0     1     2     0     0     0
complain          0     0     4     0     0     0    23     0     0     0
dure              0     0     1     0     0     1     0     0     0     0
duti              0     0     0     0     0     0     0     0     0     0
park              0     0     0     1     1     2     3     0     0     0</code></pre>
</div>
</div>
<p>We have a DTM! I have picked a few interesting rows and columns. I also transposed the DTM so it is more readable, but typically the rows are documents and columns are terms. You can see a few non-zero counts in this matrix. These indicate which documents include these terms and how many times that term appears in the document.</p>
<p>Let’s explore further.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># number of documents and words</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(oisDTM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 133 518</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># rows represent individual OIS shooting reports</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(oisDTM)[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "24-37" "24-36" "24-35" "24-32" "24-31"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># columns are the words/phrases</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(oisDTM)[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]     <span class="co"># feature names</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "advanc_toward"   "announc"         "approach_driver" "cartridg"       
 [5] "district_place"  "district_polic"  "drop_gun"        "due"            
 [9] "fled_scene"      "gave"           </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many vocab words in document?</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">rowSums</span>(oisDTM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>24-37 24-36 24-35 24-32 24-31 24-30 24-29 24-28 24-27 24-23 24-22 24-21 24-20 
   56    71   118    56    63    63    62    59    43    84    83    84    96 
24-18 24-17 24-15 24-14 24-13 24-12 24-10 24-09 24-08 24-07 24-06 24-05 24-04 
  110    78   101    81    98   150    95   141   116    96    98   184   242 
24-03 24-02 24-01 23-33 23-31 23-29 23-27 23-26 23-25 23-24 23-23 23-21 23-14 
  101    93   105    74   138    79   142   112    97    92   108   108   101 
23-13 23-10 23-04 22-27 22-26 22-24 22-22 22-15 22-14 22-10 22-09 22-08 22-07 
   77    99   159   116   165   114    94   169   130   251   100   105   113 
22-06 22-05 22-04 22-03 22-01 21-15 21-14 21-12 21-10 21-09 21-06 21-04 20-34 
  179   140    89    98    94    93    92   165   163    70   109   174    65 
20-33 20-32 20-31 20-30 20-29 20-26 20-24 20-23 20-20 20-15 20-12 20-08 20-07 
  159   143   105   124   115   292   135   104   204   116   126   139   103 
19-23 19-21 19-20 19-14 19-13 19-11 19-09 19-06 19-04 18-28 18-27 18-26 18-25 
  133   106   166    92   152   118   166   140   131   137   136   136   120 
18-22 18-19 18-17 18-16 18-12 18-08 18-02 18-01 17-37 17-36 17-30 17-28 17-25 
   96   110   133   134    87    92   102   147   145   101    78    78   104 
17-23 17-22 17-20 17-19 17-17 17-13 17-03 16-43 16-40 16-38 16-37 16-35 16-34 
  135   104    93   106   121   114   135   140   150   111   161   137    87 
16-33 16-32 16-30 16-29 16-28 16-19 16-18 16-16 16-13 16-12 16-11 16-10 16-07 
  174   141   143   127    98    92   114   105   109   130   135   129   119 
16-03 16-02 16-01 
  173   131   113 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many documents have these words?</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisDTM)[<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  advanc_toward         announc approach_driver        cartridg  district_place 
             10              10              10              10              10 
 district_polic        drop_gun             due      fled_scene            gave 
             10              10              10              10              10 
    ground_drop      hand_offic   hospit_critic    hospit_polic            june 
             10              10              10              10              10 
          knock            lost          notifi      offic_drew      offic_oper 
             10              10              10              10              10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most common words?</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisDTM) <span class="sc">|&gt;</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> offend suspect   point    door   shoot     two   avenu     dog  toward  patrol 
    308     110     105     103     102     101      99      93      93      90 </code></pre>
</div>
</div>
</section>
<section id="term-frequencyinverse-document-frequency" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="term-frequencyinverse-document-frequency"><span class="header-section-number">2.2</span> Term Frequency–Inverse Document Frequency</h2>
<p>While raw term counts in a document-term matrix tell us how often each word appears, they do not account for how informative or distinctive those words are across the entire collection of documents. Common words like “officer” or “incident” may appear frequently in every report, but they are not useful for distinguishing one document from another. Term frequency-inverse document frequency (TF-IDF) improves on this by weighting terms based on how frequently they appear in a specific document and how rare they are across all documents. This highlights terms that are both common within a document and uncommon elsewhere, making them more meaningful for identifying the unique content of each report.</p>
<p>Term Frequency-Inverse Document Frequency (TF-IDF) gives weights to words in a document in a way that balances:</p>
<ol type="1">
<li><em>Term Frequency</em> (TF): This word must be important in this document</li>
</ol>
<ul>
<li>The more a word appears in a document, the more likely it is to be relevant to the document’s content</li>
<li>If the word “shooting” appears 12 times in a police report, it is probably central to that document</li>
</ul>
<ol start="2" type="1">
<li><em>Inverse Document Frequency</em> (IDF): But if it appears in every document, it is not very informative</li>
</ol>
<ul>
<li>Common words like “officer”, “incident”, or “said” might appear everywhere</li>
<li>IDF <em>downweights</em> those high-frequency but low-discrimination terms</li>
<li>It prefers terms that help <em>distinguish</em> one document from others</li>
</ul>
<p>The formula for TF-IDF for document <span class="math inline">\(i\)</span> and term <span class="math inline">\(j\)</span>:</p>
<p><span class="math display">\[
\mathrm{tfidf}_{ij} = \mathrm{TF}_{ij}\log\frac{N}{\mathrm{DF}_j}
\]</span> where</p>
<ul>
<li><span class="math inline">\(\mathrm{TF}\)</span> is the number of times term <span class="math inline">\(j\)</span> appears in document <span class="math inline">\(i\)</span>. It measures the importance of the term within a document</li>
<li><span class="math inline">\(N\)</span> = total number of documents</li>
<li><span class="math inline">\(\mathrm{DF}_j\)</span> = number of documents containing term <span class="math inline">\(j\)</span></li>
</ul>
<p><span class="math inline">\(\mathrm{IDF}_{ij}=\log\frac{N}{\mathrm{DF}_j}\)</span> captures the rarity across documents. Note that if a word appears in all documents then <span class="math inline">\(\mathrm{tfidf}_{ij} = 0\)</span>. The combination of <span class="math inline">\(\mathrm{TF}\)</span> and <span class="math inline">\(\mathrm{IDF}\)</span> gives a measure of relevance and distinctiveness. A high <span class="math inline">\(\mathrm{tfidf}_{ij}\)</span> means a term appears often in document <span class="math inline">\(i\)</span>, but rarely in other documents. It gives you terms that define a document. These are the terms that are useful for classification, clustering, or topic modeling.</p>
<section id="example" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="example"><span class="header-section-number">2.2.1</span> Example</h3>
<p>Assume there are <span class="math inline">\(N=100\)</span> documents.</p>
<table class="table">
<thead>
<tr class="header">
<th>Term</th>
<th>TF in Doc A</th>
<th>DF across corpus</th>
<th>IDF</th>
<th>TF-IDF</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>“weapon”</td>
<td>5</td>
<td>10</td>
<td>2.3</td>
<td>11.5</td>
</tr>
<tr class="even">
<td>“officer”</td>
<td>6</td>
<td>95</td>
<td>0.1</td>
<td>0.3</td>
</tr>
<tr class="odd">
<td>“said”</td>
<td>20</td>
<td>100</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table>
<ul>
<li>“weapon” gets a high score, specific and relevant</li>
<li>“officer” is common, downweighted</li>
<li>“said” is everywhere, zeroed out</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># TF-IDF: term frequency–inverse document frequency weights</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="co">#    downweights common words that appear in many documents</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    upweights rare words that are more informative or distinctive</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="co"># TF: How often a word appears in a document</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="co"># IDF: How rare that word is across all documents</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="co">#    TF-IDF = TF × log(N / DF)</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a><span class="co">#       N = total number of documents</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="co">#       DF = number of documents containing the term</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>tfidf_transformer <span class="ot">&lt;-</span> TfIdf<span class="sc">$</span><span class="fu">new</span>()</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>oisTFIDF <span class="ot">&lt;-</span> tfidf_transformer<span class="sc">$</span><span class="fu">fit_transform</span>(oisDTM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s take a look at those same rows and columns that we did before for the DTM. The matrix looks largely the same, just everything scaled down.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>oisTFIDF[<span class="dv">65</span><span class="sc">:</span><span class="dv">74</span>, <span class="dv">415</span><span class="sc">:</span><span class="dv">424</span>] <span class="sc">|&gt;</span> <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span> <span class="fu">round</span>(<span class="dv">2</span>) <span class="sc">|&gt;</span> <span class="fu">t</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              20-34 20-33 20-32 20-31 20-30 20-29 20-26 20-24 20-23 20-20
affair            0  0.00  0.00  0.00  0.00  0.00  0.00  0.00     0  0.00
intern            0  0.00  0.00  0.00  0.00  0.00  0.00  0.00     0  0.00
intern_affair     0  0.00  0.00  0.00  0.00  0.00  0.00  0.00     0  0.00
offic_offic       0  0.03  0.00  0.00  0.00  0.00  0.00  0.00     0  0.01
sever             0  0.01  0.00  0.00  0.00  0.00  0.02  0.01     0  0.04
wound             0  0.00  0.01  0.01  0.00  0.01  0.01  0.00     0  0.00
complain          0  0.00  0.07  0.00  0.00  0.00  0.20  0.00     0  0.00
dure              0  0.00  0.01  0.00  0.00  0.01  0.00  0.00     0  0.00
duti              0  0.00  0.00  0.00  0.00  0.00  0.00  0.00     0  0.00
park              0  0.00  0.00  0.02  0.01  0.03  0.02  0.00     0  0.00</code></pre>
</div>
</div>
<p>Let’s compare the top features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View top features by TF</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisDTM) <span class="sc">%&gt;%</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> offend suspect   point    door   shoot     two   avenu     dog  toward  patrol 
    308     110     105     103     102     101      99      93      93      90 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># View top features by TF-IDF</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colSums</span>(oisTFIDF) <span class="sc">%&gt;%</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sort</span>(<span class="at">decreasing =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      offend          dog      suspect        shoot        knife        avenu 
    3.124350     2.212498     1.819930     1.134967     1.098324     1.087595 
      driver       victim        resid polic_vehicl 
    1.000676     1.000078     0.993729     0.993306 </code></pre>
</div>
</div>
<p>The TF-IDF does change which terms make the top-10 list. We see “knife” and “driver” show up and “door” and “point” drop off.</p>
<!-- Why does "resid" show up in this list? -->
<!-- ```{r} -->
<!-- oisDTM[,"resid"] -->
<!-- # highlight the word "post" in the report -->
<!-- ois |>  -->
<!--   filter(id=="20-20") |>  -->
<!--   pull(text) |>  -->
<!--   gsub("resid", bgYellow$black("resid"), x=_) |>  -->
<!--   cat() -->
<!-- ``` -->
</section>
</section>
</section>
<section id="term-co-occurrence-matrix-tcm" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Term co-occurrence matrix (TCM)</h1>
<p>There may be some concepts that are not limited to a single word or a few adjacent words. Term co-occurrence looks for words that tend to appear close to each other in text to possibly help you expand the vocabulary to additional phrases. A term co-occurrence matrix (TCM) captures how often pairs of words appear near each other within a given window of text, such as a sentence or a few neighboring words. Unlike a document-term matrix, which represents the relationship between documents and individual terms, a TCM focuses on the relationships between terms themselves. This is useful for uncovering word associations and identifying common phrases. In our case, we will use the TCM to explore how certain words, such as “officer,” “suspect,” or “weapon,” tend to co-occur across police shooting reports, revealing patterns that might not be visible from frequency counts alone.</p>
<p>When scanning through each document, setting <code>skip_grams_window = 5</code> will treat any two terms that appear within a window of 5 tokens as co-occurring. For example, if the document has the phrase “the officer shot the suspect with a weapon” and we set <code>skip_grams_window = 5</code>, then for the word “shot” it will consider “the”, “officer”, “the”, “suspect”, “with” as co-occurring terms.</p>
<p>We will use <code>create_tcm()</code> to create a TCM. The <span class="math inline">\((i,j)\)</span> element of the TCM will be the number of times term <span class="math inline">\(i\)</span> occurs within 5 terms of term <span class="math inline">\(j\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a co-occurrence matrix (Feature Co-occurrence Matrix)</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>oisTCM <span class="ot">&lt;-</span> <span class="fu">itoken</span>(ois<span class="sc">$</span>text,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">tokenizer =</span> oisTokenizer,</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">progressbar =</span> <span class="cn">FALSE</span>,</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">ids =</span> ois<span class="sc">$</span>id) <span class="sc">|&gt;</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">create_tcm</span>(<span class="fu">vocab_vectorizer</span>(vocab), </span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">skip_grams_window =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This will be a little easier to visualize if we convert to a long (rather than wide) format.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to triplet format and extract top co-occurring pairs</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>oisPairs <span class="ot">&lt;-</span> Matrix<span class="sc">::</span><span class="fu">summary</span>(oisTCM) <span class="sc">|&gt;</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(i <span class="sc">!=</span> j) <span class="sc">|&gt;</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">feature1 =</span> i, <span class="at">feature2 =</span> j, <span class="at">weight =</span> x) <span class="sc">|&gt;</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">feature1 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(oisTCM),</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>                       <span class="at">term1 =</span> <span class="fu">colnames</span>(oisTCM)),</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(feature1))  <span class="sc">|&gt;</span></span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(<span class="fu">data.frame</span>(<span class="at">feature2 =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(oisTCM),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">term2 =</span> <span class="fu">colnames</span>(oisTCM)),</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">by =</span> <span class="fu">join_by</span>(feature2)) <span class="sc">|&gt;</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>feature1, <span class="sc">-</span>feature2) <span class="sc">|&gt;</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(term1 <span class="sc">!=</span> term2) <span class="sc">|&gt;</span></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">str_detect</span>(term1, <span class="fu">fixed</span>(term2)) <span class="sc">&amp;</span> </span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>           <span class="sc">!</span><span class="fu">str_detect</span>(term2, <span class="fu">fixed</span>(term1)))</span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>oisPairs <span class="sc">|&gt;</span></span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight)) <span class="sc">|&gt;</span></span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">50</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     weight                  term1               term2
1  30.00000           offic_provid       provid_inform
2  30.00000               lead_new          new_inform
3  30.00000          investig_lead            lead_new
4  30.00000              may_updat      updat_investig
5  30.00000              incid_may           may_updat
6  30.00000              incid_may         short_incid
7  30.00000             occur_time          time_incid
8  30.00000             occur_time    understand_occur
9  30.00000 preliminari_understand    understand_occur
10 30.00000 preliminari_understand reflect_preliminari
11 30.00000                reflect         preliminari
12 30.00000    reflect_preliminari     summari_reflect
13 30.00000                reflect             summari
14 30.00000         origin_summari     summari_reflect
15 30.00000                summari              origin
16 30.00000         origin_summari         post_origin
17 30.00000             understand         preliminari
18 30.00000          investig_lead      updat_investig
19 30.00000                   lead                 new
20 30.00000             post_short         short_incid
21 30.00000         investig_prior        ppd_investig
22 29.50000            prior_charg         charg_decis
23 29.50000            prior_charg      investig_prior
24 25.00000                 affair              intern
25 24.00000              administr                duti
26 24.00000                 outcom                pend
27 24.00000              administr               place
28 23.50000              duti_pend      administr_duti
29 23.50000                   duti                pend
30 23.00000         administr_duti     place_administr
31 23.00000              duti_pend         pend_outcom
32 20.00000           ppd_investig               prior
33 20.00000                   lead          new_inform
34 20.00000          investig_lead                 new
35 20.00000          investig_lead               updat
36 20.00000              incid_may               updat
37 20.00000             occur_time          understand
38 20.00000    reflect_preliminari          understand
39 20.00000 preliminari_understand             reflect
40 20.00000        summari_reflect         preliminari
41 20.00000    reflect_preliminari             summari
42 20.00000        summari_reflect              origin
43 20.00000            post_origin             summari
44 20.00000         origin_summari             reflect
45 20.00000                   lead      updat_investig
46 20.00000       understand_occur         preliminari
47 19.86667            charg_decis               prior
48 19.66667            prior_charg               decis
49 19.25000                   mark              patrol
50 18.50000                  stabl              condit</code></pre>
</div>
</div>
<p>Much of this co-occurrence is due to the template language describing where the department is in the investigation, referrals to the district attorney, and the report offers preliminary summary.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Template language on the report">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Template language on the report
</div>
</div>
<div class="callout-body-container callout-body">
<p>*** Information posted in the original summary reflects a preliminary understanding of what occurred at the time of the incident. This information is posted shortly after the incident and may be updated as the investigation leads to new information. The District Attorney’s Office is provided all the information from the PPD’s investigation prior to their charging decision.</p>
</div>
</div>
<p>Further on down the list some term pairs a more interesting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>oisPairs <span class="sc">|&gt;</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(weight <span class="sc">&gt;=</span> <span class="dv">8</span> <span class="sc">&amp;</span> weight <span class="sc">&lt;=</span><span class="dv">9</span>) <span class="sc">|&gt;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     weight                 term1             term2
1  9.000000        firearm_strike  discharg_firearm
2  9.000000        univers_hospit             templ
3  9.000000                driver              door
4  9.000000                  open              door
5  8.999996             duti_pend             place
6  8.750000                attack               dog
7  8.666667         respond_radio              call
8  8.666667 affair_officer-involv             shoot
9  8.666667 affair_officer-involv            intern
10 8.500000       inform_district        new_inform
11 8.500000                intern              pend
12 8.500000        attorney_offic      offic_provid
13 8.500000       inform_district district_attorney
14 8.500000            offic_mark        mark_polic
15 8.500000                return              fire
16 8.500000          semi-automat            pistol
17 8.500000                  drop            offend
18 8.250000           pend_outcom     intern_affair
19 8.250000         outcom_intern         duti_pend
20 8.250000                outcom            affair
21 8.250000                  miss            offend
22 8.250000                 knife              drop
23 8.000001                unmark      polic_vehicl
24 8.000000                 arriv             locat</code></pre>
</div>
</div>
</section>
<section id="singular-value-decomposition-for-text" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Singular value decomposition for text</h1>
<p>We already explored how SVD can be used to <a href="https://raw.githack.com/gregridgeway/ML4SocialScience/main/L7-svd.html">compress images and classify emojis</a>. Now we will explore what SVD does for text.</p>
<p>Since TFIDF matrices can get large, we will use the SVD implementation in the IRLBA package (Implicitly Restarted Lanczos Bidiagonalization Algorithm). The IRLBA implementation of SVD allows you to limit the number of singular vectors to compute, ignoring and never computing the rest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(irlba)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>oisSVD <span class="ot">&lt;-</span> <span class="fu">irlba</span>(<span class="fu">t</span>(oisTFIDF), <span class="at">nv =</span> <span class="dv">50</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="co"># each run of SVD can switch the signs on U and V</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    this forces sign(v[1,]) = +1, so SVD is unique</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>oisSVD<span class="sc">$</span>u <span class="ot">&lt;-</span> <span class="fu">sweep</span>(oisSVD<span class="sc">$</span>u, <span class="dv">2</span>, <span class="fu">sign</span>(oisSVD<span class="sc">$</span>v[<span class="dv">1</span>,]), <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>oisSVD<span class="sc">$</span>v <span class="ot">&lt;-</span> <span class="fu">sweep</span>(oisSVD<span class="sc">$</span>v, <span class="dv">2</span>, <span class="fu">sign</span>(oisSVD<span class="sc">$</span>v[<span class="dv">1</span>,]), <span class="st">`</span><span class="at">*</span><span class="st">`</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s see how many singular vectors seem important. In <a href="#fig-SVDsingularvalues" class="quarto-xref">Figure&nbsp;1</a> we see the first two or three singular values seem large, but then they decrease quite slowly from there.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(oisSVD<span class="sc">$</span>d, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"Index of the singular value"</span>, </span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="st">"Singular value"</span>,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(oisSVD<span class="sc">$</span>d)),</span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">pch=</span><span class="dv">16</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-SVDsingularvalues" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-SVDsingularvalues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-SVDsingularvalues-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-SVDsingularvalues-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Singular values from SVD of <code>oisTFIDF</code>
</figcaption>
</figure>
</div>
</div>
</div>
<p>The columns of <span class="math inline">\(\mathbf{U}\)</span> are our “eigendocuments,” the fundamental building blocks that the actual documents blend to form their word collections. We will take a look at the first five eigendocuments, highlighting the 10 terms with the highest weight in the left singular vectors. Note that both large positive and large negative values are important to interpret. I have added headings to each left singular vector summarizing what kinds of incidents might heavily weight this column of <span class="math inline">\(\mathbf{U}\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Stack the top 10 terms from each component into one long table</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">term=</span><span class="fu">colnames</span>(oisTFIDF),</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">u1=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">1</span>],</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">u2=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">2</span>],</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>           <span class="at">u3=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">3</span>],</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>           <span class="at">u4=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">4</span>],</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>           <span class="at">u5=</span>oisSVD<span class="sc">$</span>u[,<span class="dv">5</span>])</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>a <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(a <span class="sc">|&gt;</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(term, u1) <span class="sc">|&gt;</span> </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u1))) <span class="sc">|&gt;</span> </span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u1"</span>, <span class="at">u =</span> u1),</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>               a <span class="sc">|&gt;</span> </span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(term, u2) <span class="sc">|&gt;</span> </span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u2))) <span class="sc">|&gt;</span> </span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u2"</span>, <span class="at">u =</span> u2),</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>               a <span class="sc">|&gt;</span> </span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(term, u3) <span class="sc">|&gt;</span> </span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u3))) <span class="sc">|&gt;</span> </span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u3"</span>, <span class="at">u =</span> u3),</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>               a <span class="sc">|&gt;</span> </span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(term, u4) <span class="sc">|&gt;</span> </span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u4))) <span class="sc">|&gt;</span> </span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u4"</span>, <span class="at">u =</span> u4),</span>
<span id="cb50-29"><a href="#cb50-29" aria-hidden="true" tabindex="-1"></a>               a <span class="sc">|&gt;</span> </span>
<span id="cb50-30"><a href="#cb50-30" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">select</span>(term, u5) <span class="sc">|&gt;</span> </span>
<span id="cb50-31"><a href="#cb50-31" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">arrange</span>(<span class="fu">desc</span>(<span class="fu">abs</span>(u5))) <span class="sc">|&gt;</span> </span>
<span id="cb50-32"><a href="#cb50-32" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">|&gt;</span> </span>
<span id="cb50-33"><a href="#cb50-33" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">mutate</span>(<span class="at">component =</span> <span class="st">"u5"</span>, <span class="at">u =</span> u5)) <span class="sc">|&gt;</span> </span>
<span id="cb50-34"><a href="#cb50-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(component, term, u)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Escape _ in all character columns</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (knitr<span class="sc">::</span><span class="fu">is_latex_output</span>()) {</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  a <span class="ot">&lt;-</span> a <span class="sc">|&gt;</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character),</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">~</span> <span class="fu">str_replace_all</span>(.x, <span class="st">"_"</span>, <span class="st">"</span><span class="sc">\\\\</span><span class="st">_"</span>)))</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>a <span class="sc">|&gt;</span> </span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(component) <span class="sc">|&gt;</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rank =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> component, </span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> <span class="fu">c</span>(term, u),</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_sep =</span> <span class="st">"_"</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(term_u1, u_u1, term_u2, u_u2, term_u3, u_u3,</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>         term_u4, u_u4, term_u5, u_u5) <span class="sc">|&gt;</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">align =</span> <span class="st">"rrrrrrrrrr"</span>,</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> header_labels,</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>        <span class="at">digits =</span> <span class="dv">2</span>,</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        <span class="at">escape =</span> <span class="cn">FALSE</span>,</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        <span class="at">booktabs =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">"Offender and dog"</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Dog attack, no offender"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Suspect/SWAT"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"Knife attacks"</span> <span class="ot">=</span> <span class="dv">2</span>,</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"?"</span> <span class="ot">=</span> <span class="dv">2</span>),</span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>                   <span class="at">escape =</span> <span class="cn">FALSE</span>) <span class="sc">|&gt;</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>,</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>                <span class="at">latex_options =</span> <span class="st">"scale_down"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-uterms" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-uterms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Top 10 Terms for First 5 SVD Components
</figcaption>
<div aria-describedby="tbl-uterms-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="table do-not-create-environment cell table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Offender and dog
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Dog attack, no offender
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Suspect/SWAT
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Knife attacks
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; border-bottom: hidden; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
?
</div></th>
</tr>
<tr class="odd">
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_1\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_2\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_3\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_4\)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">\(u_5\)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">dog</td>
<td style="text-align: right;">0.26</td>
<td style="text-align: right;">dog</td>
<td style="text-align: right;">0.50</td>
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">-0.61</td>
<td style="text-align: right;">knife</td>
<td style="text-align: right;">0.44</td>
<td style="text-align: right;">knife</td>
<td style="text-align: right;">-0.53</td>
</tr>
<tr class="even">
<td style="text-align: right;">offend</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">-0.31</td>
<td style="text-align: right;">dog</td>
<td style="text-align: right;">0.33</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">-0.32</td>
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">-0.31</td>
</tr>
<tr class="odd">
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">0.17</td>
<td style="text-align: right;">attack</td>
<td style="text-align: right;">0.21</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">0.20</td>
<td style="text-align: right;">number</td>
<td style="text-align: right;">-0.30</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">-0.24</td>
</tr>
<tr class="even">
<td style="text-align: right;">shoot</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">bull</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">swat</td>
<td style="text-align: right;">-0.18</td>
<td style="text-align: right;">suspect</td>
<td style="text-align: right;">-0.28</td>
<td style="text-align: right;">number</td>
<td style="text-align: right;">-0.20</td>
</tr>
<tr class="odd">
<td style="text-align: right;">attack</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">pit_bull</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">number_one</td>
<td style="text-align: right;">-0.26</td>
<td style="text-align: right;">drop_knife</td>
<td style="text-align: right;">-0.19</td>
</tr>
<tr class="even">
<td style="text-align: right;">resid</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">pit</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">attack</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">drop_knife</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">number_one</td>
<td style="text-align: right;">-0.19</td>
</tr>
<tr class="odd">
<td style="text-align: right;">victim</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">offic_number</td>
<td style="text-align: right;">-0.12</td>
<td style="text-align: right;">number</td>
<td style="text-align: right;">0.14</td>
<td style="text-align: right;">victim</td>
<td style="text-align: right;">0.15</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">0.14</td>
</tr>
<tr class="even">
<td style="text-align: right;">avenu</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">number</td>
<td style="text-align: right;">-0.11</td>
<td style="text-align: right;">swat_offic</td>
<td style="text-align: right;">-0.14</td>
<td style="text-align: right;">drop</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">rear</td>
<td style="text-align: right;">0.13</td>
</tr>
<tr class="odd">
<td style="text-align: right;">knife</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">number_one</td>
<td style="text-align: right;">-0.10</td>
<td style="text-align: right;">number_one</td>
<td style="text-align: right;">0.13</td>
<td style="text-align: right;">bedroom</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">unmark</td>
<td style="text-align: right;">0.12</td>
</tr>
<tr class="even">
<td style="text-align: right;">depart</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">veteran</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">male_suspect</td>
<td style="text-align: right;">-0.13</td>
<td style="text-align: right;">offend</td>
<td style="text-align: right;">0.10</td>
<td style="text-align: right;">area</td>
<td style="text-align: right;">0.11</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>Note that “dog” shows up with a large absolute value in the first three left singular vectors. Even if there is a large negative value, that still means the term is important. A report of shooting a pit bull will have a large negative value for its <span class="math inline">\(v_2\)</span>, signalling a heavy presence of dog, pit bull, and attack terms, but the absence of the “offender” term. The first left singular vector measure the combined presence of “dog,” “offender,” and “suspect” (or the absence of all three if a document’s value of <span class="math inline">\(v_1\)</span> is large and negative.</p>
<p>Remember that the columns of <span class="math inline">\(\mathbf{V}\)</span> tell us how a particular report mixes together the eigendocuments (columns of <span class="math inline">\(\mathbf{U}\)</span>) to form their TFIDF weighted terms. I am curious to explore documents involving dog attacks (<span class="math inline">\(\mathbf{u}_2\)</span>) and documents with knife attacks (<span class="math inline">\(\mathbf{u}_4\)</span>). The code below creates an interactive 2D map of documents on their values of <span class="math inline">\(v_2\)</span> and <span class="math inline">\(v_4\)</span>. For each document, the code extracts the 10 most heavily weighted TF-IDF terms to use as hover text, giving a quick sense of the content. It also assigns each document to a category, “Likely dog attack,” “Likely knife attack,” or “Other,” based on thresholds of <span class="math inline">\(v_2\)</span> and <span class="math inline">\(v_4\)</span>. <code>plotly()</code> produces an interactive scatterplot where each point is a document, colored by category and annotated with its key terms. This visualization allows us to explore thematic variation in the reports and visually distinguish different types of incidents based on the language used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plotly)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># collect the 10 terms with the highest weight in each document</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>i <span class="ot">&lt;-</span> <span class="fu">apply</span>(oisTFIDF, <span class="dv">1</span>, order, <span class="at">decreasing=</span><span class="cn">TRUE</span>)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>hovertext <span class="ot">&lt;-</span> <span class="fu">apply</span>(i, <span class="dv">2</span>, </span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>                   <span class="cf">function</span>(j) </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>                   {</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">colnames</span>(oisTFIDF)[j[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]] <span class="sc">|&gt;</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>                   })</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a><span class="co"># label some document types</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>group <span class="ot">&lt;-</span> <span class="fu">case_when</span>(oisSVD<span class="sc">$</span>v[,<span class="dv">2</span>] <span class="sc">&gt;</span> <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"Likely dog attack"</span>,</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>                   oisSVD<span class="sc">$</span>v[,<span class="dv">4</span>] <span class="sc">&gt;</span> <span class="fl">0.1</span> <span class="sc">~</span> <span class="st">"Likely knife attack"</span>,</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Other"</span>)</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>groupCols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Likely dog attack"</span> <span class="ot">=</span> <span class="st">"red"</span>,</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Likely knife attack"</span> <span class="ot">=</span> <span class="st">"orange"</span>,</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Other"</span> <span class="ot">=</span> <span class="st">"steelblue"</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a><span class="co"># make a plot with hovertext</span></span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(<span class="at">x =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">2</span>],</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">4</span>],</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>        <span class="at">text =</span> hovertext,</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>        <span class="at">hoverinfo =</span> <span class="st">"text"</span>,</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">color =</span> group,</span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">colors =</span> groupCols,</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">6</span>)) <span class="sc">|&gt;</span></span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(<span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"V2 - Dog attack measure"</span>),</span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"V4 - Knife attack measure"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-documentMap" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-documentMap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-019b70a20067b459f2e4" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-019b70a20067b459f2e4">{"x":{"visdat":{"73a09e6608":["function () ","plotlyVisDat"]},"cur_data":"73a09e6608","attrs":{"73a09e6608":{"x":[0.18161875587789689,0.11572360794264425,-0.0019788713728065717,0.17877124283368384,0.022223821264152923,0.18259981991707092,0.11707134487490918,0.061167241620392346,0.05572097583763206,0.1685067836463737,0.16374104976200621,0.048273649645646469,0.033926441809114423,0.21204170471713843,0.02054790385483761,0.14751141714765928,0.27223024324059197,0.21900917326533437,0.018577428260032672,0.15651561529202304,0.0081574778119158087,0.21117828010095682,0.044146742468963475,0.16906490917093736,-0.020444727606716701,-0.019688882975228771,0.033479502282273005,0.044488847114346149,0.16140495714203171,0.1291528926248714,0.038955610515428132,0.14319779874135449,0.034513205577909781,0.15715001234373499,0.010288774058011515,0.028026034813560894,0.0051619495486397212,-0.010960374257623993,-0.030801485117322062,0.0034805026327011305,-0.04537296656073616,-0.029218619199922257,-0.01581894389017682,0.021759934033232672,-0.10195414139595692,-0.075582185895513701,0.0082711645406465424,-0.003816032820549816,-0.0090294497149071146,0.011946510583231498,-0.04784603891168452,-0.074302718196757406,-0.0061615587655334241,-0.069463137440628639,-0.038615261481704154,-0.0054909352281676425,0.0039205632203706585,-0.075457978192816078,-0.055179220140726085,-0.0073223667718193075,-0.041430095428084013,-0.03856773579959237,-0.017835534277815427,-0.044649955663984775,-0.055517186343691252,-0.043525980650874013,-0.010785309029566622,-0.018800689621417694,-0.035265350888931582,-0.052368279640408327,-0.051409710766081904,-0.034207072019543656,-0.040655204858792919,-0.038890557656961464,-0.038987763380822112,-0.0429512129916272,-0.045648128441618453,-0.054518156209489084,-0.04637327243463224,-0.039908186961754598,-0.044414605916259203,-0.066320446211673073,-0.044769638626015774,-0.0473578282716101,-0.052404098414888155,-0.059307027123973996,-0.056645432021001585,-0.041634832202926478,-0.046675899727654395,-0.034090937987938885,-0.050356933614642496,-0.055910170380923011,-0.054914686535615653,-0.056871431498744726,-0.03753800244911653,-0.091381277492467064,-0.090664280006923004,-0.074810860787178662,-0.10524991876150692,-0.067975793704709339,-0.069922810025450463,-0.069184758056329981,-0.080422748552774551,-0.12826536685842249,-0.11433017564914451,-0.068300567015818783,-0.08880749330514702,-0.069338953255502808,-0.070404913327719545,-0.10441397207560431,-0.1260104065008332,-0.07775840918543836,-0.1035919549572657,-0.11536478039227689,-0.096572852746188889,-0.0842223455146862,-0.089363072445301409,-0.0960114911379851,-0.082579749139763001,-0.088826183218488619,-0.071017011830248875,-0.080397971558564083,-0.07021981716928441,-0.079212195080423126,-0.089976583088172218,-0.087500908125515434,-0.087191210821466705,-0.10666919804154303,-0.094477686770881322,-0.088159755127270603,-0.081527310486232837,-0.078845635288058144,-0.095375442585102707],"y":[0.0017833708784454534,0.026569286265513609,0.028062219000326113,0.0016155413579507472,-0.0012174507505042875,0.0054863465404176668,-0.029249992825769771,-0.016032324730352623,-0.0095094548182538992,0.014377483980066538,-0.031890670339162833,-0.088578753762323395,-0.14080769307724081,-0.0089616712152537203,-0.088041055984499655,-0.01226850897186647,-0.056026803263791641,-0.034467898616003259,-0.14510182790859877,-0.010958400083721471,0.064070142412028019,-0.025347629861140721,-0.09324209742625994,-0.0086722918441300926,0.0020048805512994203,-0.054342424489183166,-0.036637891451628102,-0.057531427800208736,0.0020293933058213778,0.0037744216461379448,-0.060228857146685931,0.016466450689725937,-0.03335026236486318,-0.011107182227914058,-0.021807971564354531,0.022369394719020289,-0.034592975321655152,0.0026087999263665514,0.075699193612745588,0.057166765509667761,0.019873437187986412,-0.00039815745097952554,0.050391398706272954,0.017951521749538887,0.097036808972097835,0.13457920790383368,0.11057925167590818,0.042379116951025357,0.062577481071961288,0.028035523811706271,-0.0047856841845396007,0.30646312055343927,0.034588446579627626,0.033633104999057924,0.0060864595370706013,0.088353965926887879,0.052217714108848533,0.11264483928614399,0.090615666836769332,0.03313434403820905,0.02384876200724198,0.011727398691742993,0.077349495067085092,-0.0005204755569056768,0.12332948577297706,0.30955549960705209,-0.077075957077814602,0.07775906447634677,-0.09928607457617751,0.355596687154769,0.060974168727251386,0.020029917711223602,0.021797952052797675,0.010154282915942132,0.015760206177842049,-0.0091853272269314008,-0.015159159052058776,-0.034761383506973276,0.023848730831525857,-0.03167789932274518,0.053423382053371528,-0.02704292431794111,-0.051288222993424691,0.0097846125264502391,-0.017466716242592783,0.011245255456921351,0.17499752751217432,0.097226821318498843,0.010986243071695299,0.046368576997416387,-0.019639765015640083,-0.025923798349069081,-0.037341552706520342,0.0083973836661508719,0.013806815505300753,0.015582341250900317,-0.096390797147250573,-0.0077047404613864974,-0.21005101157350597,-0.041086621619146772,-0.050921668865837981,0.14042189150603729,-0.08215726891377427,-0.23757147088371255,-0.28450182634790511,-0.017204463556087197,-0.017328912428149549,0.008180096087979814,-0.017621919927969316,0.020229600239448718,-0.30392183026856012,-0.014616193536108275,-0.10107790204162594,-0.14796624660787633,0.1168764145682705,-0.13164228991861443,-0.0011320985889625096,-0.0020871810885483141,0.067370922661573018,-0.022110814479791376,-0.0036648986243317792,-0.030175276321226328,-0.030783965257854904,0.042302826451645473,-0.010741623006341698,-0.015500325869965491,0.019393963392577825,-0.010541969650638413,0.010025767359613387,-0.038600183460216875,-0.024154673753716369,-0.041228465201162724,-0.029925815214597463],"mode":"markers","text":["dog<br />narcot<br />back<br />secur<br />unit<br />insid_properti<br />compli<br />onc<br />tuesday<br />retreat","dog<br />district_offic<br />femal<br />polic_district<br />bedroom<br />insid<br />kill<br />locat_offic<br />call_person<br />offic_heard","servic<br />sergeant<br />year<br />wit<br />involv<br />male_point<br />investig_unit<br />home<br />unknown<br />complain","dog<br />narcot<br />block_e<br />resid<br />retreat<br />involv_shoot<br />kitchen<br />offic_involv<br />bull<br />pit_bull","detect<br />shoot<br />seat<br />person<br />unit<br />homicid<br />vehicl_approach<br />investig_unit<br />involv_shoot<br />offic_involv","dog<br />femal<br />partner<br />insid<br />kill<br />went<br />avenu<br />outsid<br />home<br />offic_heard","dog<br />septemb<br />encount<br />white<br />area<br />avenu<br />scene_injuri<br />camera_activ<br />retreat<br />subsequ","injur<br />polic_district<br />polic_depart<br />veteran<br />depart<br />investig_unit<br />duti<br />conduct<br />septemb<br />offic_transport","room<br />district_place<br />one_round<br />duti<br />discharg_one<br />incid_offic<br />place<br />affair_investig<br />septemb<br />shoot","dog<br />resid<br />polic_depart<br />dure<br />assault<br />depart<br />shout<br />went<br />use<br />district_place","dog<br />west<br />anim<br />bull<br />pit_bull<br />pit<br />kill<br />servic<br />june<br />offic_arriv","suspect<br />one_offic<br />year<br />shot<br />discharg_offic<br />driver<br />male_suspect<br />june<br />use<br />blue","suspect<br />block_north<br />saturday<br />uniform_offic<br />north<br />unit<br />due<br />june<br />district_place<br />conduct","dog<br />resid<br />attack<br />ongo<br />block_north<br />medic<br />two<br />north<br />black<br />anim","suspect<br />graze<br />male_suspect<br />white<br />robberi<br />off-duti<br />sustain<br />dure<br />wound<br />announc","sergeant<br />bull<br />pit_bull<br />pit<br />discharg_offic<br />attack<br />also<br />year_old<br />old<br />dog","attack<br />dog<br />bull<br />pit_bull<br />pit<br />kill<br />year<br />anim<br />district_place<br />larg","attack<br />dog<br />owner<br />bull<br />pit_bull<br />block_south<br />pit<br />control<br />femal<br />south","suspect<br />off-duti<br />assault<br />robberi<br />take<br />struggl<br />dure<br />male_suspect<br />remain<br />violat","dog<br />kill<br />wit<br />bull<br />pit_bull<br />pit<br />attack<br />bodi<br />victim<br />depart","complain<br />front_door<br />knock<br />outsid<br />taken<br />unit<br />subsequ<br />took<br />arm<br />front","bull<br />pit_bull<br />pit<br />dog<br />attack<br />owner<br />control<br />stop<br />discharg_offic<br />offic_offic","suspect<br />stolen<br />vehicl_offic<br />polic_district<br />driver<br />attempt<br />male_suspect<br />black<br />fled_scene<br />approach_driver","dog<br />attack<br />anim<br />depart<br />avenu<br />later<br />polic_depart<br />shout<br />highway<br />bodi_worn","magazin<br />block_north<br />offend<br />park<br />black<br />north<br />live<br />handgun<br />live_round<br />round","passeng<br />suspect<br />open<br />driver<br />door<br />strike_offic<br />driver_side<br />window<br />fled_scene<br />side","suspect<br />veteran_philadelphia<br />templ_univers<br />univers_hospit<br />depart_assign<br />shot<br />univers<br />shoot<br />person<br />polic_depart","swat<br />suspect<br />swat_offic<br />assist<br />year_old<br />respond_offic<br />old<br />still<br />year<br />direct","dog<br />yard<br />bull<br />pit_bull<br />owner<br />pit<br />resid<br />year_old<br />old<br />year","block_south<br />resid<br />dog<br />south<br />offic_offic<br />drew_weapon<br />made<br />bull<br />pit_bull<br />polic_offic","highway<br />graze<br />suspect<br />patrol<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />assault<br />depart","dog<br />attack<br />victim<br />wit<br />violat<br />home<br />highway<br />bull<br />pit_bull<br />bodi_worn","suspect<br />sergeant<br />home<br />depart<br />encount<br />shot<br />veteran<br />involv<br />verbal<br />one_time","dog<br />anim<br />remain<br />control<br />dure_incid<br />injur<br />three<br />sustain<br />polic_depart<br />dure","suspect<br />shoot<br />victim<br />passeng<br />pronounc_deceas<br />deceas<br />driver<br />unit<br />pronounc<br />wound","suspect<br />knife<br />ecw<br />deploy<br />offic_respond<br />began<br />advanc_toward<br />step<br />male_suspect<br />white","robberi<br />victim<br />suspect<br />approach_male<br />polic_vehicl<br />gun<br />follow<br />vehicl_offic<br />phone<br />drop_gun","side_door<br />door_offic<br />side<br />passeng<br />approach_driver<br />passeng_side<br />car<br />driver_side<br />driver<br />onto","lot<br />gun_offic<br />rear<br />bodi<br />ground<br />car<br />handgun<br />gun<br />pm_offic<br />strike_male","phone<br />detect<br />swat<br />one_time<br />properti<br />struck<br />enter<br />bedroom<br />swat_offic<br />announc","offend<br />offic_involv<br />gun_offic<br />observ_offend<br />area<br />involv<br />discharg_offic<br />turn<br />left<br />offic_offic","offic_involv<br />offend<br />side_door<br />involv<br />involv_shoot<br />side<br />taken<br />block_north<br />driver<br />shoot","swat<br />gsw<br />sustain<br />unit<br />insid_properti<br />front<br />properti<br />north<br />offend<br />rear","fire<br />cover<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />depart<br />district_offic<br />approach_male<br />arriv_locat","offend<br />gun<br />point_gun<br />lot<br />drop_gun<br />offend_drop<br />gun_offic<br />around<br />began<br />drop","offend<br />victim<br />east<br />handgun<br />gun<br />one_time<br />locat<br />return<br />partner<br />point_gun","victim<br />one_time<br />shot<br />shoot<br />left<br />unknown<br />area<br />south<br />homicid<br />shoulder","room<br />offic_offic<br />oper<br />hospit_polic<br />open_door<br />discharg_offic<br />sever_time<br />window<br />templ_hospit<br />pull","gsw<br />victim<br />discharg_offic<br />locat<br />offic_arriv<br />locat_offic<br />arriv_locat<br />gunshot<br />believ<br />head","secur<br />unknown<br />westbound<br />pursuit<br />avenu<br />return<br />black_male<br />activ<br />black<br />front","passeng<br />refer<br />rear<br />unmark<br />unmark_vehicl<br />area<br />want<br />struck<br />window<br />pm_offic","bedroom<br />knife<br />offend<br />victim<br />observ_offend<br />resid<br />arm<br />wit<br />front<br />enter","floor<br />polic_offic<br />swat<br />door<br />magazin<br />warrant<br />unit<br />search<br />point_offic<br />vest","offend<br />unmark_vehicl<br />black<br />wear<br />unmark<br />drove<br />unknown<br />intersect<br />time_offic<br />handgun","stolen<br />partner<br />point_gun<br />black<br />taken<br />pursuit<br />street_offic<br />run<br />point<br />district_offic","arriv_locat<br />corner<br />gun<br />drop<br />drop_gun<br />verbal<br />locat<br />front<br />ground_drop<br />polic_civilian","swat<br />announc<br />swat_offic<br />door<br />addit<br />south<br />order<br />assault<br />insid<br />knock","offend<br />encount<br />head<br />arm<br />point_offic<br />near<br />struck<br />fell<br />dure<br />wound","rifl<br />offend<br />homicid<br />believ<br />gunfir<br />multipl<br />gunshot<br />area<br />involv<br />direct","respond_offic<br />run<br />point<br />polic_offic<br />observ_male<br />male_point<br />offic_observ<br />walk<br />weapon_male<br />avenu","park<br />polic_offic<br />westbound<br />still<br />seat<br />foot<br />behind<br />driver_seat<br />cover<br />car","unmark_vehicl<br />corner<br />bodi<br />unmark<br />medic<br />north<br />point_gun<br />narcot<br />wound<br />oper_unmark","road<br />bodi<br />front<br />refer<br />two<br />live<br />toward<br />civilian<br />turn<br />resid","passeng<br />rear<br />driver<br />request<br />posit<br />broad<br />due<br />blue<br />passeng_side<br />approach","victim<br />offend<br />pronounc<br />weapon_offend<br />polic_civilian<br />highway<br />drew_weapon<br />larg<br />torso<br />ongo","knife<br />drop_knife<br />strike_male<br />drop<br />toward_offic<br />advanc_toward<br />arm<br />shout<br />advanc<br />deploy","suspect<br />swat_offic<br />swat<br />femal<br />properti<br />male_suspect<br />complain<br />road<br />point<br />white","properti<br />swat<br />black_male<br />black<br />driveway<br />went<br />locat<br />side<br />rear<br />full_uniform","suspect<br />vehicl_offic<br />polic_vehicl<br />gave<br />move<br />oper<br />driver<br />east<br />upon<br />point_offic","knife<br />drop_knife<br />drop<br />walk<br />order<br />order_male<br />away<br />back<br />toward<br />park","complain<br />car<br />get<br />floor<br />avenu<br />point<br />observ_male<br />male_arm<br />black<br />intersect","vest<br />rear<br />seat<br />vehicl_offic<br />black<br />area<br />road<br />near<br />unmark_polic<br />driver","unmark_polic<br />narcot<br />unmark<br />polic_vehicl<br />street_offic<br />front<br />black<br />search<br />front_door<br />area","sergeant<br />blue<br />unmark<br />camera<br />sever<br />insid<br />remov<br />run<br />plaincloth_offic<br />arrest","knock<br />off-duti<br />block_south<br />south<br />began<br />offic_offic<br />offic_drew<br />shout<br />locat<br />outsid","femal<br />yard<br />room<br />calib<br />found<br />multipl<br />also<br />live<br />properti<br />rear","medic<br />man<br />unit<br />driver<br />struggl<br />emerg<br />flee<br />pursuit<br />drive<br />lot","narcot<br />run<br />plaincloth_offic<br />gunshot<br />gun<br />unmark_vehicl<br />offic_heard<br />conduct<br />februari<br />round_recov","gun<br />third<br />gun_offic<br />door<br />saw<br />rear<br />arm<br />front<br />fire<br />ran","car<br />saw<br />window<br />still<br />approach<br />later<br />side<br />driver<br />approach_driver<br />area","man<br />away<br />advanc_toward<br />advanc<br />toward_offic<br />toward<br />drop<br />open<br />fell<br />car","detect<br />car<br />unmark<br />male_point<br />list_critic<br />approach_male<br />light<br />stop<br />believ<br />intersect","driver<br />broad<br />struggl<br />block_n<br />move<br />north<br />block_north<br />gun<br />still<br />open","calib<br />insid_resid<br />heard<br />gunshot<br />stand<br />search<br />front<br />come<br />area<br />resid","road<br />intersect<br />head<br />hold<br />pursu_male<br />offic_pursu<br />male_foot<br />male_fled<br />foot<br />discharg_firearm","complain<br />saw<br />struggl<br />drop_weapon<br />order_male<br />fled_foot<br />point<br />properti<br />order<br />point_gun","knife<br />drop_knife<br />male_drop<br />drop<br />order_male<br />away<br />back<br />continu<br />order<br />advanc_toward","ecw<br />advanc_toward<br />advanc<br />kitchen<br />knife<br />enter<br />get<br />resid<br />offic_observ<br />drew","driveway<br />road<br />hand_offic<br />near<br />foot<br />hand<br />fled_foot<br />bodi<br />observ_male<br />turn","point_firearm<br />kill<br />male_point<br />direct<br />state<br />point<br />shoot<br />heard<br />left<br />order","street_observ<br />male_fled<br />patrol_car<br />leg<br />toward<br />car<br />strike_offic<br />insid<br />man<br />area","cartridg<br />fire<br />south<br />corner<br />sidewalk<br />patrol_car<br />calib<br />car<br />handgun<br />graze","narcot<br />unmark_polic<br />unmark<br />use<br />conduct<br />driver_door<br />polic_vehicl<br />three<br />driver<br />unit","street_male<br />patrol_vehicl<br />fire<br />south<br />male_male<br />weapon_offic<br />drop<br />run<br />calib<br />uniform_offic","swat<br />unit<br />hospit_critic<br />insid_resid<br />insid<br />admit<br />critic_condit<br />resid<br />insid_properti<br />detect","detect<br />offend<br />observ_offend<br />resid<br />bedroom<br />gunshot<br />june<br />went<br />oper_unmark<br />radio_assign","stolen<br />driver_side<br />side<br />driver<br />rear<br />park_vehicl<br />refus<br />offic_oper<br />one_round<br />vehicl_approach","detect<br />treat_releas<br />chase<br />head<br />treat<br />releas<br />offend<br />westbound<br />shoulder<br />off-duti","offic_number<br />number<br />passeng<br />pistol<br />two<br />servic<br />number_one<br />four<br />unmark<br />offend","plaincloth_offic<br />unmark_polic<br />unmark<br />plaincloth<br />civilian<br />two<br />polic_vehicl<br />homicid<br />hand<br />avenu","robberi<br />stolen<br />driver_door<br />driver<br />offic_approach<br />open<br />plaincloth<br />posit<br />three<br />plaincloth_offic","knife<br />offic_drew<br />one_offic<br />properti<br />drew<br />drop_knife<br />hospit_critic<br />ecw<br />one_round<br />move","complain<br />phone<br />driveway<br />cartridg<br />number_one<br />offic_number<br />next<br />magazin<br />two<br />septemb","number_one<br />offic_number<br />number<br />offend<br />firearm_offic<br />south<br />yard<br />weapon_offend<br />august<br />pistol_load","offic_number<br />number<br />number_one<br />three<br />two<br />firearm_offic<br />pull<br />releas<br />offend<br />take","drop<br />hospit_critic<br />man<br />refus<br />ground_drop<br />street_male<br />august<br />monday<br />radio_assign<br />torso","stolen<br />offend<br />car<br />man<br />one_round<br />male_arm<br />report<br />discharg_one<br />light<br />emerg","offend<br />resid<br />admit<br />victim<br />semi-automat<br />templ_univers<br />univers_hospit<br />femal<br />univers<br />gunshot","waistband<br />june<br />offend<br />avenu_offic<br />pull<br />avenu<br />round<br />pistol<br />stop<br />patrol_vehicl","knife<br />offic_number<br />offend<br />number<br />move<br />number_one<br />open<br />toward_offic<br />offic_offic<br />bedroom","number_one<br />number<br />plaincloth_offic<br />offic_number<br />plaincloth<br />two<br />uniform_offic<br />februari<br />offend<br />park_vehicl","offend<br />east<br />street_offic<br />offend_offend<br />univers_hospit<br />toward<br />civilian<br />treatment<br />univers<br />turn","offend<br />number_one<br />offic_number<br />number<br />live_round<br />block_n<br />drop<br />hand<br />live<br />offend_offend","miss_offend<br />offend<br />offic_number<br />discharg_firearm<br />number<br />miss<br />north<br />number_one<br />block_n<br />seat","knife<br />offend<br />move<br />control<br />drop_knife<br />torso<br />deploy<br />number_one<br />offic_number<br />complain","offic_number<br />number<br />driveway<br />offic_approach<br />block_n<br />apprehend<br />approach<br />two<br />foot<br />fled_scene","rifl<br />offend<br />front<br />scene_injuri<br />radio_assign<br />octob<br />subsequ<br />offend_transport<br />without<br />street_upon","offend<br />miss_offend<br />compli<br />drop_weapon<br />offend_offend<br />pursu<br />weapon_offend<br />driveway<br />miss<br />ran","offend<br />properti<br />victim<br />penn-presbyterian<br />penn-presbyterian_hospit<br />knife<br />right_hand<br />hand<br />femal<br />right","offend<br />park_vehicl<br />sergeant<br />discharg_firearm<br />univers<br />firearm_strike<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />femal","insid_properti<br />properti<br />offend<br />femal<br />swat<br />insid<br />struck<br />person<br />assault<br />swat_offic","polic_vehicl<br />sidewalk<br />onto<br />drive<br />offend<br />direct<br />weapon_recov<br />block_e<br />passeng_side<br />drove","broad<br />block_north<br />oper<br />north<br />turn<br />miss_offend<br />approach_driver<br />offic_oper<br />weapon_recov<br />highway","step<br />door_offic<br />offend<br />rear<br />kitchen<br />off-duti<br />door<br />apprehend<br />miss<br />offic_observ","offend<br />properti<br />swat<br />secur<br />unit<br />one_offic<br />insid_properti<br />miss_offend<br />weapon_offend<br />offic_pursu","unmark_polic<br />polic_vehicl<br />unmark<br />offend<br />vehicl_respond<br />avenu<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />offic_drew","properti<br />offend<br />avenu<br />rear<br />avenu_offic<br />second<br />enter<br />penn-presbyterian<br />penn-presbyterian_hospit<br />gun","offend<br />complain<br />point_gun<br />robberi<br />struggl<br />exit_vehicl<br />subsequ<br />polic_vehicl<br />gun<br />femal","offend<br />weapon_offend<br />broad<br />offend_fled<br />block_n<br />offend_offend<br />park<br />lot<br />drop<br />result","offend<br />yard<br />lot<br />want<br />block_n<br />offend_drop<br />offic_pursu<br />unmark_polic<br />onc<br />pistol_load","polic_vehicl<br />second<br />offend<br />want<br />two<br />drive<br />park_vehicl<br />violat<br />front<br />move","polic_vehicl<br />block_north<br />pursu<br />pursu_male<br />north<br />offend<br />rear<br />yard<br />miss_offend<br />foot","offend<br />polic_vehicl<br />strike_offic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />discharg_firearm<br />remain<br />advanc<br />scene_injuri<br />street_male"],"hoverinfo":"text","marker":{"size":6},"color":["Likely dog attack","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Likely dog attack","Other","Other","Likely dog attack","Likely dog attack","Other","Other","Likely dog attack","Other","Likely dog attack","Likely dog attack","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Other","Other","Other","Other","Likely dog attack","Likely dog attack","Other","Likely dog attack","Other","Likely dog attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Likely knife attack","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Likely knife attack","Likely knife attack","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Likely knife attack","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other","Other"],"colors":["red","orange","steelblue"],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"V2 - Dog attack measure"},"yaxis":{"domain":[0,1],"automargin":true,"title":"V4 - Knife attack measure"},"hovermode":"closest","showlegend":true},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[0.18161875587789689,0.11572360794264425,0.17877124283368384,0.18259981991707092,0.11707134487490918,0.1685067836463737,0.16374104976200621,0.21204170471713843,0.14751141714765928,0.27223024324059197,0.21900917326533437,0.15651561529202304,0.21117828010095682,0.16906490917093736,0.16140495714203171,0.1291528926248714,0.14319779874135449,0.15715001234373499],"y":[0.0017833708784454534,0.026569286265513609,0.0016155413579507472,0.0054863465404176668,-0.029249992825769771,0.014377483980066538,-0.031890670339162833,-0.0089616712152537203,-0.01226850897186647,-0.056026803263791641,-0.034467898616003259,-0.010958400083721471,-0.025347629861140721,-0.0086722918441300926,0.0020293933058213778,0.0037744216461379448,0.016466450689725937,-0.011107182227914058],"mode":"markers","text":["dog<br />narcot<br />back<br />secur<br />unit<br />insid_properti<br />compli<br />onc<br />tuesday<br />retreat","dog<br />district_offic<br />femal<br />polic_district<br />bedroom<br />insid<br />kill<br />locat_offic<br />call_person<br />offic_heard","dog<br />narcot<br />block_e<br />resid<br />retreat<br />involv_shoot<br />kitchen<br />offic_involv<br />bull<br />pit_bull","dog<br />femal<br />partner<br />insid<br />kill<br />went<br />avenu<br />outsid<br />home<br />offic_heard","dog<br />septemb<br />encount<br />white<br />area<br />avenu<br />scene_injuri<br />camera_activ<br />retreat<br />subsequ","dog<br />resid<br />polic_depart<br />dure<br />assault<br />depart<br />shout<br />went<br />use<br />district_place","dog<br />west<br />anim<br />bull<br />pit_bull<br />pit<br />kill<br />servic<br />june<br />offic_arriv","dog<br />resid<br />attack<br />ongo<br />block_north<br />medic<br />two<br />north<br />black<br />anim","sergeant<br />bull<br />pit_bull<br />pit<br />discharg_offic<br />attack<br />also<br />year_old<br />old<br />dog","attack<br />dog<br />bull<br />pit_bull<br />pit<br />kill<br />year<br />anim<br />district_place<br />larg","attack<br />dog<br />owner<br />bull<br />pit_bull<br />block_south<br />pit<br />control<br />femal<br />south","dog<br />kill<br />wit<br />bull<br />pit_bull<br />pit<br />attack<br />bodi<br />victim<br />depart","bull<br />pit_bull<br />pit<br />dog<br />attack<br />owner<br />control<br />stop<br />discharg_offic<br />offic_offic","dog<br />attack<br />anim<br />depart<br />avenu<br />later<br />polic_depart<br />shout<br />highway<br />bodi_worn","dog<br />yard<br />bull<br />pit_bull<br />owner<br />pit<br />resid<br />year_old<br />old<br />year","block_south<br />resid<br />dog<br />south<br />offic_offic<br />drew_weapon<br />made<br />bull<br />pit_bull<br />polic_offic","dog<br />attack<br />victim<br />wit<br />violat<br />home<br />highway<br />bull<br />pit_bull<br />bodi_worn","dog<br />anim<br />remain<br />control<br />dure_incid<br />injur<br />three<br />sustain<br />polic_depart<br />dure"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(255,0,0,1)","size":6,"line":{"color":"rgba(255,0,0,1)"}},"type":"scatter","name":"Likely dog attack","textfont":{"color":"rgba(255,0,0,1)"},"error_y":{"color":"rgba(255,0,0,1)"},"error_x":{"color":"rgba(255,0,0,1)"},"line":{"color":"rgba(255,0,0,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[-0.075582185895513701,0.0082711645406465424,-0.074302718196757406,-0.075457978192816078,-0.055517186343691252,-0.043525980650874013,-0.052368279640408327,-0.056645432021001585,-0.069184758056329981,-0.096572852746188889],"y":[0.13457920790383368,0.11057925167590818,0.30646312055343927,0.11264483928614399,0.12332948577297706,0.30955549960705209,0.355596687154769,0.17499752751217432,0.14042189150603729,0.1168764145682705],"mode":"markers","text":["offend<br />victim<br />east<br />handgun<br />gun<br />one_time<br />locat<br />return<br />partner<br />point_gun","victim<br />one_time<br />shot<br />shoot<br />left<br />unknown<br />area<br />south<br />homicid<br />shoulder","bedroom<br />knife<br />offend<br />victim<br />observ_offend<br />resid<br />arm<br />wit<br />front<br />enter","offend<br />encount<br />head<br />arm<br />point_offic<br />near<br />struck<br />fell<br />dure<br />wound","victim<br />offend<br />pronounc<br />weapon_offend<br />polic_civilian<br />highway<br />drew_weapon<br />larg<br />torso<br />ongo","knife<br />drop_knife<br />strike_male<br />drop<br />toward_offic<br />advanc_toward<br />arm<br />shout<br />advanc<br />deploy","knife<br />drop_knife<br />drop<br />walk<br />order<br />order_male<br />away<br />back<br />toward<br />park","knife<br />drop_knife<br />male_drop<br />drop<br />order_male<br />away<br />back<br />continu<br />order<br />advanc_toward","knife<br />offic_drew<br />one_offic<br />properti<br />drew<br />drop_knife<br />hospit_critic<br />ecw<br />one_round<br />move","knife<br />offend<br />move<br />control<br />drop_knife<br />torso<br />deploy<br />number_one<br />offic_number<br />complain"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(255,165,0,1)","size":6,"line":{"color":"rgba(255,165,0,1)"}},"type":"scatter","name":"Likely knife attack","textfont":{"color":"rgba(255,165,0,1)"},"error_y":{"color":"rgba(255,165,0,1)"},"error_x":{"color":"rgba(255,165,0,1)"},"line":{"color":"rgba(255,165,0,1)"},"xaxis":"x","yaxis":"y","frame":null},{"x":[-0.0019788713728065717,0.022223821264152923,0.061167241620392346,0.05572097583763206,0.048273649645646469,0.033926441809114423,0.02054790385483761,0.018577428260032672,0.0081574778119158087,0.044146742468963475,-0.020444727606716701,-0.019688882975228771,0.033479502282273005,0.044488847114346149,0.038955610515428132,0.034513205577909781,0.010288774058011515,0.028026034813560894,0.0051619495486397212,-0.010960374257623993,-0.030801485117322062,0.0034805026327011305,-0.04537296656073616,-0.029218619199922257,-0.01581894389017682,0.021759934033232672,-0.10195414139595692,-0.003816032820549816,-0.0090294497149071146,0.011946510583231498,-0.04784603891168452,-0.0061615587655334241,-0.069463137440628639,-0.038615261481704154,-0.0054909352281676425,0.0039205632203706585,-0.055179220140726085,-0.0073223667718193075,-0.041430095428084013,-0.03856773579959237,-0.017835534277815427,-0.044649955663984775,-0.010785309029566622,-0.018800689621417694,-0.035265350888931582,-0.051409710766081904,-0.034207072019543656,-0.040655204858792919,-0.038890557656961464,-0.038987763380822112,-0.0429512129916272,-0.045648128441618453,-0.054518156209489084,-0.04637327243463224,-0.039908186961754598,-0.044414605916259203,-0.066320446211673073,-0.044769638626015774,-0.0473578282716101,-0.052404098414888155,-0.059307027123973996,-0.041634832202926478,-0.046675899727654395,-0.034090937987938885,-0.050356933614642496,-0.055910170380923011,-0.054914686535615653,-0.056871431498744726,-0.03753800244911653,-0.091381277492467064,-0.090664280006923004,-0.074810860787178662,-0.10524991876150692,-0.067975793704709339,-0.069922810025450463,-0.080422748552774551,-0.12826536685842249,-0.11433017564914451,-0.068300567015818783,-0.08880749330514702,-0.069338953255502808,-0.070404913327719545,-0.10441397207560431,-0.1260104065008332,-0.07775840918543836,-0.1035919549572657,-0.11536478039227689,-0.0842223455146862,-0.089363072445301409,-0.0960114911379851,-0.082579749139763001,-0.088826183218488619,-0.071017011830248875,-0.080397971558564083,-0.07021981716928441,-0.079212195080423126,-0.089976583088172218,-0.087500908125515434,-0.087191210821466705,-0.10666919804154303,-0.094477686770881322,-0.088159755127270603,-0.081527310486232837,-0.078845635288058144,-0.095375442585102707],"y":[0.028062219000326113,-0.0012174507505042875,-0.016032324730352623,-0.0095094548182538992,-0.088578753762323395,-0.14080769307724081,-0.088041055984499655,-0.14510182790859877,0.064070142412028019,-0.09324209742625994,0.0020048805512994203,-0.054342424489183166,-0.036637891451628102,-0.057531427800208736,-0.060228857146685931,-0.03335026236486318,-0.021807971564354531,0.022369394719020289,-0.034592975321655152,0.0026087999263665514,0.075699193612745588,0.057166765509667761,0.019873437187986412,-0.00039815745097952554,0.050391398706272954,0.017951521749538887,0.097036808972097835,0.042379116951025357,0.062577481071961288,0.028035523811706271,-0.0047856841845396007,0.034588446579627626,0.033633104999057924,0.0060864595370706013,0.088353965926887879,0.052217714108848533,0.090615666836769332,0.03313434403820905,0.02384876200724198,0.011727398691742993,0.077349495067085092,-0.0005204755569056768,-0.077075957077814602,0.07775906447634677,-0.09928607457617751,0.060974168727251386,0.020029917711223602,0.021797952052797675,0.010154282915942132,0.015760206177842049,-0.0091853272269314008,-0.015159159052058776,-0.034761383506973276,0.023848730831525857,-0.03167789932274518,0.053423382053371528,-0.02704292431794111,-0.051288222993424691,0.0097846125264502391,-0.017466716242592783,0.011245255456921351,0.097226821318498843,0.010986243071695299,0.046368576997416387,-0.019639765015640083,-0.025923798349069081,-0.037341552706520342,0.0083973836661508719,0.013806815505300753,0.015582341250900317,-0.096390797147250573,-0.0077047404613864974,-0.21005101157350597,-0.041086621619146772,-0.050921668865837981,-0.08215726891377427,-0.23757147088371255,-0.28450182634790511,-0.017204463556087197,-0.017328912428149549,0.008180096087979814,-0.017621919927969316,0.020229600239448718,-0.30392183026856012,-0.014616193536108275,-0.10107790204162594,-0.14796624660787633,-0.13164228991861443,-0.0011320985889625096,-0.0020871810885483141,0.067370922661573018,-0.022110814479791376,-0.0036648986243317792,-0.030175276321226328,-0.030783965257854904,0.042302826451645473,-0.010741623006341698,-0.015500325869965491,0.019393963392577825,-0.010541969650638413,0.010025767359613387,-0.038600183460216875,-0.024154673753716369,-0.041228465201162724,-0.029925815214597463],"mode":"markers","text":["servic<br />sergeant<br />year<br />wit<br />involv<br />male_point<br />investig_unit<br />home<br />unknown<br />complain","detect<br />shoot<br />seat<br />person<br />unit<br />homicid<br />vehicl_approach<br />investig_unit<br />involv_shoot<br />offic_involv","injur<br />polic_district<br />polic_depart<br />veteran<br />depart<br />investig_unit<br />duti<br />conduct<br />septemb<br />offic_transport","room<br />district_place<br />one_round<br />duti<br />discharg_one<br />incid_offic<br />place<br />affair_investig<br />septemb<br />shoot","suspect<br />one_offic<br />year<br />shot<br />discharg_offic<br />driver<br />male_suspect<br />june<br />use<br />blue","suspect<br />block_north<br />saturday<br />uniform_offic<br />north<br />unit<br />due<br />june<br />district_place<br />conduct","suspect<br />graze<br />male_suspect<br />white<br />robberi<br />off-duti<br />sustain<br />dure<br />wound<br />announc","suspect<br />off-duti<br />assault<br />robberi<br />take<br />struggl<br />dure<br />male_suspect<br />remain<br />violat","complain<br />front_door<br />knock<br />outsid<br />taken<br />unit<br />subsequ<br />took<br />arm<br />front","suspect<br />stolen<br />vehicl_offic<br />polic_district<br />driver<br />attempt<br />male_suspect<br />black<br />fled_scene<br />approach_driver","magazin<br />block_north<br />offend<br />park<br />black<br />north<br />live<br />handgun<br />live_round<br />round","passeng<br />suspect<br />open<br />driver<br />door<br />strike_offic<br />driver_side<br />window<br />fled_scene<br />side","suspect<br />veteran_philadelphia<br />templ_univers<br />univers_hospit<br />depart_assign<br />shot<br />univers<br />shoot<br />person<br />polic_depart","swat<br />suspect<br />swat_offic<br />assist<br />year_old<br />respond_offic<br />old<br />still<br />year<br />direct","highway<br />graze<br />suspect<br />patrol<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />assault<br />depart","suspect<br />sergeant<br />home<br />depart<br />encount<br />shot<br />veteran<br />involv<br />verbal<br />one_time","suspect<br />shoot<br />victim<br />passeng<br />pronounc_deceas<br />deceas<br />driver<br />unit<br />pronounc<br />wound","suspect<br />knife<br />ecw<br />deploy<br />offic_respond<br />began<br />advanc_toward<br />step<br />male_suspect<br />white","robberi<br />victim<br />suspect<br />approach_male<br />polic_vehicl<br />gun<br />follow<br />vehicl_offic<br />phone<br />drop_gun","side_door<br />door_offic<br />side<br />passeng<br />approach_driver<br />passeng_side<br />car<br />driver_side<br />driver<br />onto","lot<br />gun_offic<br />rear<br />bodi<br />ground<br />car<br />handgun<br />gun<br />pm_offic<br />strike_male","phone<br />detect<br />swat<br />one_time<br />properti<br />struck<br />enter<br />bedroom<br />swat_offic<br />announc","offend<br />offic_involv<br />gun_offic<br />observ_offend<br />area<br />involv<br />discharg_offic<br />turn<br />left<br />offic_offic","offic_involv<br />offend<br />side_door<br />involv<br />involv_shoot<br />side<br />taken<br />block_north<br />driver<br />shoot","swat<br />gsw<br />sustain<br />unit<br />insid_properti<br />front<br />properti<br />north<br />offend<br />rear","fire<br />cover<br />veteran_philadelphia<br />depart_assign<br />polic_depart<br />veteran<br />depart<br />district_offic<br />approach_male<br />arriv_locat","offend<br />gun<br />point_gun<br />lot<br />drop_gun<br />offend_drop<br />gun_offic<br />around<br />began<br />drop","room<br />offic_offic<br />oper<br />hospit_polic<br />open_door<br />discharg_offic<br />sever_time<br />window<br />templ_hospit<br />pull","gsw<br />victim<br />discharg_offic<br />locat<br />offic_arriv<br />locat_offic<br />arriv_locat<br />gunshot<br />believ<br />head","secur<br />unknown<br />westbound<br />pursuit<br />avenu<br />return<br />black_male<br />activ<br />black<br />front","passeng<br />refer<br />rear<br />unmark<br />unmark_vehicl<br />area<br />want<br />struck<br />window<br />pm_offic","floor<br />polic_offic<br />swat<br />door<br />magazin<br />warrant<br />unit<br />search<br />point_offic<br />vest","offend<br />unmark_vehicl<br />black<br />wear<br />unmark<br />drove<br />unknown<br />intersect<br />time_offic<br />handgun","stolen<br />partner<br />point_gun<br />black<br />taken<br />pursuit<br />street_offic<br />run<br />point<br />district_offic","arriv_locat<br />corner<br />gun<br />drop<br />drop_gun<br />verbal<br />locat<br />front<br />ground_drop<br />polic_civilian","swat<br />announc<br />swat_offic<br />door<br />addit<br />south<br />order<br />assault<br />insid<br />knock","rifl<br />offend<br />homicid<br />believ<br />gunfir<br />multipl<br />gunshot<br />area<br />involv<br />direct","respond_offic<br />run<br />point<br />polic_offic<br />observ_male<br />male_point<br />offic_observ<br />walk<br />weapon_male<br />avenu","park<br />polic_offic<br />westbound<br />still<br />seat<br />foot<br />behind<br />driver_seat<br />cover<br />car","unmark_vehicl<br />corner<br />bodi<br />unmark<br />medic<br />north<br />point_gun<br />narcot<br />wound<br />oper_unmark","road<br />bodi<br />front<br />refer<br />two<br />live<br />toward<br />civilian<br />turn<br />resid","passeng<br />rear<br />driver<br />request<br />posit<br />broad<br />due<br />blue<br />passeng_side<br />approach","suspect<br />swat_offic<br />swat<br />femal<br />properti<br />male_suspect<br />complain<br />road<br />point<br />white","properti<br />swat<br />black_male<br />black<br />driveway<br />went<br />locat<br />side<br />rear<br />full_uniform","suspect<br />vehicl_offic<br />polic_vehicl<br />gave<br />move<br />oper<br />driver<br />east<br />upon<br />point_offic","complain<br />car<br />get<br />floor<br />avenu<br />point<br />observ_male<br />male_arm<br />black<br />intersect","vest<br />rear<br />seat<br />vehicl_offic<br />black<br />area<br />road<br />near<br />unmark_polic<br />driver","unmark_polic<br />narcot<br />unmark<br />polic_vehicl<br />street_offic<br />front<br />black<br />search<br />front_door<br />area","sergeant<br />blue<br />unmark<br />camera<br />sever<br />insid<br />remov<br />run<br />plaincloth_offic<br />arrest","knock<br />off-duti<br />block_south<br />south<br />began<br />offic_offic<br />offic_drew<br />shout<br />locat<br />outsid","femal<br />yard<br />room<br />calib<br />found<br />multipl<br />also<br />live<br />properti<br />rear","medic<br />man<br />unit<br />driver<br />struggl<br />emerg<br />flee<br />pursuit<br />drive<br />lot","narcot<br />run<br />plaincloth_offic<br />gunshot<br />gun<br />unmark_vehicl<br />offic_heard<br />conduct<br />februari<br />round_recov","gun<br />third<br />gun_offic<br />door<br />saw<br />rear<br />arm<br />front<br />fire<br />ran","car<br />saw<br />window<br />still<br />approach<br />later<br />side<br />driver<br />approach_driver<br />area","man<br />away<br />advanc_toward<br />advanc<br />toward_offic<br />toward<br />drop<br />open<br />fell<br />car","detect<br />car<br />unmark<br />male_point<br />list_critic<br />approach_male<br />light<br />stop<br />believ<br />intersect","driver<br />broad<br />struggl<br />block_n<br />move<br />north<br />block_north<br />gun<br />still<br />open","calib<br />insid_resid<br />heard<br />gunshot<br />stand<br />search<br />front<br />come<br />area<br />resid","road<br />intersect<br />head<br />hold<br />pursu_male<br />offic_pursu<br />male_foot<br />male_fled<br />foot<br />discharg_firearm","complain<br />saw<br />struggl<br />drop_weapon<br />order_male<br />fled_foot<br />point<br />properti<br />order<br />point_gun","ecw<br />advanc_toward<br />advanc<br />kitchen<br />knife<br />enter<br />get<br />resid<br />offic_observ<br />drew","driveway<br />road<br />hand_offic<br />near<br />foot<br />hand<br />fled_foot<br />bodi<br />observ_male<br />turn","point_firearm<br />kill<br />male_point<br />direct<br />state<br />point<br />shoot<br />heard<br />left<br />order","street_observ<br />male_fled<br />patrol_car<br />leg<br />toward<br />car<br />strike_offic<br />insid<br />man<br />area","cartridg<br />fire<br />south<br />corner<br />sidewalk<br />patrol_car<br />calib<br />car<br />handgun<br />graze","narcot<br />unmark_polic<br />unmark<br />use<br />conduct<br />driver_door<br />polic_vehicl<br />three<br />driver<br />unit","street_male<br />patrol_vehicl<br />fire<br />south<br />male_male<br />weapon_offic<br />drop<br />run<br />calib<br />uniform_offic","swat<br />unit<br />hospit_critic<br />insid_resid<br />insid<br />admit<br />critic_condit<br />resid<br />insid_properti<br />detect","detect<br />offend<br />observ_offend<br />resid<br />bedroom<br />gunshot<br />june<br />went<br />oper_unmark<br />radio_assign","stolen<br />driver_side<br />side<br />driver<br />rear<br />park_vehicl<br />refus<br />offic_oper<br />one_round<br />vehicl_approach","detect<br />treat_releas<br />chase<br />head<br />treat<br />releas<br />offend<br />westbound<br />shoulder<br />off-duti","offic_number<br />number<br />passeng<br />pistol<br />two<br />servic<br />number_one<br />four<br />unmark<br />offend","plaincloth_offic<br />unmark_polic<br />unmark<br />plaincloth<br />civilian<br />two<br />polic_vehicl<br />homicid<br />hand<br />avenu","robberi<br />stolen<br />driver_door<br />driver<br />offic_approach<br />open<br />plaincloth<br />posit<br />three<br />plaincloth_offic","complain<br />phone<br />driveway<br />cartridg<br />number_one<br />offic_number<br />next<br />magazin<br />two<br />septemb","number_one<br />offic_number<br />number<br />offend<br />firearm_offic<br />south<br />yard<br />weapon_offend<br />august<br />pistol_load","offic_number<br />number<br />number_one<br />three<br />two<br />firearm_offic<br />pull<br />releas<br />offend<br />take","drop<br />hospit_critic<br />man<br />refus<br />ground_drop<br />street_male<br />august<br />monday<br />radio_assign<br />torso","stolen<br />offend<br />car<br />man<br />one_round<br />male_arm<br />report<br />discharg_one<br />light<br />emerg","offend<br />resid<br />admit<br />victim<br />semi-automat<br />templ_univers<br />univers_hospit<br />femal<br />univers<br />gunshot","waistband<br />june<br />offend<br />avenu_offic<br />pull<br />avenu<br />round<br />pistol<br />stop<br />patrol_vehicl","knife<br />offic_number<br />offend<br />number<br />move<br />number_one<br />open<br />toward_offic<br />offic_offic<br />bedroom","number_one<br />number<br />plaincloth_offic<br />offic_number<br />plaincloth<br />two<br />uniform_offic<br />februari<br />offend<br />park_vehicl","offend<br />east<br />street_offic<br />offend_offend<br />univers_hospit<br />toward<br />civilian<br />treatment<br />univers<br />turn","offend<br />number_one<br />offic_number<br />number<br />live_round<br />block_n<br />drop<br />hand<br />live<br />offend_offend","miss_offend<br />offend<br />offic_number<br />discharg_firearm<br />number<br />miss<br />north<br />number_one<br />block_n<br />seat","offic_number<br />number<br />driveway<br />offic_approach<br />block_n<br />apprehend<br />approach<br />two<br />foot<br />fled_scene","rifl<br />offend<br />front<br />scene_injuri<br />radio_assign<br />octob<br />subsequ<br />offend_transport<br />without<br />street_upon","offend<br />miss_offend<br />compli<br />drop_weapon<br />offend_offend<br />pursu<br />weapon_offend<br />driveway<br />miss<br />ran","offend<br />properti<br />victim<br />penn-presbyterian<br />penn-presbyterian_hospit<br />knife<br />right_hand<br />hand<br />femal<br />right","offend<br />park_vehicl<br />sergeant<br />discharg_firearm<br />univers<br />firearm_strike<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />femal","insid_properti<br />properti<br />offend<br />femal<br />swat<br />insid<br />struck<br />person<br />assault<br />swat_offic","polic_vehicl<br />sidewalk<br />onto<br />drive<br />offend<br />direct<br />weapon_recov<br />block_e<br />passeng_side<br />drove","broad<br />block_north<br />oper<br />north<br />turn<br />miss_offend<br />approach_driver<br />offic_oper<br />weapon_recov<br />highway","step<br />door_offic<br />offend<br />rear<br />kitchen<br />off-duti<br />door<br />apprehend<br />miss<br />offic_observ","offend<br />properti<br />swat<br />secur<br />unit<br />one_offic<br />insid_properti<br />miss_offend<br />weapon_offend<br />offic_pursu","unmark_polic<br />polic_vehicl<br />unmark<br />offend<br />vehicl_respond<br />avenu<br />mark_polic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />offic_drew","properti<br />offend<br />avenu<br />rear<br />avenu_offic<br />second<br />enter<br />penn-presbyterian<br />penn-presbyterian_hospit<br />gun","offend<br />complain<br />point_gun<br />robberi<br />struggl<br />exit_vehicl<br />subsequ<br />polic_vehicl<br />gun<br />femal","offend<br />weapon_offend<br />broad<br />offend_fled<br />block_n<br />offend_offend<br />park<br />lot<br />drop<br />result","offend<br />yard<br />lot<br />want<br />block_n<br />offend_drop<br />offic_pursu<br />unmark_polic<br />onc<br />pistol_load","polic_vehicl<br />second<br />offend<br />want<br />two<br />drive<br />park_vehicl<br />violat<br />front<br />move","polic_vehicl<br />block_north<br />pursu<br />pursu_male<br />north<br />offend<br />rear<br />yard<br />miss_offend<br />foot","offend<br />polic_vehicl<br />strike_offic<br />penn-presbyterian<br />penn-presbyterian_hospit<br />discharg_firearm<br />remain<br />advanc<br />scene_injuri<br />street_male"],"hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"marker":{"color":"rgba(70,130,180,1)","size":6,"line":{"color":"rgba(70,130,180,1)"}},"type":"scatter","name":"Other","textfont":{"color":"rgba(70,130,180,1)"},"error_y":{"color":"rgba(70,130,180,1)"},"error_x":{"color":"rgba(70,130,180,1)"},"line":{"color":"rgba(70,130,180,1)"},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-documentMap-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Plot of how documents weigh 2nd and 4th left singular vectors
</figcaption>
</figure>
</div>
</div>
</section>
<section id="clustering-documents-with-hartigans-k-means-clustering-algorithm" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Clustering documents with Hartigan’s k-means clustering algorithm</h1>
<p>Hartigan’s k-means algorithm is an iterative method for partitioning data into <span class="math inline">\(k\)</span> clusters by minimizing the total within-cluster sum of squares. It begins with randomly chosen cluster centers (centroids) and alternates between two steps:</p>
<ol type="1">
<li>assigning each data point to the nearest centroid based on Euclidean distance</li>
<li>updating each centroid to be the mean of the points currently assigned to it</li>
</ol>
<p>These steps repeat until the assignments no longer change significantly, indicating convergence. The algorithm is greedy and locally optimal. That is, it always reduces the the within cluster sum of squares at each iteration, but it can converge to different solutions depending on the initial centroids. Multiple runs with different random starts are often used to find a better overall solution.</p>
<p>Let’s look at a little 2D demonstration before we run this on documents, which can be a little abstract. I have created three clusters with centers at (0,0), (3,3), and (5,5). Then I have R code that reassigns points to their nearest centroids, recomputes the cluster centroids, plots the points colored by their cluster assignment, checks for convergence, and repeats if needed.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20250325</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Simulate data from 3 clusters</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x=</span><span class="fu">rnorm</span>(<span class="dv">180</span>, <span class="at">mean=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">5</span>)),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">y=</span><span class="fu">rnorm</span>(<span class="dv">180</span>, <span class="at">mean=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">3</span>,<span class="dv">5</span>)))</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># find three clusters</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># pick three random points to start</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>old_centroid <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_sample</span>(<span class="at">n=</span>k) <span class="sc">|&gt;</span></span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x,y)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to assign points to nearest center</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a><span class="co">#   compare each point to each of the three centers</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   assign the point to its closest center</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>assign_clusters <span class="ot">&lt;-</span> <span class="cf">function</span>(df, centers) </span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span>(df, <span class="dv">1</span>, <span class="cf">function</span>(point) </span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>    {</span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">which.min</span>(<span class="fu">colSums</span>((<span class="fu">t</span>(centers) <span class="sc">-</span> point)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>iter <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="cf">repeat</span> </span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Assign points to nearest cluster</span></span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>  df<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="fu">assign_clusters</span>(df[,<span class="fu">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>)], </span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a>                                old_centroid)</span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get centroids of newly assigned clusters</span></span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a>  new_centroid <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span></span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(cluster) <span class="sc">|&gt;</span></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">x=</span><span class="fu">mean</span>(x), <span class="at">y=</span><span class="fu">mean</span>(y))</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># plot showing old and new centroids</span></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a>  plotKmeans <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> old_centroid, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), </span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> new_centroid, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill=</span><span class="fu">factor</span>(cluster)), </span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">stroke =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_segment</span>(</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>      <span class="at">data =</span> <span class="fu">bind_cols</span>(old_centroid, new_centroid),</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>      <span class="fu">aes</span>(<span class="at">x =</span> x...<span class="dv">1</span>, <span class="at">y =</span> y...<span class="dv">2</span>, <span class="at">xend =</span> x...<span class="dv">4</span>, <span class="at">yend =</span> y...<span class="dv">5</span>),</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">arrow =</span> <span class="fu">arrow</span>(<span class="at">length =</span> <span class="fu">unit</span>(<span class="fl">0.15</span>, <span class="st">"inches"</span>)),</span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="fu">paste</span>(<span class="st">"K-Means Iteration"</span>, iter)) <span class="sc">+</span></span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">fill =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>()</span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(plotKmeans)</span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>  new_centroid <span class="ot">&lt;-</span> new_centroid <span class="sc">|&gt;</span> <span class="fu">select</span>(<span class="sc">-</span>cluster)</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># check if converged</span></span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">all</span>(<span class="fu">abs</span>(new_centroid <span class="sc">-</span> old_centroid) <span class="sc">&lt;</span> <span class="fl">0.001</span>))</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">break</span></span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a>  old_centroid <span class="ot">&lt;-</span> new_centroid</span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a>  iter <span class="ot">&lt;-</span> iter <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-kmeans-1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-1.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-2.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;4: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-3" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-3.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-4" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-4.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-4-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-5" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-5.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-5-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;7: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-6" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-6.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-6-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-7" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-7.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-7-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display">
<div id="fig-kmeans-8" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kmeans-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kmeans-8.png" class="img-fluid figure-img" width="480">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kmeans-8-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: Demonstration of Hartigan’s k-means algorithm
</figcaption>
</figure>
</div>
</div>
</div>
<p>After 8 iterations, the centroids of the clusters do not change. That means the cluster assignments for each point will no longer changed. The k-means algorithm has converged after 8 iterations. Indeed k-means seems to have figured out the three clusters that I simulated. In practice we never really know how many real clusters there are. We need to come up with some measures that help us decide whether the number of clusters and their centroids adequately capture the data points.</p>
<p>The plot in <a href="#fig-totSS" class="quarto-xref">Figure&nbsp;11</a> illustrates the total sum of squares (TSS), which measures the overall variability in the dataset. It shows each data point connected to the grand centroid, the average of all points in the data. The total sum of squares is calculated by summing the squared distances from each point to this overall centroid. This serves as a baseline measure of dispersion before we run our clustering algorithm.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>tot_centroid <span class="ot">&lt;-</span> df <span class="sc">|&gt;</span> </span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(x, y) <span class="sc">|&gt;</span> </span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colMeans</span>() <span class="sc">|&gt;</span> </span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span> </span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>()</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>plotTotCentroid <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">bind_cols</span>(tot_centroid <span class="sc">|&gt;</span></span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">slice</span>(<span class="fu">rep</span>(<span class="dv">1</span>,<span class="dv">180</span>)), </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>                     df <span class="sc">|&gt;</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">select</span>(x,y)),</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x...<span class="dv">1</span>, <span class="at">y =</span> y...<span class="dv">2</span>, <span class="at">xend =</span> x...<span class="dv">3</span>, <span class="at">yend =</span> y...<span class="dv">4</span>),</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotTotCentroid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-totSS" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-totSS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-totSS-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-totSS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: Total sum of squares calculation. TSS sums all the squared distances between each point and the single centroid of the entire dataset
</figcaption>
</figure>
</div>
</div>
</div>
<p>In contrast, <a href="#fig-withinSS" class="quarto-xref">Figure&nbsp;12</a> depicts the within-cluster sum of squares (WCSS). Each point is now connected to its respective cluster centroid, rather than the overall centroid. The sum of squared distances from each point to its assigned cluster center quantifies how compact each cluster is.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>new_centroid<span class="sc">$</span>cluster <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>plotWithinCentroid <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, </span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">color =</span> <span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df <span class="sc">|&gt;</span> </span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">left_join</span>(new_centroid, <span class="at">by=</span><span class="fu">join_by</span>(cluster)),</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x.x, <span class="at">y =</span> y.x, <span class="at">xend =</span> x.y, <span class="at">yend =</span> y.y),</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"black"</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color=</span><span class="st">"Cluster"</span>) <span class="sc">+</span></span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(plotWithinCentroid)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-withinSS" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-withinSS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-withinSS-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-withinSS-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Within cluster sum of squares calculation. WCSS sums the squared distances between each point and the center of its associated centroid
</figcaption>
</figure>
</div>
</div>
</div>
<p>A useful measure of clustering quality is the proportion of variance explained by the clustering, computed as <span class="math inline">\(R^2 = 1-\frac{WCSS}{TSS}\)</span>. This tells us how much of the total variability has been accounted for by the clustering structure. A higher value indicates better clustering. If this proportion is low, it may suggest that the three clusters is insufficient to capture the underlying structure of the data.</p>
<p>Let’s put all this to work on our officer-involved shooting reports. We will define documents by their first 7 right singular vectors (columns of <span class="math inline">\(\mathbf{V}\)</span>). We will actually cluster on <span class="math inline">\(\mathbf{V}\boldsymbol\Sigma\)</span>. Remember that SVD normalizes all the columns in <span class="math inline">\(\mathbf{V}\)</span> (and those in <span class="math inline">\(\mathbf{U}\)</span> as well) to have length 1. That has the effect of making differences between documents basedon their values of <span class="math inline">\(v_{30}\)</span> just as large as differences on <span class="math inline">\(v_1\)</span>. The singular values in <span class="math inline">\(\boldsymbol\Sigma\)</span> tell us how to weight each column based how much variance it captures in the original TF-IDF matrix. Without this weighting, each dimension would contribute equally to distance calculations during clustering, even though some components may be far more informative than others. By using <span class="math inline">\(\mathbf{V}\boldsymbol\Sigma\)</span>, our clustering algorithm will more accurately group documents based on their underlying thematic content.</p>
<p>R has a built-in <code>kmeans()</code> function in the default <code>stats</code> package that will do all the work for us. First, we need to decide on how many clusters we should use. The code below explores the relationship between the number of clusters, <span class="math inline">\(k\)</span>, and <span class="math inline">\(R^2\)</span>. This is a key part of the “elbow method,” a common strategy for selecting an appropriate number of clusters. By running k-means repeatedly with increasing values of <span class="math inline">\(k\)</span> (from 1 to 40 in this case), and recording the corresponding <span class="math inline">\(R^2\)</span>, we can visualize how much the clustering improves as <span class="math inline">\(k\)</span> increases. A plot of <span class="math inline">\(R^2\)</span> versus <span class="math inline">\(k\)</span> typically shows a steep increase initially and then levels off. The “elbow” point, where the rate of improvement sharply slows, is often a good choice for the number of clusters. It represents a balance between underfitting and overfitting the structure in the data. Another common method is to consider more and more clusters until <span class="math inline">\(R^2\)</span> reaches 0.80 (or 0.90).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>design <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">k=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">40</span>, <span class="at">R2=</span><span class="cn">NA</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="fu">nrow</span>(design))</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># multiply by the singular values to incorporate the importance of each </span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  km <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(oisSVD<span class="sc">$</span>v[,<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>] <span class="sc">%*%</span> <span class="fu">diag</span>(oisSVD<span class="sc">$</span>d[<span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>]), </span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">centers =</span> design<span class="sc">$</span>k[i], </span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">nstart =</span> <span class="dv">5</span>)</span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>  design<span class="sc">$</span>R2[i] <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(i<span class="sc">==</span><span class="dv">1</span>, <span class="dv">1</span>, </span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a>                         <span class="dv">1</span> <span class="sc">-</span> km<span class="sc">$</span>tot.withinss<span class="sc">/</span>km<span class="sc">$</span>totss)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(R2<span class="sc">~</span>k, <span class="at">data=</span>design, <span class="at">pch=</span><span class="dv">16</span>,</span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="fu">expression</span>(k),</span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylab=</span><span class="fu">expression</span>(R<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a>     <span class="at">ylim=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">1</span>)</span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h=</span><span class="fl">0.8</span>, <span class="at">col=</span><span class="st">"red"</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a>kSelect <span class="ot">&lt;-</span> design <span class="sc">|&gt;</span></span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(R2 <span class="sc">&gt;</span> <span class="fl">0.8</span>) <span class="sc">|&gt;</span></span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_min</span>(R2) <span class="sc">|&gt;</span></span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(k)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-kvsse" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-kvsse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="L11-text_files/figure-html/fig-kvsse-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-kvsse-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Relationship between <span class="math inline">\(k\)</span> and <span class="math inline">\(R^2\)</span>
</figcaption>
</figure>
</div>
</div>
</div>
<p>In <a href="#fig-kvsse" class="quarto-xref">Figure&nbsp;13</a> I have marked where the <span class="math inline">\(R^2\)</span> reaches 80%. That happens when we set <span class="math inline">\(k\)</span> to 10. With <span class="math inline">\(k\)</span> set to 10, the clustering captures 80% of the variation in the first seven right singular vectors.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># run kmeans on first 10 right singular vectors (scaled by Sigma)</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   clusters similar documents</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20250325</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>oisKmeans <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(oisSVD<span class="sc">$</span>v[,<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>] <span class="sc">%*%</span> <span class="fu">diag</span>(oisSVD<span class="sc">$</span>d[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]), </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">centers =</span> kSelect,</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nstart =</span> <span class="dv">5</span>) <span class="co"># try 5 random starting points</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s add the cluster label to our original OIS data frame so we can see if themes are identifiable from their incident descriptions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add the cluster labels to the dataset</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>ois<span class="sc">$</span>cluster <span class="ot">&lt;-</span> oisKmeans<span class="sc">$</span>cluster</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>ois <span class="sc">|&gt;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(id,location,date,cluster) <span class="sc">|&gt;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     id                                 location       date cluster
1 24-37      3450 Vista Street, Philadelphia, PA 2024-12-10       9
2 24-36          3250 A Street, Philadelphia, PA 2024-11-12       2
3 24-35 5450 Chancellor Street, Philadelphia, PA 2024-11-10      10
4 24-32         2950 E. Street, Philadelphia, PA 2024-10-11       9
5 24-31      3350 Willits Road, Philadelphia, PA 2024-10-03       6
6 24-30    6150 Lebanon Avenue, Philadelphia, PA 2024-10-02       9</code></pre>
</div>
</div>
<p>We need to craft some labels or definitions for these clusters. For each cluster I will compute the average of their TFIDF weights for each term in the vocabulary. I will paste together the top ten terms as cluster labels.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>hovertext <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(oisTFIDF) <span class="sc">|&gt;</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cluster =</span> ois<span class="sc">$</span>cluster) <span class="sc">|&gt;</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cluster) <span class="sc">|&gt;</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># average the TFIDF values within each cluster</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), mean), <span class="at">.groups =</span> <span class="st">"drop"</span>) <span class="sc">|&gt;</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>cluster) <span class="sc">|&gt;</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># find the top 10 TFIDF weighted terms by cluster</span></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">1</span>, <span class="cf">function</span>(w)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>  {</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">&lt;-</span> <span class="fu">order</span>(w, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(oisTFIDF)[i[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]]</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  }) <span class="sc">|&gt;</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">t</span>() <span class="sc">|&gt;</span></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># paste together the top 10 terms</span></span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">apply</span>(<span class="dv">1</span>, paste, <span class="at">collapse=</span><span class="st">", "</span>) <span class="sc">|&gt;</span> </span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">terms =</span> _) <span class="sc">|&gt;</span></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cbind</span>(<span class="at">size =</span> oisKmeans<span class="sc">$</span>size,</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">cluster =</span> <span class="dv">1</span><span class="sc">:</span>kSelect) <span class="sc">|&gt;</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(size))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let’s examine the top 10 terms for these clusters.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>hovertext <span class="sc">|&gt;</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">escape =</span> <span class="cn">FALSE</span>, </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Top Terms"</span>, <span class="st">"Size"</span>, <span class="st">"Cluster"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"left"</span>, </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Top Terms</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Size</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cluster</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">driver, passeng, unmark, point, car, rear, area, door, gun, front</td>
<td style="text-align: right;">33</td>
<td style="text-align: right;">8</td>
</tr>
<tr class="even">
<td style="text-align: left;">offend, polic_vehicl, offend_offend, mark_polic, injuri_result, provid, properti, offic_mark, prior_charg, charg_decis</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">swat, unit, properti, door, shoot, front, locat, secur, insid, black</td>
<td style="text-align: right;">15</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">suspect, male_suspect, swat, swat_offic, robberi, dure, veteran, depart, fire, off-duti</td>
<td style="text-align: right;">12</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">dog, attack, bull, pit_bull, pit, owner, year, year_old, anim, old</td>
<td style="text-align: right;">11</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">offend, victim, handgun, gun, one_time, area, left, right, sever, black</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: left;">knife, drop_knife, offend, bedroom, drop, toward_offic, arm, move, toward, male_drop</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">dog, resid, narcot, retreat, polic_depart, secur, encount, veteran_philadelphia, veteran, depart</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="odd">
<td style="text-align: left;">detect, shoot, polic_district, person, veteran, room, depart, polic_depart, duti, injur</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;">offic_number, number, number_one, two, offend, plaincloth_offic, plaincloth, pistol, three, firearm_offic</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p>The first row describes the largest cluster with 33 documents (Cluster #8). It describes shootings involving a car (driver, passenger, door). The second largest cluster (Cluster #3) seems to describe a prototypical officer-involved shooting involving an offender, a marked police vehicle, and some mention of charges. Clusters #10 and #1 are the SWAT (Special Weapons and Tactics) incidents. Cluster #2 clearly seems to be shootings of dogs, commonly pit bulls. You can pick up other themes in the remaining clusters such as knife attacks and the involvement of plainclothes police officers.</p>
<p>Let’s plot these out based on the values of each document’s first two right singular vectors (<span class="math inline">\(v_1\)</span> and <span class="math inline">\(v_2\)</span>). I will color them based on their clustering and add the top 10 terms as hovertext so we have some idea about the themes. Explore the clusters in the plot and see if you can extra some of those themes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ly</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">1</span>],</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> oisSVD<span class="sc">$</span>v[,<span class="dv">2</span>],</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"scatter"</span>,</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">mode =</span> <span class="st">"markers"</span>,</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> ois<span class="sc">$</span>cluster,</span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">hoverinfo =</span> <span class="st">"text"</span>, <span class="co"># don't show the coordinates, only hoverinfo</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> hovertext<span class="sc">$</span>terms[ois<span class="sc">$</span>cluster] <span class="sc">|&gt;</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">", "</span>, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>, <span class="at">x=</span>_), </span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">marker =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">6</span>)</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">layout</span>(</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">xaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"SVD Dimension 1"</span>),</span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">yaxis =</span> <span class="fu">list</span>(<span class="at">title =</span> <span class="st">"SVD Dimension 2"</span>),</span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"K-Means Clustering of OIS Reports"</span></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fig-clusteredDocuments" class="cell-output-display quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-clusteredDocuments-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="plotly html-widget html-fill-item" id="htmlwidget-9404cc15c9f3c4fbe5bd" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-9404cc15c9f3c4fbe5bd">{"x":{"visdat":{"73a060e9251f":["function () ","plotlyVisDat"]},"cur_data":"73a060e9251f","attrs":{"73a060e9251f":{"x":[0.13016093963267819,0.10231699477635534,0.085512826149933566,0.12917295358684452,0.084149421205118369,0.13127178436051215,0.10650647950750791,0.08503389705433409,0.082840540114520994,0.12596040597652211,0.11568923012434747,0.09539892358965496,0.1031121173693529,0.14125781532991571,0.099581867247699379,0.10745886513048092,0.14290625908342347,0.1326594229184524,0.098984549860191701,0.11535087704560251,0.081032964201314284,0.1244751188653153,0.097894581456425545,0.1183176619640437,0.090061072478837323,0.087466202577181157,0.088442154195074396,0.10128752712337366,0.11299509384721008,0.10363558051012836,0.092525792354167288,0.11410110842148377,0.095650206987512656,0.11487545448892496,0.096678157663676684,0.10366880134280462,0.093593366205540596,0.076987455668136778,0.073407444317435705,0.090833441339926518,0.086156223822562952,0.084768918692660816,0.09371427301739349,0.079781307657639328,0.10071300047644424,0.10476242605121314,0.090108185819903736,0.072657338369223404,0.081716177102647891,0.08147403992935702,0.075851035323362362,0.10569577811157987,0.082538982291421953,0.10031074376692276,0.075959019470818345,0.072788028503809124,0.083883078910908279,0.098475016952769126,0.084874643042482614,0.078585241424528621,0.071355070229268319,0.072283223751582998,0.073104689434369402,0.078898319322206936,0.093836767032658641,0.076357423067844946,0.11757967657037006,0.081664733500482686,0.099683439920077263,0.080444429316018584,0.079296035231695872,0.077448768712446922,0.084834502362981123,0.070947730754001306,0.060976061465513043,0.064786978205185558,0.06506597005891665,0.062254381900017801,0.065534675725211308,0.06819189556333119,0.061789364295619986,0.061777520424832658,0.074375445323841202,0.063843785005722825,0.062085399250787709,0.066532972391451645,0.064735822928175826,0.063065779776642433,0.05987274530798499,0.061936941344078296,0.059335581863470536,0.060974759191640172,0.067608127849558677,0.061145300709514058,0.075906602973259948,0.081651425446607778,0.069094095123723887,0.068303421277020354,0.077384255916517181,0.066908756505984199,0.063942811791556559,0.067214344774304241,0.070818580738014045,0.079552252698355072,0.079095069375138979,0.060869794786939685,0.073095891165159493,0.075734040686979268,0.067592175626066564,0.086496858092310766,0.078832891243112851,0.069430417790723481,0.075381570265328948,0.082903916873345113,0.086701172783356026,0.06914010240990219,0.071401087322133516,0.077814289484206572,0.085968597548538361,0.076844992058665046,0.07844915006717143,0.066496126113719287,0.065868720452723073,0.077457320465133275,0.081302134331207324,0.070597767155514787,0.076787920037709914,0.091247195140274753,0.077024613269143102,0.074889782083216491,0.075964747273408739,0.068013696848289507,0.073875061178728579],"y":[0.18161875587789689,0.11572360794264425,-0.0019788713728065717,0.17877124283368384,0.022223821264152923,0.18259981991707092,0.11707134487490918,0.061167241620392346,0.05572097583763206,0.1685067836463737,0.16374104976200621,0.048273649645646469,0.033926441809114423,0.21204170471713843,0.02054790385483761,0.14751141714765928,0.27223024324059197,0.21900917326533437,0.018577428260032672,0.15651561529202304,0.0081574778119158087,0.21117828010095682,0.044146742468963475,0.16906490917093736,-0.020444727606716701,-0.019688882975228771,0.033479502282273005,0.044488847114346149,0.16140495714203171,0.1291528926248714,0.038955610515428132,0.14319779874135449,0.034513205577909781,0.15715001234373499,0.010288774058011515,0.028026034813560894,0.0051619495486397212,-0.010960374257623993,-0.030801485117322062,0.0034805026327011305,-0.04537296656073616,-0.029218619199922257,-0.01581894389017682,0.021759934033232672,-0.10195414139595692,-0.075582185895513701,0.0082711645406465424,-0.003816032820549816,-0.0090294497149071146,0.011946510583231498,-0.04784603891168452,-0.074302718196757406,-0.0061615587655334241,-0.069463137440628639,-0.038615261481704154,-0.0054909352281676425,0.0039205632203706585,-0.075457978192816078,-0.055179220140726085,-0.0073223667718193075,-0.041430095428084013,-0.03856773579959237,-0.017835534277815427,-0.044649955663984775,-0.055517186343691252,-0.043525980650874013,-0.010785309029566622,-0.018800689621417694,-0.035265350888931582,-0.052368279640408327,-0.051409710766081904,-0.034207072019543656,-0.040655204858792919,-0.038890557656961464,-0.038987763380822112,-0.0429512129916272,-0.045648128441618453,-0.054518156209489084,-0.04637327243463224,-0.039908186961754598,-0.044414605916259203,-0.066320446211673073,-0.044769638626015774,-0.0473578282716101,-0.052404098414888155,-0.059307027123973996,-0.056645432021001585,-0.041634832202926478,-0.046675899727654395,-0.034090937987938885,-0.050356933614642496,-0.055910170380923011,-0.054914686535615653,-0.056871431498744726,-0.03753800244911653,-0.091381277492467064,-0.090664280006923004,-0.074810860787178662,-0.10524991876150692,-0.067975793704709339,-0.069922810025450463,-0.069184758056329981,-0.080422748552774551,-0.12826536685842249,-0.11433017564914451,-0.068300567015818783,-0.08880749330514702,-0.069338953255502808,-0.070404913327719545,-0.10441397207560431,-0.1260104065008332,-0.07775840918543836,-0.1035919549572657,-0.11536478039227689,-0.096572852746188889,-0.0842223455146862,-0.089363072445301409,-0.0960114911379851,-0.082579749139763001,-0.088826183218488619,-0.071017011830248875,-0.080397971558564083,-0.07021981716928441,-0.079212195080423126,-0.089976583088172218,-0.087500908125515434,-0.087191210821466705,-0.10666919804154303,-0.094477686770881322,-0.088159755127270603,-0.081527310486232837,-0.078845635288058144,-0.095375442585102707],"mode":"markers","hoverinfo":"text","text":["detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black"],"marker":{"size":6},"color":[9,2,10,9,6,9,9,6,6,9,2,1,1,9,1,2,2,2,1,2,10,2,1,2,7,8,6,1,2,2,1,2,1,9,10,1,1,8,8,10,7,10,10,10,7,7,7,10,10,10,8,4,10,7,8,10,10,7,7,8,8,8,8,8,7,4,1,10,1,4,8,8,8,8,8,8,8,8,8,8,8,6,8,8,8,3,4,8,8,8,8,8,8,8,10,3,3,6,5,8,8,4,3,5,5,3,3,3,3,4,5,3,3,3,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],"alpha_stroke":1,"sizes":[10,100],"spans":[1,20],"type":"scatter"}},"layout":{"margin":{"b":40,"l":60,"t":25,"r":10},"xaxis":{"domain":[0,1],"automargin":true,"title":"SVD Dimension 1"},"yaxis":{"domain":[0,1],"automargin":true,"title":"SVD Dimension 2"},"title":"K-Means Clustering of OIS Reports","hovermode":"closest","showlegend":false,"legend":{"yanchor":"top","y":0.5}},"source":"A","config":{"modeBarButtonsToAdd":["hoverclosest","hovercompare"],"showSendToCloud":false},"data":[{"x":[0.13016093963267819,0.10231699477635534,0.085512826149933566,0.12917295358684452,0.084149421205118369,0.13127178436051215,0.10650647950750791,0.08503389705433409,0.082840540114520994,0.12596040597652211,0.11568923012434747,0.09539892358965496,0.1031121173693529,0.14125781532991571,0.099581867247699379,0.10745886513048092,0.14290625908342347,0.1326594229184524,0.098984549860191701,0.11535087704560251,0.081032964201314284,0.1244751188653153,0.097894581456425545,0.1183176619640437,0.090061072478837323,0.087466202577181157,0.088442154195074396,0.10128752712337366,0.11299509384721008,0.10363558051012836,0.092525792354167288,0.11410110842148377,0.095650206987512656,0.11487545448892496,0.096678157663676684,0.10366880134280462,0.093593366205540596,0.076987455668136778,0.073407444317435705,0.090833441339926518,0.086156223822562952,0.084768918692660816,0.09371427301739349,0.079781307657639328,0.10071300047644424,0.10476242605121314,0.090108185819903736,0.072657338369223404,0.081716177102647891,0.08147403992935702,0.075851035323362362,0.10569577811157987,0.082538982291421953,0.10031074376692276,0.075959019470818345,0.072788028503809124,0.083883078910908279,0.098475016952769126,0.084874643042482614,0.078585241424528621,0.071355070229268319,0.072283223751582998,0.073104689434369402,0.078898319322206936,0.093836767032658641,0.076357423067844946,0.11757967657037006,0.081664733500482686,0.099683439920077263,0.080444429316018584,0.079296035231695872,0.077448768712446922,0.084834502362981123,0.070947730754001306,0.060976061465513043,0.064786978205185558,0.06506597005891665,0.062254381900017801,0.065534675725211308,0.06819189556333119,0.061789364295619986,0.061777520424832658,0.074375445323841202,0.063843785005722825,0.062085399250787709,0.066532972391451645,0.064735822928175826,0.063065779776642433,0.05987274530798499,0.061936941344078296,0.059335581863470536,0.060974759191640172,0.067608127849558677,0.061145300709514058,0.075906602973259948,0.081651425446607778,0.069094095123723887,0.068303421277020354,0.077384255916517181,0.066908756505984199,0.063942811791556559,0.067214344774304241,0.070818580738014045,0.079552252698355072,0.079095069375138979,0.060869794786939685,0.073095891165159493,0.075734040686979268,0.067592175626066564,0.086496858092310766,0.078832891243112851,0.069430417790723481,0.075381570265328948,0.082903916873345113,0.086701172783356026,0.06914010240990219,0.071401087322133516,0.077814289484206572,0.085968597548538361,0.076844992058665046,0.07844915006717143,0.066496126113719287,0.065868720452723073,0.077457320465133275,0.081302134331207324,0.070597767155514787,0.076787920037709914,0.091247195140274753,0.077024613269143102,0.074889782083216491,0.075964747273408739,0.068013696848289507,0.073875061178728579],"y":[0.18161875587789689,0.11572360794264425,-0.0019788713728065717,0.17877124283368384,0.022223821264152923,0.18259981991707092,0.11707134487490918,0.061167241620392346,0.05572097583763206,0.1685067836463737,0.16374104976200621,0.048273649645646469,0.033926441809114423,0.21204170471713843,0.02054790385483761,0.14751141714765928,0.27223024324059197,0.21900917326533437,0.018577428260032672,0.15651561529202304,0.0081574778119158087,0.21117828010095682,0.044146742468963475,0.16906490917093736,-0.020444727606716701,-0.019688882975228771,0.033479502282273005,0.044488847114346149,0.16140495714203171,0.1291528926248714,0.038955610515428132,0.14319779874135449,0.034513205577909781,0.15715001234373499,0.010288774058011515,0.028026034813560894,0.0051619495486397212,-0.010960374257623993,-0.030801485117322062,0.0034805026327011305,-0.04537296656073616,-0.029218619199922257,-0.01581894389017682,0.021759934033232672,-0.10195414139595692,-0.075582185895513701,0.0082711645406465424,-0.003816032820549816,-0.0090294497149071146,0.011946510583231498,-0.04784603891168452,-0.074302718196757406,-0.0061615587655334241,-0.069463137440628639,-0.038615261481704154,-0.0054909352281676425,0.0039205632203706585,-0.075457978192816078,-0.055179220140726085,-0.0073223667718193075,-0.041430095428084013,-0.03856773579959237,-0.017835534277815427,-0.044649955663984775,-0.055517186343691252,-0.043525980650874013,-0.010785309029566622,-0.018800689621417694,-0.035265350888931582,-0.052368279640408327,-0.051409710766081904,-0.034207072019543656,-0.040655204858792919,-0.038890557656961464,-0.038987763380822112,-0.0429512129916272,-0.045648128441618453,-0.054518156209489084,-0.04637327243463224,-0.039908186961754598,-0.044414605916259203,-0.066320446211673073,-0.044769638626015774,-0.0473578282716101,-0.052404098414888155,-0.059307027123973996,-0.056645432021001585,-0.041634832202926478,-0.046675899727654395,-0.034090937987938885,-0.050356933614642496,-0.055910170380923011,-0.054914686535615653,-0.056871431498744726,-0.03753800244911653,-0.091381277492467064,-0.090664280006923004,-0.074810860787178662,-0.10524991876150692,-0.067975793704709339,-0.069922810025450463,-0.069184758056329981,-0.080422748552774551,-0.12826536685842249,-0.11433017564914451,-0.068300567015818783,-0.08880749330514702,-0.069338953255502808,-0.070404913327719545,-0.10441397207560431,-0.1260104065008332,-0.07775840918543836,-0.1035919549572657,-0.11536478039227689,-0.096572852746188889,-0.0842223455146862,-0.089363072445301409,-0.0960114911379851,-0.082579749139763001,-0.088826183218488619,-0.071017011830248875,-0.080397971558564083,-0.07021981716928441,-0.079212195080423126,-0.089976583088172218,-0.087500908125515434,-0.087191210821466705,-0.10666919804154303,-0.094477686770881322,-0.088159755127270603,-0.081527310486232837,-0.078845635288058144,-0.095375442585102707],"mode":"markers","hoverinfo":["text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text","text"],"text":["detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offend<br />polic_vehicl<br />offend_offend<br />mark_polic<br />injuri_result<br />provid<br />properti<br />offic_mark<br />prior_charg<br />charg_decis","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","detect<br />shoot<br />polic_district<br />person<br />veteran<br />room<br />depart<br />polic_depart<br />duti<br />injur","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","knife<br />drop_knife<br />offend<br />bedroom<br />drop<br />toward_offic<br />arm<br />move<br />toward<br />male_drop","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","driver<br />passeng<br />unmark<br />point<br />car<br />rear<br />area<br />door<br />gun<br />front","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","offic_number<br />number<br />number_one<br />two<br />offend<br />plaincloth_offic<br />plaincloth<br />pistol<br />three<br />firearm_offic","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","offend<br />victim<br />handgun<br />gun<br />one_time<br />area<br />left<br />right<br />sever<br />black","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","dog<br />resid<br />narcot<br />retreat<br />polic_depart<br />secur<br />encount<br />veteran_philadelphia<br />veteran<br />depart","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","dog<br />attack<br />bull<br />pit_bull<br />pit<br />owner<br />year<br />year_old<br />anim<br />old","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","suspect<br />male_suspect<br />swat<br />swat_offic<br />robberi<br />dure<br />veteran<br />depart<br />fire<br />off-duti","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black","swat<br />unit<br />properti<br />door<br />shoot<br />front<br />locat<br />secur<br />insid<br />black"],"marker":{"colorbar":{"title":"","ticklen":2},"cmin":1,"cmax":10,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[9,2,10,9,6,9,9,6,6,9,2,1,1,9,1,2,2,2,1,2,10,2,1,2,7,8,6,1,2,2,1,2,1,9,10,1,1,8,8,10,7,10,10,10,7,7,7,10,10,10,8,4,10,7,8,10,10,7,7,8,8,8,8,8,7,4,1,10,1,4,8,8,8,8,8,8,8,8,8,8,8,6,8,8,8,3,4,8,8,8,8,8,8,8,10,3,3,6,5,8,8,4,3,5,5,3,3,3,3,4,5,3,3,3,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3],"size":6,"line":{"colorbar":{"title":"","ticklen":2},"cmin":1,"cmax":10,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":false,"color":[9,2,10,9,6,9,9,6,6,9,2,1,1,9,1,2,2,2,1,2,10,2,1,2,7,8,6,1,2,2,1,2,1,9,10,1,1,8,8,10,7,10,10,10,7,7,7,10,10,10,8,4,10,7,8,10,10,7,7,8,8,8,8,8,7,4,1,10,1,4,8,8,8,8,8,8,8,8,8,8,8,6,8,8,8,3,4,8,8,8,8,8,8,8,10,3,3,6,5,8,8,4,3,5,5,3,3,3,3,4,5,3,3,3,4,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3]}},"type":"scatter","xaxis":"x","yaxis":"y","frame":null},{"x":[0.059335581863470536,0.14290625908342347],"y":[-0.12826536685842249,0.27223024324059197],"type":"scatter","mode":"markers","opacity":0,"hoverinfo":"none","showlegend":false,"marker":{"colorbar":{"title":"","ticklen":2,"len":0.5,"lenmode":"fraction","y":1,"yanchor":"top"},"cmin":1,"cmax":10,"colorscale":[["0","rgba(68,1,84,1)"],["0.0416666666666667","rgba(70,19,97,1)"],["0.0833333333333333","rgba(72,32,111,1)"],["0.125","rgba(71,45,122,1)"],["0.166666666666667","rgba(68,58,128,1)"],["0.208333333333333","rgba(64,70,135,1)"],["0.25","rgba(60,82,138,1)"],["0.291666666666667","rgba(56,93,140,1)"],["0.333333333333333","rgba(49,104,142,1)"],["0.375","rgba(46,114,142,1)"],["0.416666666666667","rgba(42,123,142,1)"],["0.458333333333333","rgba(38,133,141,1)"],["0.5","rgba(37,144,140,1)"],["0.541666666666667","rgba(33,154,138,1)"],["0.583333333333333","rgba(39,164,133,1)"],["0.625","rgba(47,174,127,1)"],["0.666666666666667","rgba(53,183,121,1)"],["0.708333333333333","rgba(79,191,110,1)"],["0.75","rgba(98,199,98,1)"],["0.791666666666667","rgba(119,207,85,1)"],["0.833333333333333","rgba(147,214,70,1)"],["0.875","rgba(172,220,52,1)"],["0.916666666666667","rgba(199,225,42,1)"],["0.958333333333333","rgba(226,228,40,1)"],["1","rgba(253,231,37,1)"]],"showscale":true,"color":[1,10],"line":{"color":"rgba(255,127,14,1)"}},"xaxis":"x","yaxis":"y","frame":null}],"highlight":{"on":"plotly_click","persistent":false,"dynamic":false,"selectize":false,"opacityDim":0.20000000000000001,"selected":{"opacity":1},"debounce":0},"shinyEvents":["plotly_hover","plotly_click","plotly_selected","plotly_relayout","plotly_brushed","plotly_brushing","plotly_clickannotation","plotly_doubleclick","plotly_deselect","plotly_afterplot","plotly_sunburstclick"],"base_url":"https://plot.ly"},"evals":[],"jsHooks":[]}</script>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-clusteredDocuments-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Plot of document by first two right singular vectors, colored by cluster
</figcaption>
</figure>
</div>
</div>
</section>
<section id="document-classification" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Document classification</h1>
<p>We can now explore whether the text in the officer-involved shooting narratives helps us predict whether the subject was fatally shot in the incident. We will base our predictions directly on the DTM, the word frequency count in the text. I will use <code>glmnet()</code> to fit an L1 regularized logistic regression model, a logistic regression model with a penalty on the sum of the absolute values of the coefficients. The intention is that this will select out those particular terms that signal a fatal shooting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit logistic regression with L1 penalty</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20250329</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>oisLasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(<span class="fu">as.matrix</span>(oisDTM), </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                      ois<span class="sc">$</span>fatal, </span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                      <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                      <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                      <span class="at">nfolds =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><a href="#tbl-lassocoef" class="quarto-xref">Table&nbsp;2</a> shows the terms with the largest coefficients.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(oisLasso, <span class="at">s =</span> <span class="st">"lambda.min"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">|&gt;</span></span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="st">"Term"</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(s1)) <span class="sc">|&gt;</span></span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">10</span>) <span class="sc">|&gt;</span></span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="at">digits =</span> <span class="dv">2</span>, </span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>        <span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">"Term"</span>, <span class="st">"LASSO Coefficient"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">full_width =</span> <span class="cn">FALSE</span>, </span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>), </span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">"left"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="tbl-lassocoef" class="cell quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-lassocoef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Top 5 terms with the largest coefficients
</figcaption>
<div aria-describedby="tbl-lassocoef-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div>
<table class="table table-striped table-hover do-not-create-environment cell table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">LASSO Coefficient</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">pronounc</td>
<td style="text-align: right;">1.51</td>
</tr>
<tr class="even">
<td style="text-align: left;">hospit_pronounc</td>
<td style="text-align: right;">1.19</td>
</tr>
<tr class="odd">
<td style="text-align: left;">pronounc_deceas</td>
<td style="text-align: right;">0.90</td>
</tr>
<tr class="even">
<td style="text-align: left;">assist</td>
<td style="text-align: right;">0.62</td>
</tr>
<tr class="odd">
<td style="text-align: left;">addit</td>
<td style="text-align: right;">0.19</td>
</tr>
<tr class="even">
<td style="text-align: left;">femal</td>
<td style="text-align: right;">0.16</td>
</tr>
<tr class="odd">
<td style="text-align: left;">deceas</td>
<td style="text-align: right;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: left;">advanc_toward</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">announc</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="even">
<td style="text-align: left;">approach_driver</td>
<td style="text-align: right;">0.00</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</figure>
</div>
</div>
<p>Quite sensibly we see terms associated with the subject being “pronounced deceased” and is variations. Only 7 terms have non-zero coefficients.</p>
<p>Let’s see how it performs in terms of misclassification. I will use 10-fold cross-validation to get out-of-fold predicted probabilities for each document.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">20250329</span>)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>iFold <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">length.out=</span><span class="fu">nrow</span>(ois)) <span class="sc">|&gt;</span> <span class="fu">sample</span>()</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>oofPred <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="fu">nrow</span>(ois))</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>) </span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(oisDTM[iFold<span class="sc">!=</span>i,], </span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>                   ois<span class="sc">$</span>fatal[iFold<span class="sc">!=</span>i], </span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">family =</span> <span class="st">"binomial"</span>, </span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">nfolds =</span> <span class="dv">10</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  oofPred[iFold<span class="sc">==</span>i] <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit, </span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>                               <span class="at">newx =</span> oisDTM[iFold<span class="sc">==</span>i,],</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>                               <span class="at">s =</span> <span class="st">"lambda.min"</span>, </span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>                               <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's use a 0.25 probability cut-off (about 28% are fatal)</span></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(oofPred<span class="sc">&gt;</span><span class="fl">0.25</span>, ois<span class="sc">$</span>fatal)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       
         0  1
  FALSE 91  5
  TRUE   4 33</code></pre>
</div>
</div>
<p>Overall predictive performance seems reasonably good. There is a lot of information in the terms to separate most fatal incidents from the non-fatal ones.</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = true;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>